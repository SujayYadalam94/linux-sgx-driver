cscope 15 $HOME/Documents/driver/linux-sgx-driver               0000124079
	@isgx.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/compž”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

6 
MODULE_INFO
(
Çme
, 
KBUILD_MODNAME
);

8 
__visibË
 
moduË
 
__this_moduË


9 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

10 .
Çme
 = 
KBUILD_MODNAME
,

11 .
	gš™
 = 
š™_moduË
,

12 #ifdeà
CONFIG_MODULE_UNLOAD


13 .
	gex™
 = 
þ—nup_moduË
,

15 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

18 cÚ¡ 
	g__moduË_d•’ds
[]

19 
__u£d


20 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

23 
MODULE_ALIAS
("acpi*:INT0E0C:*");

25 
MODULE_INFO
(
¤cv”siÚ
, "6452E8783ACA5ADE1E62BC0");

	@sgx.h

60 #iâdeà
__ARCH_INTEL_SGX_H__


61 
	#__ARCH_INTEL_SGX_H__


	)

63 
	~"sgx_asm.h
"

64 
	~<lšux/k»f.h
>

65 
	~<lšux/v”siÚ.h
>

66 
	~<lšux/rbŒ“.h
>

67 
	~<lšux/rw£m.h
>

68 
	~<lšux/sched.h
>

69 
	~<lšux/wÜkqueue.h
>

70 
	~<lšux/mmu_nÙif›r.h
>

71 
	~<lšux/¿dix-Œ“.h
>

72 
	~"sgx_¬ch.h
"

73 
	~"sgx_u£r.h
"

75 
	#SGX_EINIT_SPIN_COUNT
 20

	)

76 
	#SGX_EINIT_SLEEP_COUNT
 50

	)

77 
	#SGX_EINIT_SLEEP_TIME
 20

	)

79 
	#SGX_VA_SLOT_COUNT
 512

	)

81 
	#LARGE_PAGE_SIZE
 (512*
PAGE_SIZE
)

82 

	)

83 
	ssgx_•c_·ge
 {

84 
»sourû_size_t
 
	m·
;

85 
li¡_h—d
 
	mli¡
;

86 
sgx_’þ_·ge
 *
	m’þ_·ge
;

89 
	esgx_®loc_æags
 {

90 
	mSGX_ALLOC_ATOMIC
 = 
BIT
(0),

93 
	ssgx_va_·ge
 {

94 
sgx_•c_·ge
 *
	m•c_·ge
;

95 
DECLARE_BITMAP
(
¦Ùs
, 
SGX_VA_SLOT_COUNT
);

96 
li¡_h—d
 
	mli¡
;

99 
šlše
 
	$sgx_®loc_va_¦Ù
(
sgx_va_·ge
 *
·ge
)

101 
¦Ù
 = 
	`fšd_fœ¡_z”o_b™
(
·ge
->
¦Ùs
, 
SGX_VA_SLOT_COUNT
);

103 ià(
¦Ù
 < 
SGX_VA_SLOT_COUNT
)

104 
	`£t_b™
(
¦Ù
, 
·ge
->
¦Ùs
);

106  
¦Ù
 << 3;

107 
	}
}

109 
šlše
 
	$sgx_ä“_va_¦Ù
(
sgx_va_·ge
 *
·ge
,

110 
off£t
)

112 
	`þ—r_b™
(
off£t
 >> 3, 
·ge
->
¦Ùs
);

113 
	}
}

115 
	esgx_’þ_·ge_æags
 {

116 
	mSGX_ENCL_PAGE_TCS
 = 
BIT
(0),

117 
	mSGX_ENCL_PAGE_RESERVED
 = 
BIT
(1),

120 
	ssgx_’þ_·ge
 {

121 
	maddr
;

122 
	mæags
;

123 
sgx_•c_·ge
 *
	m•c_·ge
;

124 
sgx_va_·ge
 *
	mva_·ge
;

125 
	mva_off£t
;

126 
	m·ge_size
;

129 
	ssgx_tgid_ùx
 {

130 
pid
 *
	mtgid
;

131 
k»f
 
	m»fcouÁ
;

132 
li¡_h—d
 
	m’þ_li¡
;

133 
li¡_h—d
 
	mli¡
;

136 
	esgx_’þ_æags
 {

137 
	mSGX_ENCL_INITIALIZED
 = 
BIT
(0),

138 
	mSGX_ENCL_DEBUG
 = 
BIT
(1),

139 
	mSGX_ENCL_SECS_EVICTED
 = 
BIT
(2),

140 
	mSGX_ENCL_SUSPEND
 = 
BIT
(3),

141 
	mSGX_ENCL_DEAD
 = 
BIT
(4),

144 
	ssgx_’þ
 {

145 
	mæags
;

146 
ušt64_t
 
	m©Œibu‹s
;

147 
ušt64_t
 
	mxäm
;

148 
	m£cs_chžd_út
;

149 
mu‹x
 
	mlock
;

150 
mm_¡ruù
 *
	mmm
;

151 
fže
 *
	mbackšg
;

152 
fže
 *
	mpcmd
;

153 
li¡_h—d
 
	mlßd_li¡
;

154 
k»f
 
	m»fcouÁ
;

155 
	mba£
;

156 
	msize
;

157 
	ms§äamesize
;

158 
li¡_h—d
 
	mva_·ges
;

159 
¿dix_Œ“_roÙ
 
	m·ge_Œ“
;

160 
li¡_h—d
 
	madd_·ge_»qs
;

161 
wÜk_¡ruù
 
	madd_·ge_wÜk
;

162 
sgx_’þ_·ge
 
	m£cs
;

163 
sgx_tgid_ùx
 *
	mtgid_ùx
;

164 
li¡_h—d
 
	m’þ_li¡
;

165 
mmu_nÙif›r
 
	mmmu_nÙif›r
;

168 
	ssgx_•c_bªk
 {

169 
	m·
;

170 #ifdeà
CONFIG_X86_64


171 
	mva
;

173 
	msize
;

176 
wÜkqueue_¡ruù
 *
sgx_add_·ge_wq
;

177 
sgx_•c_bªk
 
sgx_•c_bªks
[];

178 
sgx_Ä_•c_bªks
;

179 
u64
 
sgx_’þ_size_max_32
;

180 
u64
 
sgx_’þ_size_max_64
;

181 
u64
 
sgx_xäm_mask
;

182 
u32
 
sgx_misc_»£rved
;

183 
u32
 
sgx_x§ve_size_tbl
[64];

185 cÚ¡ 
vm_Ý”©iÚs_¡ruù
 
sgx_vm_Ýs
;

187 
	#sgx_´_¿‹lim™ed
(
Ëv–
, 
’þ
, 
fmt
, ...) \

188 
´_
 ## 
Ëv–
 ## 
	`_¿‹lim™ed
("š‹l_sgx: [%d:0x%p] " 
fmt
, \

189 
	`pid_Ä
((
’þ
)->
tgid_ùx
->
tgid
), \

190 (*)(
’þ
)->
ba£
, ##
__VA_ARGS__
)

	)

192 
	#sgx_dbg
(
’þ
, 
fmt
, ...) \

193 
	`sgx_´_¿‹lim™ed
(
debug
, 
’þ
, 
fmt
, ##
__VA_ARGS__
)

	)

194 
	#sgx_šfo
(
’þ
, 
fmt
, ...) \

195 
	`sgx_´_¿‹lim™ed
(
šfo
, 
’þ
, 
fmt
, ##
__VA_ARGS__
)

	)

196 
	#sgx_w¬n
(
’þ
, 
fmt
, ...) \

197 
	`sgx_´_¿‹lim™ed
(
w¬n
, 
’þ
, 
fmt
, ##
__VA_ARGS__
)

	)

198 
	#sgx_”r
(
’þ
, 
fmt
, ...) \

199 
	`sgx_´_¿‹lim™ed
(
”r
, 
’þ
, 
fmt
, ##
__VA_ARGS__
)

	)

200 
	#sgx_ü™
(
’þ
, 
fmt
, ...) \

201 
	`sgx_´_¿‹lim™ed
(
ü™
, 
’þ
, 
fmt
, ##
__VA_ARGS__
)

	)

203 
sgx_’þ_fšd
(
mm_¡ruù
 *
mm
, 
addr
,

204 
vm_¬—_¡ruù
 **
vma
);

205 
sgx_tgid_ùx_»Ëa£
(
k»f
 *
»f
);

206 
sgx_’þ_ü—‹
(
sgx_£cs
 *
£cs
);

207 
sgx_’þ_add_·ge
(
sgx_’þ
 *
’þ
, 
addr
, *
d©a
,

208 
sgx_£cšfo
 *
£cšfo
, 
mrmask
, 
·ge_size
);

209 
sgx_’þ_š™
(
sgx_’þ
 *
’þ
, 
sgx_sig¡ruù
 *
sig¡ruù
,

210 
sgx_eš™tok’
 *
eš™tok’
);

211 
sgx_’þ_»Ëa£
(
k»f
 *
»f
);

213 
sgx_ioùl
(
fže
 *
fž•
, 
cmd
, 
¬g
);

214 #ifdeà
CONFIG_COMPAT


215 
sgx_com·t_ioùl
(
fže
 *
fž•
, 
cmd
, 
¬g
);

219 
sgx_‹¡_ªd_þ—r_young
(
sgx_’þ_·ge
 *
·ge
, 
sgx_’þ
 *
’þ
);

220 
·ge
 *
sgx_g‘_backšg
(
sgx_’þ
 *
’þ
,

221 
sgx_’þ_·ge
 *
’Œy
,

222 
boÞ
 
pcmd
);

223 
sgx_put_backšg
(
·ge
 *
backšg
, 
boÞ
 
wr™e
);

224 
sgx_š£¹_±e
(
sgx_’þ
 *
’þ
,

225 
sgx_’þ_·ge
 *
’þ_·ge
,

226 
sgx_•c_·ge
 *
•c_·ge
,

227 
vm_¬—_¡ruù
 *
vma
);

228 
sgx_”emove
(
sgx_•c_·ge
 *
•c_·ge
);

229 
sgx_z­_tcs_±es
(
sgx_’þ
 *
’þ
,

230 
vm_¬—_¡ruù
 *
vma
);

231 
sgx_šv®id©e
(
sgx_’þ
 *
’þ
, 
boÞ
 
æush_ýus
);

232 
sgx_æush_ýus
(
sgx_’þ
 *
’þ
);

234 
	esgx_çuÉ_æags
 {

235 
	mSGX_FAULT_RESERVE
 = 
BIT
(0),

238 
sgx_’þ_·ge
 *
sgx_çuÉ_·ge
(
vm_¬—_¡ruù
 *
vma
,

239 
addr
,

240 
æags
);

243 
mu‹x
 
sgx_tgid_ùx_mu‹x
;

244 
li¡_h—d
 
sgx_tgid_ùx_li¡
;

245 
©omic_t
 
sgx_va_·ges_út
;

247 
sgx_add_•c_bªk
(
»sourû_size_t
 
¡¬t
, 
size
, 
bªk
);

248 
sgx_add_•c_Í_bªk
(
»sourû_size_t
 
¡¬t
, 
size
);

249 
sgx_·ge_ÿche_š™
();

250 
sgx_·ge_ÿche_‹¬down
();

251 
sgx_•c_·ge
 *
sgx_®loc_·ge
(
æags
);

252 
sgx_•c_·ge
 *
sgx_®loc_Í_·ge
(
æags
);

253 
sgx_ä“_·ge
(
sgx_•c_·ge
 *
’Œy
, 
sgx_’þ
 *
’þ
);

254 *
sgx_g‘_·ge
(
sgx_•c_·ge
 *
’Œy
);

255 
sgx_put_·ge
(*
•c_·ge_vaddr
);

256 
sgx_eblock
(
sgx_’þ
 *
’þ
, 
sgx_•c_·ge
 *
•c_·ge
);

257 
sgx_‘¿ck
(
sgx_’þ
 *
’þ
);

	@sgx_arch.h

57 
	~<lšux/ty³s.h
>

58 #iâdeà
_ASM_X86_SGX_ARCH_H


59 
	#_ASM_X86_SGX_ARCH_H


	)

61 
	#SGX_SSA_GPRS_SIZE
 182

	)

62 
	#SGX_SSA_MISC_EXINFO_SIZE
 16

	)

64 
	esgx_misc
 {

65 
	mSGX_MISC_EXINFO
 = 0x01,

68 
	#SGX_MISC_RESERVED_MASK
 0xFFFFFFFFFFFFFFFEL

	)

70 
	esgx_©Œibu‹
 {

71 
	mSGX_ATTR_DEBUG
 = 0x02,

72 
	mSGX_ATTR_MODE64BIT
 = 0x04,

73 
	mSGX_ATTR_PROVISIONKEY
 = 0x10,

74 
	mSGX_ATTR_EINITTOKENKEY
 = 0x20,

77 
	#SGX_ATTR_RESERVED_MASK
 0xFFFFFFFFFFFFFF49L

	)

79 
	#SGX_SECS_RESERVED1_SIZE
 24

	)

80 
	#SGX_SECS_RESERVED2_SIZE
 32

	)

81 
	#SGX_SECS_RESERVED3_SIZE
 32

	)

82 
	#SGX_SECS_RESERVED4_SIZE
 3834

	)

84 
	ssgx_£cs
 {

85 
ušt64_t
 
	msize
;

86 
ušt64_t
 
	mba£
;

87 
ušt32_t
 
	ms§äamesize
;

88 
ušt32_t
 
	mmisc£Ëù
;

89 
ušt8_t
 
	m»£rved1
[
SGX_SECS_RESERVED1_SIZE
];

90 
ušt64_t
 
	m©Œibu‹s
;

91 
ušt64_t
 
	mxäm
;

92 
ušt32_t
 
	mm»nþave
[8];

93 
ušt8_t
 
	m»£rved2
[
SGX_SECS_RESERVED2_SIZE
];

94 
ušt32_t
 
	mmrsigÃr
[8];

95 
ušt32_t
 
	mcÚfigid
[16];

96 
ušt8_t
 
	m»£rved3
[
SGX_SECS_RESERVED3_SIZE
];

97 
ušt16_t
 
	misvv´odid
;

98 
ušt16_t
 
	misvsvn
;

99 
ušt16_t
 
	mcÚfigsvn
;

100 
ušt8_t
 
	m»£rved4
[
SGX_SECS_RESERVED4_SIZE
];

103 
	esgx_tcs_æags
 {

104 
	mSGX_TCS_DBGOPTIN
 = 0x01,

107 
	#SGX_TCS_RESERVED_MASK
 0xFFFFFFFFFFFFFFFEL

	)

109 
	ssgx_tcs
 {

110 
ušt64_t
 
	m¡©e
;

111 
ušt64_t
 
	mæags
;

112 
ušt64_t
 
	mos§
;

113 
ušt32_t
 
	mcs§
;

114 
ušt32_t
 
	mns§
;

115 
ušt64_t
 
	mÛÁry
;

116 
ušt64_t
 
	m«p
;

117 
ušt64_t
 
	mofsba£
;

118 
ušt64_t
 
	mogsba£
;

119 
ušt32_t
 
	mf¦im™
;

120 
ušt32_t
 
	mg¦im™
;

121 
ušt64_t
 
	m»£rved
[503];

124 
	ssgx_·gešfo
 {

125 
ušt64_t
 
	mlšaddr
;

126 
ušt64_t
 
	m¤ýge
;

128 
ušt64_t
 
	m£cšfo
;

129 
ušt64_t
 
	mpcmd
;

131 
ušt64_t
 
	m£cs
;

132 } 
__©Œibu‹__
((
®igÃd
(32)));

135 
	#SGX_SECINFO_PERMISSION_MASK
 0x0000000000000007L

	)

136 
	#SGX_SECINFO_PAGE_TYPE_MASK
 0x000000000000FF00L

	)

137 
	#SGX_SECINFO_RESERVED_MASK
 0xFFFFFFFFFFFF00F8L

	)

139 
	esgx_·ge_ty³
 {

140 
	mSGX_PAGE_TYPE_SECS
 = 0x00,

141 
	mSGX_PAGE_TYPE_TCS
 = 0x01,

142 
	mSGX_PAGE_TYPE_REG
 = 0x02,

143 
	mSGX_PAGE_TYPE_VA
 = 0x03,

146 
	esgx_£cšfo_æags
 {

147 
	mSGX_SECINFO_R
 = 0x01,

148 
	mSGX_SECINFO_W
 = 0x02,

149 
	mSGX_SECINFO_X
 = 0x04,

150 
	mSGX_SECINFO_SECS
 = (
SGX_PAGE_TYPE_SECS
 << 8),

151 
	mSGX_SECINFO_TCS
 = (
SGX_PAGE_TYPE_TCS
 << 8),

152 
	mSGX_SECINFO_REG
 = (
SGX_PAGE_TYPE_REG
 << 8),

155 
	ssgx_£cšfo
 {

156 
ušt64_t
 
	mæags
;

157 
ušt64_t
 
	m»£rved
[7];

158 } 
__©Œibu‹__
((
®igÃd
(64)));

160 
	ssgx_pcmd
 {

161 
sgx_£cšfo
 
	m£cšfo
;

162 
ušt64_t
 
	m’þave_id
;

163 
ušt8_t
 
	m»£rved
[40];

164 
ušt8_t
 
	mmac
[16];

167 
	#SGX_MODULUS_SIZE
 384

	)

169 
	ssgx_sig¡ruù_h—d”
 {

170 
ušt64_t
 
	mh—d”1
[2];

171 
ušt32_t
 
	mv’dÜ
;

172 
ušt32_t
 
	md©e
;

173 
ušt64_t
 
	mh—d”2
[2];

174 
ušt32_t
 
	mswdefšed
;

175 
ušt8_t
 
	m»£rved1
[84];

178 
	ssgx_sig¡ruù_body
 {

179 
ušt32_t
 
	mmisc£Ëù
;

180 
ušt32_t
 
	mmiscmask
;

181 
ušt8_t
 
	m»£rved2
[20];

182 
ušt64_t
 
	m©Œibu‹s
;

183 
ušt64_t
 
	mxäm
;

184 
ušt8_t
 
	m©Œibu‹mask
[16];

185 
ušt8_t
 
	mm»nþave
[32];

186 
ušt8_t
 
	m»£rved3
[32];

187 
ušt16_t
 
	misv´odid
;

188 
ušt16_t
 
	misvsvn
;

189 } 
__©Œibu‹__
((
__·cked__
));

191 
	ssgx_sig¡ruù
 {

192 
sgx_sig¡ruù_h—d”
 
	mh—d”
;

193 
ušt8_t
 
	mmodulus
[
SGX_MODULUS_SIZE
];

194 
ušt32_t
 
	mexpÚ’t
;

195 
ušt8_t
 
	msigÇtu»
[
SGX_MODULUS_SIZE
];

196 
sgx_sig¡ruù_body
 
	mbody
;

197 
ušt8_t
 
	m»£rved4
[12];

198 
ušt8_t
 
	mq1
[
SGX_MODULUS_SIZE
];

199 
ušt8_t
 
	mq2
[
SGX_MODULUS_SIZE
];

202 
	ssgx_sig¡ruù_·ylßd
 {

203 
sgx_sig¡ruù_h—d”
 
	mh—d”
;

204 
sgx_sig¡ruù_body
 
	mbody
;

207 
	ssgx_eš™tok’_·ylßd
 {

208 
ušt32_t
 
	mv®id
;

209 
ušt32_t
 
	m»£rved1
[11];

210 
ušt64_t
 
	m©Œibu‹s
;

211 
ušt64_t
 
	mxäm
;

212 
ušt8_t
 
	mm»nþave
[32];

213 
ušt8_t
 
	m»£rved2
[32];

214 
ušt8_t
 
	mmrsigÃr
[32];

215 
ušt8_t
 
	m»£rved3
[32];

218 
	ssgx_eš™tok’
 {

219 
sgx_eš™tok’_·ylßd
 
	m·ylßd
;

220 
ušt8_t
 
	mýusvÆe
[16];

221 
ušt16_t
 
	misv´odidË
;

222 
ušt16_t
 
	misvsvÆe
;

223 
ušt8_t
 
	m»£rved2
[24];

224 
ušt32_t
 
	mmaskedmisc£ËùË
;

225 
ušt64_t
 
	mmasked©Œibu‹¦e
;

226 
ušt64_t
 
	mmaskedxämË
;

227 
ušt8_t
 
	mkeyid
[32];

228 
ušt8_t
 
	mmac
[16];

231 
	ssgx_»pÜt
 {

232 
ušt8_t
 
	mýusvn
[16];

233 
ušt32_t
 
	mmisc£Ëù
;

234 
ušt8_t
 
	m»£rved1
[28];

235 
ušt64_t
 
	m©Œibu‹s
;

236 
ušt64_t
 
	mxäm
;

237 
ušt8_t
 
	mm»nþave
[32];

238 
ušt8_t
 
	m»£rved2
[32];

239 
ušt8_t
 
	mmrsigÃr
[32];

240 
ušt8_t
 
	m»£rved3
[96];

241 
ušt16_t
 
	misv´odid
;

242 
ušt16_t
 
	misvsvn
;

243 
ušt8_t
 
	m»£rved4
[60];

244 
ušt8_t
 
	m»pÜtd©a
[64];

245 
ušt8_t
 
	mkeyid
[32];

246 
ušt8_t
 
	mmac
[16];

249 
	ssgx_rg‘šfo
 {

250 
ušt8_t
 
	mm»nþave
[32];

251 
ušt64_t
 
	m©Œibu‹s
;

252 
ušt64_t
 
	mxäm
;

253 
ušt8_t
 
	m»£rved1
[4];

254 
ušt32_t
 
	mmisc£Ëù
;

255 
ušt8_t
 
	m»£rved2
[456];

258 
	ssgx_key»que¡
 {

259 
ušt16_t
 
	mkeyÇme
;

260 
ušt16_t
 
	mkeypÞicy
;

261 
ušt16_t
 
	misvsvn
;

262 
ušt16_t
 
	m»£rved1
;

263 
ušt8_t
 
	mýusvn
[16];

264 
ušt64_t
 
	m©Œibu‹mask
;

265 
ušt64_t
 
	mxämmask
;

266 
ušt8_t
 
	mkeyid
[32];

267 
ušt32_t
 
	mmiscmask
;

268 
ušt8_t
 
	m»£rved2
[436];

	@sgx_asm.h

58 #iâdeà
_ASM_X86_SGX_H


59 
	#_ASM_X86_SGX_H


	)

61 
	~"sgx_¬ch.h
"

62 
	~<asm/asm.h
>

63 
	~<lšux/b™Ýs.h
>

64 
	~<lšux/”r.h
>

65 
	~<lšux/ty³s.h
>

67 
	#SGX_CPUID
 0x12

	)

69 
	esgx_ýuid
 {

70 
	mSGX_CPUID_CAPABILITIES
 = 0,

71 
	mSGX_CPUID_ATTRIBUTES
 = 1,

72 
	mSGX_CPUID_EPC_BANKS
 = 2,

75 
	esgx_commªds
 {

76 
	mECREATE
 = 0x0,

77 
	mEADD
 = 0x1,

78 
	mEINIT
 = 0x2,

79 
	mEREMOVE
 = 0x3,

80 
	mEDGBRD
 = 0x4,

81 
	mEDGBWR
 = 0x5,

82 
	mEEXTEND
 = 0x6,

83 
	mELDU
 = 0x8,

84 
	mEBLOCK
 = 0x9,

85 
	mEPA
 = 0xA,

86 
	mEWB
 = 0xB,

87 
	mETRACK
 = 0xC,

88 
	mEAUG
 = 0xD,

89 
	mEMODPR
 = 0xE,

90 
	mEMODT
 = 0xF,

93 #ifdeà
CONFIG_X86_64


94 
	#XAX
 "%%¿x"

	)

96 
	#XAX
 "%%—x"

	)

99 
	#__’þs_»t
(
¿x
, 
rbx
, 
rcx
, 
rdx
) \

101 
»t
; \

102 
asm
 volatile( \

106 "3: mov $-14,"
XAX
"\n" \

109 
	`_ASM_EXTABLE
(1b, 3b) \

110 : "÷"(
»t
) \

111 : "a"(
¿x
), "b"(
rbx
), "c"(
rcx
), "d"(
rdx
) \

113 
»t
; \

114 })

	)

116 
	#__’þs
(
¿x
, 
rbx
, 
rcx
, 
rdx
...) \

118 
»t
; \

119 
asm
 volatile( \

121 " xÜ "
XAX
","XAX"\n" \

124 "3: mov $-14,"
XAX
"\n" \

127 
	`_ASM_EXTABLE
(1b, 3b) \

128 : "÷"(
»t
), "=b"(
rbx
), "=c"(
rcx
) \

129 : "a"(
¿x
), "b"(
rbx
), "c"(
rcx
), 
rdx
 \

131 
»t
; \

132 })

	)

134 
šlše
 
	$__eü—‹
(
sgx_·gešfo
 *
pgšfo
, *
£cs
)

136  
	`__’þs
(
ECREATE
, 
pgšfo
, 
£cs
, "d"(0));

137 
	}
}

139 
šlše
 
	$__“x‹nd
(*
£cs
, *
•c
)

141  
	`__’þs
(
EEXTEND
, 
£cs
, 
•c
, "d"(0));

142 
	}
}

144 
šlše
 
	$__—dd
(
sgx_·gešfo
 *
pgšfo
, *
•c
)

146  
	`__’þs
(
EADD
, 
pgšfo
, 
•c
, "d"(0));

147 
	}
}

149 
šlše
 
	$__eš™
(*
sig¡ruù
, 
sgx_eš™tok’
 *
eš™tok’
,

150 *
£cs
)

152  
	`__’þs_»t
(
EINIT
, 
sig¡ruù
, 
£cs
, 
eš™tok’
);

153 
	}
}

155 
šlše
 
	$__”emove
(*
•c
)

157 
rbx
 = 0;

158 
rdx
 = 0;

160  
	`__’þs_»t
(
EREMOVE
, 
rbx
, 
•c
, 
rdx
);

161 
	}
}

163 
šlše
 
	$__edbgwr
(*
•c
, *
d©a
)

165  
	`__’þs
(
EDGBWR
, *
d©a
, 
•c
, "d"(0));

166 
	}
}

168 
šlše
 
	$__edbgrd
(*
•c
, *
d©a
)

170 
rbx
 = 0;

171 
»t
;

173 
»t
 = 
	`__’þs
(
EDGBRD
, 
rbx
, 
•c
, "d"(0));

174 ià(!
»t
)

175 *(*è
d©a
 = 
rbx
;

177  
»t
;

178 
	}
}

180 
šlše
 
	$__‘¿ck
(*
•c
)

182 
rbx
 = 0;

183 
rdx
 = 0;

185  
	`__’þs_»t
(
ETRACK
, 
rbx
, 
•c
, 
rdx
);

186 
	}
}

188 
šlše
 
	$__–du
(
rbx
, 
rcx
,

189 
rdx
)

191  
	`__’þs_»t
(
ELDU
, 
rbx
, 
rcx
, 
rdx
);

192 
	}
}

194 
šlše
 
	$__eblock
(
rcx
)

196 
rbx
 = 0;

197 
rdx
 = 0;

199  
	`__’þs_»t
(
EBLOCK
, 
rbx
, 
rcx
, 
rdx
);

200 
	}
}

202 
šlše
 
	$__•a
(*
•c
)

204 
rbx
 = 
SGX_PAGE_TYPE_VA
;

206  
	`__’þs
(
EPA
, 
rbx
, 
•c
, "d"(0));

207 
	}
}

209 
šlše
 
	$__ewb
(
sgx_·gešfo
 *
pgšfo
, *
•c
, *
va
)

211  
	`__’þs_»t
(
EWB
, 
pgšfo
, 
•c
, 
va
);

212 
	}
}

214 
šlše
 
	$__—ug
(
sgx_·gešfo
 *
pgšfo
, *
•c
)

216  
	`__’þs
(
EAUG
, 
pgšfo
, 
•c
, "d"(0));

217 
	}
}

219 
šlše
 
	$__emod´
(
sgx_£cšfo
 *
£cšfo
, *
•c
)

221 
rdx
 = 0;

223  
	`__’þs_»t
(
EMODPR
, 
£cšfo
, 
•c
, 
rdx
);

224 
	}
}

226 
šlše
 
	$__emodt
(
sgx_£cšfo
 *
£cšfo
, *
•c
)

228 
rdx
 = 0;

230  
	`__’þs_»t
(
EMODT
, 
£cšfo
, 
•c
, 
rdx
);

231 
	}
}

	@sgx_encl.c

61 
	~"sgx.h
"

62 
	~<asm/mmª.h
>

63 
	~<lšux/d–ay.h
>

64 
	~<lšux/fže.h
>

65 
	~<lšux/highmem.h
>

66 
	~<lšux/¿‹lim™.h
>

67 #ià(
LINUX_VERSION_CODE
 >ð
KERNEL_VERSION
(4, 11, 0))

68 
	~<lšux/sched/sigÇl.h
>

70 
	~<lšux/sigÇl.h
>

72 
	~"lšux/fže.h
"

73 
	~<lšux/¦ab.h
>

74 
	~<lšux/hashbË.h
>

75 
	~<lšux/shmem_fs.h
>

76 
	~"sgx_pmd.h
"

78 
	ssgx_add_·ge_»q
 {

79 
sgx_’þ
 *
	m’þ
;

80 
sgx_’þ_·ge
 *
	m’þ_·ge
;

81 
sgx_£cšfo
 
	m£cšfo
;

82 
u16
 
	mmrmask
;

83 
li¡_h—d
 
	mli¡
;

102 
	$sgx_’þ_fšd
(
mm_¡ruù
 *
mm
, 
addr
,

103 
vm_¬—_¡ruù
 **
vma
)

105 
vm_¬—_¡ruù
 *
»suÉ
;

106 
sgx_’þ
 *
’þ
;

108 
»suÉ
 = 
	`fšd_vma
(
mm
, 
addr
);

109 ià(!
»suÉ
 ||„esuÉ->
vm_Ýs
 !ð&
sgx_vm_Ýs
 || 
addr
 <„esuÉ->
vm_¡¬t
)

110  -
EINVAL
;

112 
’þ
 = 
»suÉ
->
vm_´iv©e_d©a
;

113 *
vma
 = 
»suÉ
;

115  
’þ
 ? 0 : -
ENOENT
;

116 
	}
}

118 
sgx_tgid_ùx
 *
	$sgx_fšd_tgid_ùx
(
pid
 *
tgid
)

120 
sgx_tgid_ùx
 *
ùx
;

122 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
sgx_tgid_ùx_li¡
, 
li¡
)

123 ià(
	`pid_Ä
(
ùx
->
tgid
) ==…id_nr(tgid))

124  
ùx
;

126  
NULL
;

127 
	}
}

129 
	$sgx_add_to_tgid_ùx
(
sgx_’þ
 *
’þ
)

131 
sgx_tgid_ùx
 *
ùx
;

132 
pid
 *
tgid
 = 
	`g‘_pid
(
	`sk_tgid
(
cu¼’t
));

134 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

136 
ùx
 = 
	`sgx_fšd_tgid_ùx
(
tgid
);

137 ià(
ùx
) {

138 ià(
	`k»f_g‘_uÆess_z”o
(&
ùx
->
»fcouÁ
)) {

139 
’þ
->
tgid_ùx
 = 
ùx
;

140 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

141 
	`put_pid
(
tgid
);

144 
	`li¡_d–_š™
(&
ùx
->
li¡
);

148 
ùx
 = 
	`kz®loc
((*ùx), 
GFP_KERNEL
);

149 ià(!
ùx
) {

150 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

151 
	`put_pid
(
tgid
);

152  -
ENOMEM
;

155 
ùx
->
tgid
 =gid;

156 
	`k»f_š™
(&
ùx
->
»fcouÁ
);

157 
	`INIT_LIST_HEAD
(&
ùx
->
’þ_li¡
);

159 
	`li¡_add
(&
ùx
->
li¡
, &
sgx_tgid_ùx_li¡
);

161 
’þ
->
tgid_ùx
 = 
ùx
;

163 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

165 
	}
}

167 
	$sgx_tgid_ùx_»Ëa£
(
k»f
 *
»f
)

169 
sgx_tgid_ùx
 *
³
 =

170 
	`cÚš”_of
(
»f
, 
sgx_tgid_ùx
, 
»fcouÁ
);

171 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

172 
	`li¡_d–
(&
³
->
li¡
);

173 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

174 
	`put_pid
(
³
->
tgid
);

175 
	`kä“
(
³
);

176 
	}
}

178 
	$sgx_m—su»
(
sgx_•c_·ge
 *
£cs_·ge
,

179 
sgx_•c_·ge
 *
•c_·ge
,

180 
u16
 
mrmask
)

182 *
£cs
;

183 *
•c
;

184 
»t
 = 0;

185 
i
, 
j
;

187 
i
 = 0, 
j
 = 1; i < 0x1000 && !
»t
; i += 0x100, j <<= 1) {

188 ià(!(
j
 & 
mrmask
))

191 
£cs
 = 
	`sgx_g‘_·ge
(
£cs_·ge
);

192 
•c
 = 
	`sgx_g‘_·ge
(
•c_·ge
);

194 
»t
 = 
	`__“x‹nd
(
£cs
, (*)(()
•c
 + 
i
));

196 
	`sgx_put_·ge
(
•c
);

197 
	`sgx_put_·ge
(
£cs
);

200  
»t
;

201 
	}
}

203 
	$sgx_—dd
(
sgx_•c_·ge
 *
£cs_·ge
,

204 
sgx_•c_·ge
 *
•c_·ge
,

205 
lšaddr
,

206 
sgx_£cšfo
 *
£cšfo
,

207 
·ge
 *
backšg
)

209 
sgx_·gešfo
 
pgšfo
;

210 *
•c_·ge_vaddr
;

211 
»t
;

213 
pgšfo
.
¤ýge
 = ()
	`km­_©omic
(
backšg
);

214 
pgšfo
.
£cs
 = ()
	`sgx_g‘_·ge
(
£cs_·ge
);

215 
•c_·ge_vaddr
 = 
	`sgx_g‘_·ge
(
•c_·ge
);

217 
pgšfo
.
lšaddr
 =†inaddr;

218 
pgšfo
.
£cšfo
 = ()secinfo;

219 
»t
 = 
	`__—dd
(&
pgšfo
, 
•c_·ge_vaddr
);

221 
	`sgx_put_·ge
(
•c_·ge_vaddr
);

222 
	`sgx_put_·ge
((*)()
pgšfo
.
£cs
);

223 
	`kunm­_©omic
((*)()
pgšfo
.
¤ýge
);

225  
»t
;

226 
	}
}

228 
boÞ
 
	$sgx_´oûss_add_·ge_»q
(
sgx_add_·ge_»q
 *
»q
,

229 
sgx_•c_·ge
 *
•c_·ge
)

231 
·ge
 *
backšg
;

232 
sgx_’þ_·ge
 *
’þ_·ge
 = 
»q
->encl_page;

233 
sgx_’þ
 *
’þ
 = 
»q
->encl;

234 
vm_¬—_¡ruù
 *
vma
;

235 
»t
;

237 ià(
’þ
->
æags
 & (
SGX_ENCL_SUSPEND
 | 
SGX_ENCL_DEAD
))

238  
çl£
;

240 
»t
 = 
	`sgx_’þ_fšd
(
’þ
->
mm
, 
’þ_·ge
->
addr
, &
vma
);

241 ià(
»t
)

242  
çl£
;

244 
backšg
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
çl£
);

245 ià(
	`IS_ERR
(
backšg
))

246  
çl£
;

249 ià(!
	`©omic_»ad
(&
’þ
->
mm
->
mm_u£rs
)) {

250 
	`sgx_put_backšg
(
backšg
, 0);

251  
çl£
;

254 
»t
 = 
	`vm_š£¹_pâ
(
vma
, 
’þ_·ge
->
addr
, 
	`PFN_DOWN
(
•c_·ge
->
·
));

255 ià(
»t
) {

256 
	`sgx_put_backšg
(
backšg
, 0);

257  
çl£
;

260 
»t
 = 
	`sgx_—dd
(
’þ
->
£cs
.
•c_·ge
,ƒpc_·ge, 
’þ_·ge
->
addr
,

261 &
»q
->
£cšfo
, 
backšg
);

263 
	`sgx_put_backšg
(
backšg
, 0);

264 ià(
»t
) {

265 
	`sgx_w¬n
(
’þ
, "EADD„‘uºed %d\n", 
»t
);

266 
	`z­_vma_±es
(
vma
, 
’þ_·ge
->
addr
, 
PAGE_SIZE
);

267  
çl£
;

270 
’þ
->
£cs_chžd_út
++;

272 
»t
 = 
	`sgx_m—su»
(
’þ
->
£cs
.
•c_·ge
,ƒpc_·ge, 
»q
->
mrmask
);

273 ià(
»t
) {

274 
	`sgx_w¬n
(
’þ
, "EEXTEND„‘uºed %d\n", 
»t
);

275 
	`z­_vma_±es
(
vma
, 
’þ_·ge
->
addr
, 
PAGE_SIZE
);

276  
çl£
;

279 
•c_·ge
->
’þ_·ge
 =ƒncl_page;

280 
’þ_·ge
->
•c_·ge
 =ƒpc_page;

281 
	`sgx_‹¡_ªd_þ—r_young
(
’þ_·ge
, 
’þ
);

282 
	`li¡_add_ž
(&
•c_·ge
->
li¡
, &
’þ
->
lßd_li¡
);

284  
Œue
;

285 
	}
}

287 
	$sgx_add_·ge_wÜk”
(
wÜk_¡ruù
 *
wÜk
)

289 
sgx_’þ
 *
’þ
;

290 
sgx_add_·ge_»q
 *
»q
;

291 
sgx_•c_·ge
 *
•c_·ge
;

292 
boÞ
 
sk_»¡
 = 
çl£
;

293 
boÞ
 
is_em±y
 = 
çl£
;

295 
’þ
 = 
	`cÚš”_of
(
wÜk
, 
sgx_’þ
, 
add_·ge_wÜk
);

298 
	`scheduË
();

300 ià(
’þ
->
æags
 & 
SGX_ENCL_DEAD
)

301 
sk_»¡
 = 
Œue
;

303 
	`mu‹x_lock
(&
’þ
->
lock
);

304 
»q
 = 
	`li¡_fœ¡_’Œy
(&
’þ
->
add_·ge_»qs
,

305 
sgx_add_·ge_»q
, 
li¡
);

306 
	`li¡_d–
(&
»q
->
li¡
);

307 
is_em±y
 = 
	`li¡_em±y
(&
’þ
->
add_·ge_»qs
);

308 
	`mu‹x_uÆock
(&
’þ
->
lock
);

310 ià(
sk_»¡
)

311 
Ãxt
;

314 if(
»q
->
’þ_·ge
->
·ge_size
 =ð
LARGE_PAGE_SIZE
)

315 
•c_·ge
 = 
	`sgx_®loc_Í_·ge
(0);

317 
•c_·ge
 = 
	`sgx_®loc_·ge
(0);

318 ià(
	`IS_ERR
(
•c_·ge
)) {

319 
sk_»¡
 = 
Œue
;

320 
Ãxt
;

323 
	`down_»ad
(&
’þ
->
mm
->
mm­_£m
);

324 
	`mu‹x_lock
(&
’þ
->
lock
);

326 ià(!
	`sgx_´oûss_add_·ge_»q
(
»q
, 
•c_·ge
)) {

327 
	`sgx_ä“_·ge
(
•c_·ge
, 
’þ
);

328 
sk_»¡
 = 
Œue
;

331 
	`mu‹x_uÆock
(&
’þ
->
lock
);

332 
	`up_»ad
(&
’þ
->
mm
->
mm­_£m
);

334 
Ãxt
:

335 
	`kä“
(
»q
);

336 } !
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
è&& !
is_em±y
);

337 
	}
}

339 
u32
 
	$sgx_ÿlc_s§äamesize
(
u32
 
misc£Ëù
, 
u64
 
xäm
)

341 
u32
 
size_max
 = 
PAGE_SIZE
;

342 
u32
 
size
;

343 
i
;

345 
i
 = 2; i < 64; i++) {

346 ià(!((1 << 
i
è& 
xäm
))

349 
size
 = 
SGX_SSA_GPRS_SIZE
 + 
sgx_x§ve_size_tbl
[
i
];

350 ià(
misc£Ëù
 & 
SGX_MISC_EXINFO
)

351 
size
 +ð
SGX_SSA_MISC_EXINFO_SIZE
;

353 ià(
size
 > 
size_max
)

354 
size_max
 = 
size
;

357  (
size_max
 + 
PAGE_SIZE
 - 1è>> 
PAGE_SHIFT
;

358 
	}
}

360 
	$sgx_v®id©e_£cs
(cÚ¡ 
sgx_£cs
 *
£cs
,

361 
s§äamesize
)

363 
i
;

365 ià(
£cs
->
size
 < (2 * 
PAGE_SIZE
) ||

366 (
£cs
->
size
 & (secs->size - 1)) != 0)

367  -
EINVAL
;

369 ià(
£cs
->
ba£
 & (£cs->
size
 - 1))

370  -
EINVAL
;

372 ià(
£cs
->
©Œibu‹s
 & 
SGX_ATTR_RESERVED_MASK
 ||

373 
£cs
->
misc£Ëù
 & 
sgx_misc_»£rved
)

374  -
EINVAL
;

376 ià(
£cs
->
©Œibu‹s
 & 
SGX_ATTR_MODE64BIT
) {

377 #ifdeà
CONFIG_X86_64


378 ià(
£cs
->
size
 > 
sgx_’þ_size_max_64
)

379  -
EINVAL
;

381  -
EINVAL
;

387 #ifdeà
CONFIG_X86_64


388 ià(!
	`‹¡_th»ad_æag
(
TIF_ADDR32
))

389  -
EINVAL
;

391 ià(
£cs
->
size
 > 
sgx_’þ_size_max_32
)

392  -
EINVAL
;

395 ià((
£cs
->
xäm
 & 0x3è!ð0x3 || (£cs->xäm & ~
sgx_xäm_mask
))

396  -
EINVAL
;

399 ià(((
£cs
->
xäm
 >> 3) & 1) != ((secs->xfrm >> 4) & 1))

400  -
EINVAL
;

402 ià(!
£cs
->
s§äamesize
 || ssaframesize > secs->ssaframesize)

403  -
EINVAL
;

405 
i
 = 0; i < 
SGX_SECS_RESERVED1_SIZE
; i++)

406 ià(
£cs
->
»£rved1
[
i
])

407  -
EINVAL
;

409 
i
 = 0; i < 
SGX_SECS_RESERVED2_SIZE
; i++)

410 ià(
£cs
->
»£rved2
[
i
])

411  -
EINVAL
;

413 
i
 = 0; i < 
SGX_SECS_RESERVED3_SIZE
; i++)

414 ià(
£cs
->
»£rved3
[
i
])

415  -
EINVAL
;

417 
i
 = 0; i < 
SGX_SECS_RESERVED4_SIZE
; i++)

418 ià(
£cs
->
»£rved4
[
i
])

419  -
EINVAL
;

422 
	}
}

424 
	$sgx_mmu_nÙif›r_»Ëa£
(
mmu_nÙif›r
 *
mn
,

425 
mm_¡ruù
 *
mm
)

427 
sgx_’þ
 *
’þ
 =

428 
	`cÚš”_of
(
mn
, 
sgx_’þ
, 
mmu_nÙif›r
);

430 
	`mu‹x_lock
(&
’þ
->
lock
);

431 
’þ
->
æags
 |ð
SGX_ENCL_DEAD
;

432 
	`mu‹x_uÆock
(&
’þ
->
lock
);

433 
	}
}

435 cÚ¡ 
mmu_nÙif›r_Ýs
 
	gsgx_mmu_nÙif›r_Ýs
 = {

436 .
»Ëa£
 = 
sgx_mmu_nÙif›r_»Ëa£
,

439 
	$sgx_š™_·ge
(
sgx_’þ
 *
’þ
, 
sgx_’þ_·ge
 *
’Œy
,

440 
addr
, 
®loc_æags
)

442 
sgx_va_·ge
 *
va_·ge
;

443 
sgx_•c_·ge
 *
•c_·ge
 = 
NULL
;

444 
va_off£t
 = 
PAGE_SIZE
;

445 *
vaddr
;

446 
»t
 = 0;

448 
	`li¡_fÜ_—ch_’Œy
(
va_·ge
, &
’þ
->
va_·ges
, 
li¡
) {

449 
va_off£t
 = 
	`sgx_®loc_va_¦Ù
(
va_·ge
);

450 ià(
va_off£t
 < 
PAGE_SIZE
)

454 ià(
va_off£t
 =ð
PAGE_SIZE
) {

455 
	`´_šfo
("š‹l_sgx: % addr=0x%lx\n",
__func__
,
addr
);

456 
va_·ge
 = 
	`kz®loc
((*va_·ge), 
GFP_KERNEL
);

457 ià(!
va_·ge
)

458  -
ENOMEM
;

460 
•c_·ge
 = 
	`sgx_®loc_·ge
(
®loc_æags
);

461 ià(
	`IS_ERR
(
•c_·ge
)) {

462 
	`kä“
(
va_·ge
);

463  
	`PTR_ERR
(
•c_·ge
);

466 
vaddr
 = 
	`sgx_g‘_·ge
(
•c_·ge
);

467 ià(!
vaddr
) {

468 
	`sgx_w¬n
(
’þ
, "kmap of‡‚ew VA…age failed %d\n",

469 
»t
);

470 
	`sgx_ä“_·ge
(
•c_·ge
, 
’þ
);

471 
	`kä“
(
va_·ge
);

472  -
EFAULT
;

475 
»t
 = 
	`__•a
(
vaddr
);

476 
	`sgx_put_·ge
(
vaddr
);

478 ià(
»t
) {

479 
	`sgx_w¬n
(
’þ
, "EPA„‘uºed %d\n", 
»t
);

480 
	`sgx_ä“_·ge
(
•c_·ge
, 
’þ
);

481 
	`kä“
(
va_·ge
);

482  -
EFAULT
;

485 
	`©omic_šc
(&
sgx_va_·ges_út
);

487 
va_·ge
->
•c_·ge
 =ƒpc_page;

488 
va_off£t
 = 
	`sgx_®loc_va_¦Ù
(
va_·ge
);

490 
	`mu‹x_lock
(&
’þ
->
lock
);

491 
	`li¡_add
(&
va_·ge
->
li¡
, &
’þ
->
va_·ges
);

492 
	`mu‹x_uÆock
(&
’þ
->
lock
);

495 
’Œy
->
va_·ge
 = va_page;

496 
’Œy
->
va_off£t
 = va_offset;

497 
’Œy
->
addr
 =‡ddr;

500 
	}
}

515 
sgx_’þ
 *
	$sgx_’þ_®loc
(
sgx_£cs
 *
£cs
)

517 
s§äamesize
;

518 
sgx_’þ
 *
’þ
;

519 
fže
 *
backšg
;

520 
fže
 *
pcmd
;

522 
s§äamesize
 = 
	`sgx_ÿlc_s§äamesize
(
£cs
->
misc£Ëù
, secs->
xäm
);

523 ià(
	`sgx_v®id©e_£cs
(
£cs
, 
s§äamesize
))

524  
	`ERR_PTR
(-
EINVAL
);

526 
backšg
 = 
	`shmem_fže_£tup
("[dev/sgx]", 
£cs
->
size
 + 
PAGE_SIZE
,

527 
VM_NORESERVE
);

528 ià(
	`IS_ERR
(
backšg
))

529  (*)
backšg
;

531 
pcmd
 = 
	`shmem_fže_£tup
("[dev/sgx]", (
£cs
->
size
 + 
PAGE_SIZE
) >> 5,

532 
VM_NORESERVE
);

533 ià(
	`IS_ERR
(
pcmd
)) {

534 
	`åut
(
backšg
);

535  (*)
pcmd
;

538 
’þ
 = 
	`kz®loc
((*’þ), 
GFP_KERNEL
);

539 ià(!
’þ
) {

540 
	`åut
(
backšg
);

541 
	`åut
(
pcmd
);

542  
	`ERR_PTR
(-
ENOMEM
);

545 
’þ
->
©Œibu‹s
 = 
£cs
->attributes;

546 
’þ
->
xäm
 = 
£cs
->xfrm;

548 
	`k»f_š™
(&
’þ
->
»fcouÁ
);

549 
	`INIT_LIST_HEAD
(&
’þ
->
add_·ge_»qs
);

550 
	`INIT_LIST_HEAD
(&
’þ
->
va_·ges
);

551 
	`INIT_RADIX_TREE
(&
’þ
->
·ge_Œ“
, 
GFP_KERNEL
);

552 
	`INIT_LIST_HEAD
(&
’þ
->
lßd_li¡
);

553 
	`INIT_LIST_HEAD
(&
’þ
->
’þ_li¡
);

554 
	`mu‹x_š™
(&
’þ
->
lock
);

555 
	`INIT_WORK
(&
’þ
->
add_·ge_wÜk
, 
sgx_add_·ge_wÜk”
);

557 
’þ
->
mm
 = 
cu¼’t
->mm;

558 
’þ
->
ba£
 = 
£cs
->base;

559 
’þ
->
size
 = 
£cs
->size;

560 
’þ
->
s§äamesize
 = 
£cs
->ssaframesize;

561 
’þ
->
backšg
 = backing;

562 
’þ
->
pcmd
 =…cmd;

564  
’þ
;

565 
	}
}

579 
	$sgx_’þ_ü—‹
(
sgx_£cs
 *
£cs
)

581 
sgx_·gešfo
 
pgšfo
;

582 
sgx_£cšfo
 
£cšfo
;

583 
sgx_’þ
 *
’þ
;

584 
sgx_•c_·ge
 *
£cs_•c
;

585 
vm_¬—_¡ruù
 *
vma
;

586 *
£cs_vaddr
;

587 
»t
;

589 
’þ
 = 
	`sgx_’þ_®loc
(
£cs
);

590 ià(
	`IS_ERR
(
’þ
))

591  
	`PTR_ERR
(
’þ
);

593 
£cs_•c
 = 
	`sgx_®loc_·ge
(0);

594 ià(
	`IS_ERR
(
£cs_•c
)) {

595 
»t
 = 
	`PTR_ERR
(
£cs_•c
);

596 
out
;

599 
’þ
->
£cs
.
•c_·ge
 = 
£cs_•c
;

601 
»t
 = 
	`sgx_add_to_tgid_ùx
(
’þ
);

602 ià(
»t
)

603 
out
;

605 
»t
 = 
	`sgx_š™_·ge
(
’þ
, &’þ->
£cs
,ƒnþ->
ba£
 +ƒnþ->
size
, 0);

606 ià(
»t
)

607 
out
;

609 
£cs_vaddr
 = 
	`sgx_g‘_·ge
(
£cs_•c
);

611 
pgšfo
.
¤ýge
 = ()
£cs
;

612 
pgšfo
.
lšaddr
 = 0;

613 
pgšfo
.
£cšfo
 = ()&secinfo;

614 
pgšfo
.
£cs
 = 0;

615 
	`mem£t
(&
£cšfo
, 0, (secinfo));

616 
»t
 = 
	`__eü—‹
((*)&
pgšfo
, 
£cs_vaddr
);

618 
	`sgx_put_·ge
(
£cs_vaddr
);

620 ià(
»t
) {

621 
	`sgx_dbg
(
’þ
, "ECREATE„‘uºed %ld\n", 
»t
);

622 
»t
 = -
EFAULT
;

623 
out
;

626 ià(
£cs
->
©Œibu‹s
 & 
SGX_ATTR_DEBUG
)

627 
’þ
->
æags
 |ð
SGX_ENCL_DEBUG
;

629 
’þ
->
mmu_nÙif›r
.
Ýs
 = &
sgx_mmu_nÙif›r_Ýs
;

630 
»t
 = 
	`mmu_nÙif›r_»gi¡”
(&
’þ
->
mmu_nÙif›r
,ƒnþ->
mm
);

631 ià(
»t
) {

632 ià(
»t
 =ð-
EINTR
)

633 
»t
 = -
ERESTARTSYS
;

634 
’þ
->
mmu_nÙif›r
.
Ýs
 = 
NULL
;

635 
out
;

638 
	`down_»ad
(&
cu¼’t
->
mm
->
mm­_£m
);

639 
»t
 = 
	`sgx_’þ_fšd
(
cu¼’t
->
mm
, 
£cs
->
ba£
, &
vma
);

640 ià(
»t
 !ð-
ENOENT
) {

641 ià(!
»t
)

642 
»t
 = -
EINVAL
;

643 
	`up_»ad
(&
cu¼’t
->
mm
->
mm­_£m
);

644 
out
;

647 ià(
vma
->
vm_¡¬t
 !ð
£cs
->
ba£
 ||

648 
vma
->
vm_’d
 !ð(
£cs
->
ba£
 + secs->
size
)

650 
»t
 = -
EINVAL
;

651 
	`up_»ad
(&
cu¼’t
->
mm
->
mm­_£m
);

652 
out
;

655 
vma
->
vm_´iv©e_d©a
 = 
’þ
;

656 
	`up_»ad
(&
cu¼’t
->
mm
->
mm­_£m
);

658 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

659 
	`li¡_add_ž
(&
’þ
->
’þ_li¡
, &’þ->
tgid_ùx
->encl_list);

660 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

663 
out
:

664 ià(
’þ
)

665 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

666  
»t
;

667 
	}
}

669 
	$sgx_v®id©e_£cšfo
(
sgx_£cšfo
 *
£cšfo
)

671 
u64
 
³rm
 = 
£cšfo
->
æags
 & 
SGX_SECINFO_PERMISSION_MASK
;

672 
u64
 
·ge_ty³
 = 
£cšfo
->
æags
 & 
SGX_SECINFO_PAGE_TYPE_MASK
;

673 
i
;

675 ià((
£cšfo
->
æags
 & 
SGX_SECINFO_RESERVED_MASK
) ||

676 ((
³rm
 & 
SGX_SECINFO_W
è&& !Õ”m & 
SGX_SECINFO_R
)) ||

677 (
·ge_ty³
 !ð
SGX_SECINFO_TCS
 &&

678 
·ge_ty³
 !ð
SGX_SECINFO_REG
))

679  -
EINVAL
;

681 
i
 = 0; i < (
£cšfo
->
»£rved
è/ (
u64
); i++)

682 ià(
£cšfo
->
»£rved
[
i
])

683  -
EINVAL
;

686 
	}
}

688 
boÞ
 
	$sgx_v®id©e_off£t
(
sgx_’þ
 *
’þ
, 
off£t
)

690 ià(
off£t
 & (
PAGE_SIZE
 - 1))

691  
çl£
;

693 ià(
off£t
 >ð
’þ
->
size
)

694  
çl£
;

696  
Œue
;

697 
	}
}

699 
	$sgx_v®id©e_tcs
(
sgx_’þ
 *
’þ
, 
sgx_tcs
 *
tcs
)

701 
i
;

703 ià(
tcs
->
æags
 & 
SGX_TCS_RESERVED_MASK
) {

704 
	`sgx_dbg
(
’þ
, "%s: invalid TCS flags = 0x%lx\n",

705 
__func__
, ()
tcs
->
æags
);

706  -
EINVAL
;

709 ià(
tcs
->
æags
 & 
SGX_TCS_DBGOPTIN
) {

710 
	`sgx_dbg
(
’þ
, "%s: DBGOPTIN TCS flag is set, EADD will clear it\n",

711 
__func__
);

712  -
EINVAL
;

715 ià(!
	`sgx_v®id©e_off£t
(
’þ
, 
tcs
->
os§
)) {

716 
	`sgx_dbg
(
’þ
, "%s: inv®id OSSA: 0x%lx\n", 
__func__
,

717 ()
tcs
->
os§
);

718  -
EINVAL
;

721 ià(!
	`sgx_v®id©e_off£t
(
’þ
, 
tcs
->
ofsba£
)) {

722 
	`sgx_dbg
(
’þ
, "%s: inv®id OFSBASE: 0x%lx\n", 
__func__
,

723 ()
tcs
->
ofsba£
);

724  -
EINVAL
;

727 ià(!
	`sgx_v®id©e_off£t
(
’þ
, 
tcs
->
ogsba£
)) {

728 
	`sgx_dbg
(
’þ
, "%s: inv®id OGSBASE: 0x%lx\n", 
__func__
,

729 ()
tcs
->
ogsba£
);

730  -
EINVAL
;

733 ià((
tcs
->
f¦im™
 & 0xFFF) != 0xFFF) {

734 
	`sgx_dbg
(
’þ
, "%s: inv®id FSLIMIT: 0x%x\n", 
__func__
,

735 
tcs
->
f¦im™
);

736  -
EINVAL
;

739 ià((
tcs
->
g¦im™
 & 0xFFF) != 0xFFF) {

740 
	`sgx_dbg
(
’þ
, "%s: inv®id GSLIMIT: 0x%x\n", 
__func__
,

741 
tcs
->
g¦im™
);

742  -
EINVAL
;

745 
i
 = 0; i < (
tcs
->
»£rved
è/ (
u64
); i++)

746 ià(
tcs
->
»£rved
[
i
])

747  -
EINVAL
;

750 
	}
}

752 
	$__sgx_’þ_add_·ge
(
sgx_’þ
 *
’þ
,

753 
sgx_’þ_·ge
 *
’þ_·ge
,

754 
addr
,

755 *
d©a
,

756 
sgx_£cšfo
 *
£cšfo
,

757 
mrmask
)

759 
u64
 
·ge_ty³
 = 
£cšfo
->
æags
 & 
SGX_SECINFO_PAGE_TYPE_MASK
;

760 
·ge
 *
backšg
;

761 
sgx_add_·ge_»q
 *
»q
 = 
NULL
;

762 
»t
;

763 
em±y
;

764 *
backšg_±r
;

766 ià(
	`sgx_v®id©e_£cšfo
(
£cšfo
))

767  -
EINVAL
;

769 ià(
·ge_ty³
 =ð
SGX_SECINFO_TCS
) {

770 
»t
 = 
	`sgx_v®id©e_tcs
(
’þ
, 
d©a
);

771 ià(
»t
)

772  
»t
;

776 
»t
 = 
	`sgx_š™_·ge
(
’þ
, 
’þ_·ge
, 
addr
, 0);

777 ià(
»t
)

778  
»t
;

780 
	`mu‹x_lock
(&
’þ
->
lock
);

782 ià(
’þ
->
æags
 & (
SGX_ENCL_INITIALIZED
 | 
SGX_ENCL_DEAD
)) {

783 
»t
 = -
EINVAL
;

784 
out
;

787 ià(
	`¿dix_Œ“_lookup
(&
’þ
->
·ge_Œ“
, 
addr
 >> 
PAGE_SHIFT
)) {

788 
»t
 = -
EEXIST
;

789 
out
;

792 
»q
 = 
	`kz®loc
((*»q), 
GFP_KERNEL
);

793 ià(!
»q
) {

794 
»t
 = -
ENOMEM
;

795 
out
;

798 
backšg
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
çl£
);

799 ià(
	`IS_ERR
((*)
backšg
)) {

800 
»t
 = 
	`PTR_ERR
((*)
backšg
);

801 
out
;

804 
»t
 = 
	`¿dix_Œ“_š£¹
(&
’þ
->
·ge_Œ“
, 
’þ_·ge
->
addr
 >> 
PAGE_SHIFT
,

805 
’þ_·ge
);

806 ià(
»t
) {

807 
	`sgx_put_backšg
(
backšg
, 
çl£
 );

808 
out
;

811 
backšg_±r
 = 
	`km­
(
backšg
);

812 
	`memýy
(
backšg_±r
, 
d©a
, 
LARGE_PAGE_SIZE
);

813 
	`kunm­
(
backšg
);

815 ià(
·ge_ty³
 =ð
SGX_SECINFO_TCS
)

816 
’þ_·ge
->
æags
 |ð
SGX_ENCL_PAGE_TCS
;

818 
	`memýy
(&
»q
->
£cšfo
, secinfo, (*secinfo));

820 
»q
->
’þ
 =ƒncl;

821 
»q
->
’þ_·ge
 =ƒncl_page;

822 
»q
->
mrmask
 = mrmask;

823 
em±y
 = 
	`li¡_em±y
(&
’þ
->
add_·ge_»qs
);

824 
	`k»f_g‘
(&
’þ
->
»fcouÁ
);

825 
	`li¡_add_ž
(&
»q
->
li¡
, &
’þ
->
add_·ge_»qs
);

826 ià(
em±y
)

827 
	`queue_wÜk
(
sgx_add_·ge_wq
, &
’þ
->
add_·ge_wÜk
);

829 
	`sgx_put_backšg
(
backšg
, 
Œue
 );

831 
	`mu‹x_uÆock
(&
’þ
->
lock
);

833 
out
:

834 
	`kä“
(
»q
);

835 
	`sgx_ä“_va_¦Ù
(
’þ_·ge
->
va_·ge
,ƒnþ_·ge->
va_off£t
);

836 
	`mu‹x_uÆock
(&
’þ
->
lock
);

837  
»t
;

838 
	}
}

857 
	$sgx_’þ_add_·ge
(
sgx_’þ
 *
’þ
, 
addr
, *
d©a
,

858 
sgx_£cšfo
 *
£cšfo
, 
mrmask
, 
·ge_size
)

860 
sgx_’þ_·ge
 *
·ge
;

861 
»t
;

863 
·ge
 = 
	`kz®loc
((*·ge), 
GFP_KERNEL
);

864 ià(!
·ge
)

865  -
ENOMEM
;

867 
·ge
->
·ge_size
 =…age_size;

869 
»t
 = 
	`__sgx_’þ_add_·ge
(
’þ
, 
·ge
, 
addr
, 
d©a
, 
£cšfo
, 
mrmask
);

871 ià(
»t
)

872 
	`kä“
(
·ge
);

873  
»t
;

874 
	}
}

876 
	$sgx_eš™
(
sgx_’þ
 *
’þ
, 
sgx_sig¡ruù
 *
sig¡ruù
,

877 
sgx_eš™tok’
 *
tok’
)

879 
sgx_•c_·ge
 *
£cs_•c
 = 
’þ
->
£cs
.
•c_·ge
;

880 *
£cs_va
;

881 
»t
;

883 
£cs_va
 = 
	`sgx_g‘_·ge
(
£cs_•c
);

884 
»t
 = 
	`__eš™
(
sig¡ruù
, 
tok’
, 
£cs_va
);

885 
	`sgx_put_·ge
(
£cs_va
);

887  
»t
;

888 
	}
}

905 
	$sgx_’þ_š™
(
sgx_’þ
 *
’þ
, 
sgx_sig¡ruù
 *
sig¡ruù
,

906 
sgx_eš™tok’
 *
tok’
)

908 
»t
;

909 
i
;

910 
j
;

912 
	`æush_wÜk
(&
’þ
->
add_·ge_wÜk
);

914 
	`mu‹x_lock
(&
’þ
->
lock
);

916 ià(
’þ
->
æags
 & 
SGX_ENCL_INITIALIZED
) {

917 
	`mu‹x_uÆock
(&
’þ
->
lock
);

921 
i
 = 0; i < 
SGX_EINIT_SLEEP_COUNT
; i++) {

922 
j
 = 0; j < 
SGX_EINIT_SPIN_COUNT
; j++) {

923 
»t
 = 
	`sgx_eš™
(
’þ
, 
sig¡ruù
, 
tok’
);

925 ià(
»t
 =ð
SGX_UNMASKED_EVENT
)

931 ià(
»t
 !ð
SGX_UNMASKED_EVENT
)

934 
	`m¦“p_š‹¼u±ibË
(
SGX_EINIT_SLEEP_TIME
);

935 ià(
	`sigÇl_³ndšg
(
cu¼’t
)) {

936 
	`mu‹x_uÆock
(&
’þ
->
lock
);

937  -
ERESTARTSYS
;

941 
	`mu‹x_uÆock
(&
’þ
->
lock
);

943 ià(
»t
) {

944 ià(
»t
 > 0)

945 
	`sgx_dbg
(
’þ
, "EINIT„‘uºed %d\n", 
»t
);

946  
»t
;

949 
’þ
->
æags
 |ð
SGX_ENCL_INITIALIZED
;

951 
	}
}

953 
	$sgx_’þ_»Ëa£
(
k»f
 *
»f
)

955 
sgx_’þ_·ge
 *
’Œy
;

956 
sgx_va_·ge
 *
va_·ge
;

957 
sgx_’þ
 *
’þ
 = 
	`cÚš”_of
(
»f
, sgx_’þ, 
»fcouÁ
);

958 
¿dix_Œ“_™”
 
™”
;

959 **
¦Ù
;

961 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

962 ià(!
	`li¡_em±y
(&
’þ
->
’þ_li¡
))

963 
	`li¡_d–
(&
’þ
->
’þ_li¡
);

964 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

966 ià(
’þ
->
mmu_nÙif›r
.
Ýs
)

967 
	`mmu_nÙif›r_uÄegi¡”
(&
’þ
->
mmu_nÙif›r
,ƒnþ->
mm
);

969 
	`¿dix_Œ“_fÜ_—ch_¦Ù
(
¦Ù
, &
’þ
->
·ge_Œ“
, &
™”
, 0) {

970 
’Œy
 = *
¦Ù
;

971 ià(
’Œy
->
•c_·ge
) {

972 
	`li¡_d–
(&
’Œy
->
•c_·ge
->
li¡
);

973 
	`sgx_ä“_·ge
(
’Œy
->
•c_·ge
, 
’þ
);

975 
	`¿dix_Œ“_d–‘e
(&
’þ
->
·ge_Œ“
, 
’Œy
->
addr
 >> 
PAGE_SHIFT
);

976 
	`kä“
(
’Œy
);

979 !
	`li¡_em±y
(&
’þ
->
va_·ges
)) {

980 
va_·ge
 = 
	`li¡_fœ¡_’Œy
(&
’þ
->
va_·ges
,

981 
sgx_va_·ge
, 
li¡
);

982 
	`li¡_d–
(&
va_·ge
->
li¡
);

983 
	`sgx_ä“_·ge
(
va_·ge
->
•c_·ge
, 
’þ
);

984 
	`kä“
(
va_·ge
);

985 
	`©omic_dec
(&
sgx_va_·ges_út
);

988 ià(
’þ
->
£cs
.
•c_·ge
)

989 
	`sgx_ä“_·ge
(
’þ
->
£cs
.
•c_·ge
,ƒncl);

991 ià(
’þ
->
tgid_ùx
)

992 
	`k»f_put
(&
’þ
->
tgid_ùx
->
»fcouÁ
, 
sgx_tgid_ùx_»Ëa£
);

994 ià(
’þ
->
backšg
)

995 
	`åut
(
’þ
->
backšg
);

997 ià(
’þ
->
pcmd
)

998 
	`åut
(
’þ
->
pcmd
);

1000 
	`kä“
(
’þ
);

1001 
	}
}

	@sgx_ioctl.c

61 
	~"sgx.h
"

62 
	~<asm/mmª.h
>

63 
	~<lšux/d–ay.h
>

64 
	~<lšux/fže.h
>

65 
	~<lšux/highmem.h
>

66 
	~<lšux/¿‹lim™.h
>

67 #ià(
LINUX_VERSION_CODE
 >ð
KERNEL_VERSION
(4, 11, 0))

68 
	~<lšux/sched/sigÇl.h
>

70 
	~<lšux/sigÇl.h
>

72 
	~<lšux/¦ab.h
>

73 
	~<lšux/hashbË.h
>

74 
	~<lšux/shmem_fs.h
>

76 
	$sgx_g‘_’þ
(
addr
, 
sgx_’þ
 **
’þ
)

78 
mm_¡ruù
 *
mm
 = 
cu¼’t
->mm;

79 
vm_¬—_¡ruù
 *
vma
;

80 
»t
;

82 ià(
addr
 & (
PAGE_SIZE
 - 1))

83  -
EINVAL
;

85 
	`down_»ad
(&
mm
->
mm­_£m
);

87 
»t
 = 
	`sgx_’þ_fšd
(
mm
, 
addr
, &
vma
);

88 ià(!
»t
) {

89 *
’þ
 = 
vma
->
vm_´iv©e_d©a
;

91 ià((*
’þ
)->
æags
 & 
SGX_ENCL_SUSPEND
)

92 
»t
 = 
SGX_POWER_LOST_ENCLAVE
;

94 
	`k»f_g‘
(&(*
’þ
)->
»fcouÁ
);

97 
	`up_»ad
(&
mm
->
mm­_£m
);

98  
»t
;

99 
	}
}

114 
	$sgx_ioc_’þave_ü—‹
(
fže
 *
fž•
, 
cmd
,

115 
¬g
)

117 
sgx_’þave_ü—‹
 *
ü—‹p
 = (sgx_’þave_ü—‹ *)
¬g
;

118 
__u£r
 *
¤c
 = (__u£¸*)
ü—‹p
->src;

119 
sgx_£cs
 *
£cs
;

120 
»t
;

122 
£cs
 = 
	`kz®loc
((*£cs), 
GFP_KERNEL
);

123 ià(!
£cs
)

124  -
ENOMEM
;

126 
»t
 = 
	`cÝy_äom_u£r
(
£cs
, 
¤c
, (*secs));

127 ià(
»t
) {

128 
	`kä“
(
£cs
);

129  
»t
;

132 
»t
 = 
	`sgx_’þ_ü—‹
(
£cs
);

134 
	`kä“
(
£cs
);

135  
»t
;

136 
	}
}

152 
	$sgx_ioc_’þave_add_·ge
(
fže
 *
fž•
, 
cmd
,

153 
¬g
)

155 
sgx_’þave_add_·ge
 *
addp
 = (*)
¬g
;

156 
£cšfÝ
 = ()
addp
->
£cšfo
;

157 
sgx_£cšfo
 
£cšfo
;

158 
sgx_’þ
 *
’þ
;

159 
·ge
 *
d©a_·ge
 = 
NULL
;

160 *
d©a
;

161 
»t
;

163 
»t
 = 
	`sgx_g‘_’þ
(
addp
->
addr
, &
’þ
);

164 ià(
»t
)

165  
»t
;

167 ià(
	`cÝy_äom_u£r
(&
£cšfo
, (
__u£r
 *)
£cšfÝ
,

168 (
£cšfo
))) {

169 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

170  -
EFAULT
;

174 if(
addp
->
Ïrge_·ge
)

176 
	`´_šfo
("intel_sgx:†arge…age„equest„eceived.\n");

177 
d©a
 = (*)
	`km®loc
(
LARGE_PAGE_SIZE
, 
GFP_HIGHUSER
);

178 if(
d©a
 =ð
NULL
)

180 
	`kä“
(
d©a
);

181 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

182  -
ENOMEM
;

188 
d©a_·ge
 = 
	`®loc_·ge
(
GFP_HIGHUSER
);

189 ià(!
d©a_·ge
) {

190 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

191  -
ENOMEM
;

193 
d©a
 = 
	`km­
(
d©a_·ge
);

196 
»t
 = 
	`cÝy_äom_u£r
((*)
d©a
, (
__u£r
 *)
addp
->
¤c
, (addp->
Ïrge_·ge
?512:1)*
PAGE_SIZE
);

197 ià(
»t
)

198 
out
;

200 
»t
 = 
	`sgx_’þ_add_·ge
(
’þ
, 
addp
->
addr
, 
d©a
, &
£cšfo
,‡ddp->
mrmask
, (addp->
Ïrge_·ge
?512:1)*
PAGE_SIZE
);

201 ià(
»t
)

202 
out
;

204 
out
:

205 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

206 if(
addp
->
Ïrge_·ge
)

208 
	`kä“
(
d©a
);

212 
	`kunm­
(
d©a_·ge
);

213 
	`__ä“_·ge
(
d©a_·ge
);

215  
»t
;

216 
	}
}

231 
	$sgx_ioc_’þave_š™
(
fže
 *
fž•
, 
cmd
,

232 
¬g
)

234 
sgx_’þave_š™
 *
š™p
 = (sgx_’þave_š™ *)
¬g
;

235 
sig¡ruùp
 = ()
š™p
->
sig¡ruù
;

236 
eš™tok’p
 = ()
š™p
->
eš™tok’
;

237 
’þ_id
 = 
š™p
->
addr
;

238 
sgx_sig¡ruù
 *
sig¡ruù
;

239 
sgx_eš™tok’
 *
eš™tok’
;

240 
sgx_’þ
 *
’þ
;

241 
·ge
 *
š™p_·ge
;

242 
»t
;

244 
š™p_·ge
 = 
	`®loc_·ge
(
GFP_HIGHUSER
);

245 ià(!
š™p_·ge
)

246  -
ENOMEM
;

248 
sig¡ruù
 = 
	`km­
(
š™p_·ge
);

249 
eš™tok’
 = (
sgx_eš™tok’
 *)

250 (()
sig¡ruù
 + 
PAGE_SIZE
 / 2);

252 
»t
 = 
	`cÝy_äom_u£r
(
sig¡ruù
, (
__u£r
 *)
sig¡ruùp
,

253 (*
sig¡ruù
));

254 ià(
»t
)

255 
out
;

257 
»t
 = 
	`cÝy_äom_u£r
(
eš™tok’
, (
__u£r
 *)
eš™tok’p
,

258 (*
eš™tok’
));

259 ià(
»t
)

260 
out
;

262 
»t
 = 
	`sgx_g‘_’þ
(
’þ_id
, &
’þ
);

263 ià(
»t
)

264 
out
;

266 
»t
 = 
	`sgx_’þ_š™
(
’þ
, 
sig¡ruù
, 
eš™tok’
);

268 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

270 
out
:

271 
	`kunm­
(
š™p_·ge
);

272 
	`__ä“_·ge
(
š™p_·ge
);

273  
»t
;

274 
	}
}

276 (*
	tsgx_ioc_t
)(
	tfže
 *
	tfž•
, 
	tcmd
,

277 
	t¬g
);

279 
	$sgx_ioùl
(
fže
 *
fž•
, 
cmd
, 
¬g
)

281 
d©a
[256];

282 
sgx_ioc_t
 
hªdËr
 = 
NULL
;

283 
»t
;

285 
cmd
) {

286 
SGX_IOC_ENCLAVE_CREATE
:

287 
hªdËr
 = 
sgx_ioc_’þave_ü—‹
;

290 
SGX_IOC_ENCLAVE_ADD_PAGE
:

291 
hªdËr
 = 
sgx_ioc_’þave_add_·ge
;

293 
SGX_IOC_ENCLAVE_INIT
:

294 
hªdËr
 = 
sgx_ioc_’þave_š™
;

297  -
ENOIOCTLCMD
;

300 ià(
	`cÝy_äom_u£r
(
d©a
, (
__u£r
 *)
¬g
, 
	`_IOC_SIZE
(
cmd
)))

301  -
EFAULT
;

303 
»t
 = 
	`hªdËr
(
fž•
, 
cmd
, ()((*)
d©a
));

304 ià(!
»t
 && (
cmd
 & 
IOC_OUT
)) {

305 ià(
	`cÝy_to_u£r
((
__u£r
 *)
¬g
, 
d©a
, 
	`_IOC_SIZE
(
cmd
)))

306  -
EFAULT
;

309  
»t
;

310 
	}
}

	@sgx_main.c

61 
	~"asm/m¤-šdex.h
"

62 
	~"sgx.h
"

63 
	~<lšux/aýi.h
>

64 
	~<lšux/fže.h
>

65 
	~<lšux/highmem.h
>

66 
	~<lšux/miscdeviû.h
>

67 
	~<lšux/moduË.h
>

68 
	~<lšux/su¥’d.h
>

69 
	~<lšux/hashbË.h
>

70 
	~<lšux/kth»ad.h
>

71 
	~<lšux/¶©fÜm_deviû.h
>

73 
	#DRV_DESCRIPTION
 "IÁ– SGX Driv”"

	)

74 
	#DRV_VERSION
 "0.10"

	)

76 
MODULE_DESCRIPTION
(
DRV_DESCRIPTION
);

77 
MODULE_AUTHOR
("Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>");

78 
MODULE_VERSION
(
DRV_VERSION
);

79 #iâdeà
X86_FEATURE_SGX


80 
	#X86_FEATURE_SGX
 (9 * 32 + 2)

	)

83 
	#FEATURE_CONTROL_SGX_ENABLE
 (1<<18)

	)

89 
wÜkqueue_¡ruù
 *
	gsgx_add_·ge_wq
;

90 
	#SGX_MAX_EPC_BANKS
 8

	)

91 
sgx_•c_bªk
 
	gsgx_•c_bªks
[
SGX_MAX_EPC_BANKS
];

92 
	gsgx_Ä_•c_bªks
;

93 
u64
 
	gsgx_’þ_size_max_32
;

94 
u64
 
	gsgx_’þ_size_max_64
;

95 
u64
 
	gsgx_xäm_mask
 = 0x3;

96 
u32
 
	gsgx_misc_»£rved
;

97 
u32
 
	gsgx_x§ve_size_tbl
[64];

99 #ifdeà
CONFIG_COMPAT


100 
	$sgx_com·t_ioùl
(
fže
 *
fž•
, 
cmd
, 
¬g
)

102  
	`sgx_ioùl
(
fž•
, 
cmd
, 
¬g
);

103 
	}
}

106 
	$sgx_mm­
(
fže
 *fže, 
vm_¬—_¡ruù
 *
vma
)

108 
vma
->
vm_Ýs
 = &
sgx_vm_Ýs
;

109 
vma
->
vm_æags
 |ð
VM_PFNMAP
 | 
VM_DONTEXPAND
 | 
VM_DONTDUMP
 | 
VM_IO
 |

110 
VM_DONTCOPY
;

113 
	}
}

115 
	$sgx_g‘_unm­³d_¬—
(
fže
 *file,

116 
addr
,

117 
Ën
,

118 
pgoff
,

119 
æags
)

121 ià(
Ën
 < 2 * 
PAGE_SIZE
 || (len & (len - 1)))

122  -
EINVAL
;

128 ià(
Ën
 > 
sgx_’þ_size_max_32
)

129 #ifdeà
CONFIG_X86_64


130 ià(
	`‹¡_th»ad_æag
(
TIF_ADDR32
))

131  -
EINVAL
;

133  -
EINVAL
;

136 #ifdeà
CONFIG_X86_64


137 ià(
Ën
 > 
sgx_’þ_size_max_64
)

138  -
EINVAL
;

141 
addr
 = 
cu¼’t
->
mm
->
	`g‘_unm­³d_¬—
(
fže
,‡ddr, 2 * 
Ën
, 
pgoff
,

142 
æags
);

143 ià(
	`IS_ERR_VALUE
(
addr
))

144  
addr
;

146 
addr
 = (add¸+ (
Ën
 - 1)) & ~(len - 1);

148  
addr
;

149 
	}
}

151 cÚ¡ 
fže_Ý”©iÚs
 
	gsgx_fÝs
 = {

152 .
owÃr
 = 
THIS_MODULE
,

153 .
	guÆocked_ioùl
 = 
sgx_ioùl
,

154 #ifdeà
CONFIG_COMPAT


155 .
	gcom·t_ioùl
 = 
sgx_com·t_ioùl
,

157 .
	gmm­
 = 
sgx_mm­
,

158 .
	gg‘_unm­³d_¬—
 = 
sgx_g‘_unm­³d_¬—
,

161 
miscdeviû
 
	gsgx_dev
 = {

162 .
mšÜ
 = 
MISC_DYNAMIC_MINOR
,

163 .
	gÇme
 = "isgx",

164 .
	gfÝs
 = &
sgx_fÝs
,

165 .
	gmode
 = 0666,

168 
	$sgx_pm_su¥’d
(
deviû
 *
dev
)

170 
sgx_tgid_ùx
 *
ùx
;

171 
sgx_’þ
 *
’þ
;

173 
	`li¡_fÜ_—ch_’Œy
(
ùx
, &
sgx_tgid_ùx_li¡
, 
li¡
) {

174 
	`li¡_fÜ_—ch_’Œy
(
’þ
, &
ùx
->
’þ_li¡
,ƒncl_list) {

175 
	`sgx_šv®id©e
(
’þ
, 
çl£
);

176 
’þ
->
æags
 |ð
SGX_ENCL_SUSPEND
;

177 
	`æush_wÜk
(&
’þ
->
add_·ge_wÜk
);

182 
	}
}

184 
SIMPLE_DEV_PM_OPS
(
sgx_drv_pm
, 
sgx_pm_su¥’d
, 
NULL
);

186 
	$sgx_dev_š™
(
deviû
 *
·»Á
)

188 
—x
, 
ebx
, 
ecx
, 
edx
;

189 
·
;

190 
size
;

191 
»t
;

192 
i
;

194 
	`´_šfo
("š‹l_sgx: " 
DRV_DESCRIPTION
 " v" 
DRV_VERSION
 "\n");

196 
	`ýuid_couÁ
(
SGX_CPUID
, 
SGX_CPUID_CAPABILITIES
, &
—x
, &
ebx
, &
ecx
, &
edx
);

198 
sgx_misc_»£rved
 = ~
ebx
 | 
SGX_MISC_RESERVED_MASK
;

199 #ifdeà
CONFIG_X86_64


200 
sgx_’þ_size_max_64
 = 1ULL << ((
edx
 >> 8) & 0xFF);

202 
sgx_’þ_size_max_32
 = 1ULL << (
edx
 & 0xFF);

204 ià(
	`boÙ_ýu_has
(
X86_FEATURE_OSXSAVE
)) {

205 
	`ýuid_couÁ
(
SGX_CPUID
, 
SGX_CPUID_ATTRIBUTES
, &
—x
, &
ebx
, &
ecx
,

206 &
edx
);

207 
sgx_xäm_mask
 = (((
u64
)
edx
è<< 32è+ (u64)
ecx
;

209 
i
 = 2; i < 64; i++) {

210 
	`ýuid_couÁ
(0x0D, 
i
, &
—x
, &
ebx
, &
ecx
, &
edx
);

211 ià((1 << 
i
è& 
sgx_xäm_mask
)

212 
sgx_x§ve_size_tbl
[
i
] = 
—x
 + 
ebx
;

216 
i
 = 0; i < 
SGX_MAX_EPC_BANKS
; i++) {

217 
	`ýuid_couÁ
(
SGX_CPUID
, 
i
 + 
SGX_CPUID_EPC_BANKS
, &
—x
, &
ebx
,

218 &
ecx
, &
edx
);

219 ià(!(
—x
 & 0xf))

222 
·
 = ((
u64
)(
ebx
 & 0xfffffè<< 32è+ (u64)(
—x
 & 0xfffff000);

223 
size
 = ((
u64
)(
edx
 & 0xfffffè<< 32è+ (u64)(
ecx
 & 0xfffff000);

225 
	`dev_šfo
(
·»Á
, "EPC bªk 0x%lx-0x%lx\n", 
·
,…¨+ 
size
);

227 
sgx_•c_bªks
[
i
].
·
 =…a;

228 
sgx_•c_bªks
[
i
].
size
 = size;

231 
sgx_Ä_•c_bªks
 = 
i
;

234 if(
sgx_Ä_•c_bªks
 == 1)

236 
sgx_•c_bªks
[0].
size
 -= 0x2180000;

237 
sgx_•c_bªks
[1].
·
 = sgx_•c_bªks[0].· + sgx_•c_bªks[0].
size
;

238 
sgx_•c_bªks
[1].
size
 = 0x2180000;

241 
i
 = 0; i < 
sgx_Ä_•c_bªks
; i++) {

242 #ifdeà
CONFIG_X86_64


243 
sgx_•c_bªks
[
i
].
va
 = ()

244 
	`iÜem­_ÿche
(
sgx_•c_bªks
[
i
].
·
,

245 
sgx_•c_bªks
[
i
].
size
);

246 ià(!
sgx_•c_bªks
[
i
].
va
) {

247 
sgx_Ä_•c_bªks
 = 
i
;

248 
»t
 = -
ENOMEM
;

249 
out_iounm­
;

252 
»t
 = 
	`sgx_add_•c_bªk
(
sgx_•c_bªks
[
i
].
·
,

253 
sgx_•c_bªks
[
i
].
size
, i);

254 ià(
»t
) {

255 
sgx_Ä_•c_bªks
 = 
i
 + 1;

256 
out_iounm­
;

261 if(
sgx_Ä_•c_bªks
 == 1)

263 #ifdeà
CONFIG_X86_64


264 
sgx_•c_bªks
[1].
va
 = ()

265 
	`iÜem­_ÿche
(
sgx_•c_bªks
[1].
·
, sgx_•c_bªks[1].
size
);

266 if(!
sgx_•c_bªks
[1].
va
){

267 
sgx_Ä_•c_bªks
 = 1;

268 
»t
 = -
ENOMEM
;

269 
out_iounm­
;

272 
»t
 = 
	`sgx_add_•c_Í_bªk
(
sgx_•c_bªks
[1].
·
, sgx_•c_bªks[1].
size
);

273 if(
»t
)

275 
sgx_Ä_•c_bªks
 = 2;

276 
out_iounm­
;

278 
sgx_Ä_•c_bªks
++;

281 
»t
 = 
	`sgx_·ge_ÿche_š™
();

282 ià(
»t
)

283 
out_iounm­
;

285 
sgx_add_·ge_wq
 = 
	`®loc_wÜkqueue
("intel_sgx-add-page-wq",

286 
WQ_UNBOUND
 | 
WQ_FREEZABLE
, 1);

287 ià(!
sgx_add_·ge_wq
) {

288 
	`´_”r
("intel_sgx:‡lloc_workqueue() failed\n");

289 
»t
 = -
ENOMEM
;

290 
out_iounm­
;

293 
sgx_dev
.
·»Á
 =…arent;

294 
»t
 = 
	`misc_»gi¡”
(&
sgx_dev
);

295 ià(
»t
) {

296 
	`´_”r
("intel_sgx: misc_register() failed\n");

297 
out_wÜkqueue
;

300 ià(
»t
)

301 
out_wÜkqueue
;

304 
out_wÜkqueue
:

305 
	`de¡roy_wÜkqueue
(
sgx_add_·ge_wq
);

306 
out_iounm­
:

307 #ifdeà
CONFIG_X86_64


308 
i
 = 0; i < 
sgx_Ä_•c_bªks
; i++)

309 
	`iounm­
((*)
sgx_•c_bªks
[
i
].
va
);

311  
»t
;

312 
	}
}

314 
©omic_t
 
	gsgx_š™_æag
 = 
ATOMIC_INIT
(0);

315 
	$sgx_drv_´obe
(
¶©fÜm_deviû
 *
pdev
)

317 
—x
, 
ebx
, 
ecx
, 
edx
;

318 
fc
;

319 ià(
	`©omic_cmpxchg
(&
sgx_š™_æag
, 0, 1)) {

320 
	`´_w¬n
("intel_sgx: second initialization call skipped\n");

325 ià(
boÙ_ýu_d©a
.
x86_v’dÜ
 !ð
X86_VENDOR_INTEL
)

326  -
ENODEV
;

328 ià(!
	`boÙ_ýu_has
(
X86_FEATURE_SGX
)) {

329 
	`´_”r
("intel_sgx:he CPU is missing SGX\n");

330  -
ENODEV
;

333 
	`rdm¤l
(
MSR_IA32_FEATURE_CONTROL
, 
fc
);

335 ià(!(
fc
 & 
FEATURE_CONTROL_LOCKED
)) {

336 
	`´_”r
("intel_sgx:he feature control MSR is‚ot†ocked\n");

337  -
ENODEV
;

340 ià(!(
fc
 & 
FEATURE_CONTROL_SGX_ENABLE
)) {

341 
	`´_”r
("intel_sgx: SGX is‚otƒnabled\n");

342  -
ENODEV
;

345 
	`ýuid
(0, &
—x
, &
ebx
, &
ecx
, &
edx
);

346 ià(
—x
 < 
SGX_CPUID
) {

347 
	`´_”r
("intel_sgx: CPUID is missinghe SGX†eaf\n");

348  -
ENODEV
;

351 
	`ýuid_couÁ
(
SGX_CPUID
, 
SGX_CPUID_CAPABILITIES
, &
—x
, &
ebx
, &
ecx
, &
edx
);

352 ià(!(
—x
 & 1)) {

353 
	`´_”r
("intel_sgx: CPU does‚ot supporthe SGX1 instructions\n");

354  -
ENODEV
;

357  
	`sgx_dev_š™
(&
pdev
->
dev
);

358 
	}
}

360 
	$sgx_drv_»move
(
¶©fÜm_deviû
 *
pdev
)

362 
i
;

364 ià(!
	`©omic_cmpxchg
(&
sgx_š™_æag
, 1, 0)) {

365 
	`´_w¬n
("intel_sgx: second„elease call skipped\n");

369 
	`misc_d”egi¡”
(&
sgx_dev
);

371 
	`de¡roy_wÜkqueue
(
sgx_add_·ge_wq
);

372 #ifdeà
CONFIG_X86_64


373 
i
 = 0; i < 
sgx_Ä_•c_bªks
; i++)

374 
	`iounm­
((*)
sgx_•c_bªks
[
i
].
va
);

376 
	`sgx_·ge_ÿche_‹¬down
();

379 
	}
}

381 #ifdeà
CONFIG_ACPI


382 
aýi_deviû_id
 
	gsgx_deviû_ids
[] = {

386 
MODULE_DEVICE_TABLE
(
aýi
, 
sgx_deviû_ids
);

389 
¶©fÜm_driv”
 
	gsgx_drv
 = {

390 .
´obe
 = 
sgx_drv_´obe
,

391 .
	g»move
 = 
sgx_drv_»move
,

392 .
	gdriv”
 = {

393 .
Çme
 = "intel_sgx",

394 .
	gpm
 = &
sgx_drv_pm
,

395 .
	gaýi_m©ch_bË
 = 
ACPI_PTR
(
sgx_deviû_ids
),

399 
¶©fÜm_deviû
 *
	gpdev
;

400 
	$š™_sgx_moduË
()

402 
	`¶©fÜm_driv”_»gi¡”
(&
sgx_drv
);

403 
pdev
 = 
	`¶©fÜm_deviû_»gi¡”_sim¶e
("š‹l_sgx", 0, 
NULL
, 0);

404 ià(
	`IS_ERR
(
pdev
))

405 
	`´_”r
("platform_device_register_simple failed\n");

407 
	}
}

409 
	$þ—nup_sgx_moduË
()

411 
	`dev_£t_uev’t_suµ»ss
(&
pdev
->
dev
, 
Œue
);

412 
	`¶©fÜm_deviû_uÄegi¡”
(
pdev
);

413 
	`¶©fÜm_driv”_uÄegi¡”
(&
sgx_drv
);

414 
	}
}

416 
moduË_š™
(
š™_sgx_moduË
);

417 
moduË_ex™
(
þ—nup_sgx_moduË
);

419 
MODULE_LICENSE
("Dual BSD/GPL");

	@sgx_page_cache.c

61 
	~"sgx.h
"

62 
	~<lšux/ä“z”.h
>

63 
	~<lšux/highmem.h
>

64 
	~<lšux/kth»ad.h
>

65 
	~<lšux/¿‹lim™.h
>

66 #ià(
LINUX_VERSION_CODE
 >ð
KERNEL_VERSION
(4, 11, 0))

67 
	~<lšux/sched/sigÇl.h
>

69 
	~<lšux/sigÇl.h
>

71 
	~<lšux/¦ab.h
>

73 
	#SGX_NR_LOW_EPC_PAGES_DEFAULT
 32

	)

74 
	#SGX_NR_SWAP_CLUSTER_MAX
 16

	)

76 
LIST_HEAD
(
sgx_ä“_li¡
);

77 
LIST_HEAD
(
sgx_ä“_Í_li¡
);

78 
DEFINE_SPINLOCK
(
sgx_ä“_li¡_lock
);

80 
LIST_HEAD
(
sgx_tgid_ùx_li¡
);

81 
DEFINE_MUTEX
(
sgx_tgid_ùx_mu‹x
);

82 
©omic_t
 
	gsgx_va_·ges_út
 = 
ATOMIC_INIT
(0);

83 
	gsgx_Ä_tÙ®_•c_·ges
;

84 
	gsgx_Ä_ä“_·ges
;

85 
	gsgx_Ä_low_·ges
 = 
SGX_NR_LOW_EPC_PAGES_DEFAULT
;

86 
	gsgx_Ä_high_·ges
;

87 
	gsgx_Ä_Í_·ges
;

88 
sk_¡ruù
 *
	gksgxsw­d_tsk
;

89 
DECLARE_WAIT_QUEUE_HEAD
(
ksgxsw­d_wa™q
);

91 
	$sgx_‹¡_ªd_þ—r_young_cb
(
±e_t
 *
±•
, 
pgbË_t
 
tok’
,

92 
addr
, *
d©a
)

94 
±e_t
 
±e
;

95 
»t
;

97 
»t
 = 
	`±e_young
(*
±•
);

98 ià(
»t
) {

99 
±e
 = 
	`±e_mkÞd
(*
±•
);

100 
	`£t_±e_©
((
mm_¡ruù
 *)
d©a
, 
addr
, 
±•
, 
±e
);

103  
»t
;

104 
	}
}

115 
	$sgx_‹¡_ªd_þ—r_young
(
sgx_’þ_·ge
 *
·ge
, 
sgx_’þ
 *
’þ
)

117 
vm_¬—_¡ruù
 *
vma
;

118 
»t
;

120 
»t
 = 
	`sgx_’þ_fšd
(
’þ
->
mm
, 
·ge
->
addr
, &
vma
);

121 ià(
»t
)

124 ià(
’þ
 !ð
vma
->
vm_´iv©e_d©a
)

127  
	`­¶y_to_·ge_¿nge
(
vma
->
vm_mm
, 
·ge
->
addr
, 
PAGE_SIZE
,

128 
sgx_‹¡_ªd_þ—r_young_cb
, 
vma
->
vm_mm
);

129 
	}
}

131 
sgx_tgid_ùx
 *
	$sgx_isÞ©e_tgid_ùx
(
Ä_to_sÿn
)

133 
sgx_tgid_ùx
 *
ùx
 = 
NULL
;

134 
i
;

136 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

138 ià(
	`li¡_em±y
(&
sgx_tgid_ùx_li¡
)) {

139 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

140  
NULL
;

143 
i
 = 0; i < 
Ä_to_sÿn
; i++) {

145 
ùx
 = 
	`li¡_fœ¡_’Œy
(&
sgx_tgid_ùx_li¡
,

146 
sgx_tgid_ùx
,

147 
li¡
);

152 
	`li¡_move_ž
(&
ùx
->
li¡
, &
sgx_tgid_ùx_li¡
);

155 ià(!
	`li¡_em±y
(&
ùx
->
’þ_li¡
) &&

156 
	`k»f_g‘_uÆess_z”o
(&
ùx
->
»fcouÁ
))

159 
ùx
 = 
NULL
;

162 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

164  
ùx
;

165 
	}
}

167 
sgx_’þ
 *
	$sgx_isÞ©e_’þ
(
sgx_tgid_ùx
 *
ùx
,

168 
Ä_to_sÿn
)

170 
sgx_’þ
 *
’þ
 = 
NULL
;

171 
i
;

173 
	`mu‹x_lock
(&
sgx_tgid_ùx_mu‹x
);

175 ià(
	`li¡_em±y
(&
ùx
->
’þ_li¡
)) {

176 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

177  
NULL
;

180 
i
 = 0; i < 
Ä_to_sÿn
; i++) {

182 
’þ
 = 
	`li¡_fœ¡_’Œy
(&
ùx
->
’þ_li¡
, 
sgx_’þ
,

183 
’þ_li¡
);

188 
	`li¡_move_ž
(&
’þ
->
’þ_li¡
, &
ùx
->encl_list);

191 ià(!
	`li¡_em±y
(&
’þ
->
lßd_li¡
) &&

192 
	`k»f_g‘_uÆess_z”o
(&
’þ
->
»fcouÁ
))

195 
’þ
 = 
NULL
;

198 
	`mu‹x_uÆock
(&
sgx_tgid_ùx_mu‹x
);

200  
’þ
;

201 
	}
}

203 
	$sgx_isÞ©e_·ges
(
sgx_’þ
 *
’þ
,

204 
li¡_h—d
 *
d¡
,

205 
Ä_to_sÿn
)

207 
sgx_•c_·ge
 *
’Œy
;

208 
i
;

210 
	`mu‹x_lock
(&
’þ
->
lock
);

212 ià(
’þ
->
æags
 & 
SGX_ENCL_DEAD
)

213 
out
;

215 
i
 = 0; i < 
Ä_to_sÿn
; i++) {

216 ià(
	`li¡_em±y
(&
’þ
->
lßd_li¡
))

219 
’Œy
 = 
	`li¡_fœ¡_’Œy
(&
’þ
->
lßd_li¡
,

220 
sgx_•c_·ge
,

221 
li¡
);

223 ià(!
	`sgx_‹¡_ªd_þ—r_young
(
’Œy
->
’þ_·ge
, 
’þ
) &&

224 !(
’Œy
->
’þ_·ge
->
æags
 & 
SGX_ENCL_PAGE_RESERVED
)) {

225 
’Œy
->
’þ_·ge
->
æags
 |ð
SGX_ENCL_PAGE_RESERVED
;

226 
	`li¡_move_ž
(&
’Œy
->
li¡
, 
d¡
);

228 
	`li¡_move_ž
(&
’Œy
->
li¡
, &
’þ
->
lßd_li¡
);

231 
out
:

232 
	`mu‹x_uÆock
(&
’þ
->
lock
);

233 
	}
}

235 
	$__sgx_ewb
(
sgx_’þ
 *
’þ
,

236 
sgx_’þ_·ge
 *
’þ_·ge
)

238 
sgx_·gešfo
 
pgšfo
;

239 
·ge
 *
backšg
;

240 
·ge
 *
pcmd
;

241 
pcmd_off£t
;

242 *
•c
;

243 *
va
;

244 
»t
;

246 
pcmd_off£t
 = ((
’þ_·ge
->
addr
 >> 
PAGE_SHIFT
) & 31) * 128;

248 
backšg
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
çl£
);

249 ià(
	`IS_ERR
(
backšg
)) {

250 
»t
 = 
	`PTR_ERR
(
backšg
);

251 
	`sgx_w¬n
(
’þ
, "pinninghe backing…age for EWB failed with %d\n",

252 
»t
);

253  
»t
;

256 
pcmd
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
Œue
);

257 ià(
	`IS_ERR
(
pcmd
)) {

258 
»t
 = 
	`PTR_ERR
(
pcmd
);

259 
	`sgx_w¬n
(
’þ
, "pinninghe…cmd…age for EWB failed with %d\n",

260 
»t
);

261 
out
;

264 
•c
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
•c_·ge
);

265 
va
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
va_·ge
->
•c_·ge
);

267 
pgšfo
.
¤ýge
 = ()
	`km­_©omic
(
backšg
);

268 
pgšfo
.
pcmd
 = ()
	`km­_©omic
Õcmdè+ 
pcmd_off£t
;

269 
pgšfo
.
lšaddr
 = 0;

270 
pgšfo
.
£cs
 = 0;

271 
»t
 = 
	`__ewb
(&
pgšfo
, 
•c
,

272 (*)(()
va
 + 
’þ_·ge
->
va_off£t
));

273 
	`kunm­_©omic
((*)()(
pgšfo
.
pcmd
 - 
pcmd_off£t
));

274 
	`kunm­_©omic
((*)()
pgšfo
.
¤ýge
);

276 
	`sgx_put_·ge
(
va
);

277 
	`sgx_put_·ge
(
•c
);

278 
	`sgx_put_backšg
(
pcmd
, 
Œue
);

280 
out
:

281 
	`sgx_put_backšg
(
backšg
, 
Œue
);

282  
»t
;

283 
	}
}

285 
boÞ
 
	$sgx_ewb
(
sgx_’þ
 *
’þ
,

286 
sgx_’þ_·ge
 *
’Œy
)

288 
»t
 = 
	`__sgx_ewb
(
’þ
, 
’Œy
);

290 ià(
»t
 =ð
SGX_NOT_TRACKED
) {

292 
	`sgx_æush_ýus
(
’þ
);

293 
»t
 = 
	`__sgx_ewb
(
’þ
, 
’Œy
);

296 ià(
»t
) {

298 
	`sgx_šv®id©e
(
’þ
, 
Œue
);

299 ià(
»t
 > 0)

300 
	`sgx_”r
(
’þ
, "EWB„‘uºed %d,ƒnþavkžËd\n", 
»t
);

301  
çl£
;

304  
Œue
;

305 
	}
}

307 
	$sgx_eviù_·ge
(
sgx_’þ_·ge
 *
’Œy
,

308 
sgx_’þ
 *
’þ
)

310 
	`sgx_ewb
(
’þ
, 
’Œy
);

311 
	`sgx_ä“_·ge
(
’Œy
->
•c_·ge
, 
’þ
);

312 
’Œy
->
•c_·ge
 = 
NULL
;

313 
’Œy
->
æags
 &ð~
SGX_ENCL_PAGE_RESERVED
;

314 
	}
}

316 
	$sgx_wr™e_·ges
(
sgx_’þ
 *
’þ
, 
li¡_h—d
 *
¤c
)

318 
sgx_•c_·ge
 *
’Œy
;

319 
sgx_•c_·ge
 *
tmp
;

320 
vm_¬—_¡ruù
 *
vma
;

321 
»t
;

323 ià(
	`li¡_em±y
(
¤c
))

326 
’Œy
 = 
	`li¡_fœ¡_’Œy
(
¤c
, 
sgx_•c_·ge
, 
li¡
);

328 
	`mu‹x_lock
(&
’þ
->
lock
);

331 
	`li¡_fÜ_—ch_’Œy_§ã
(
’Œy
, 
tmp
, 
¤c
, 
li¡
) {

332 
»t
 = 
	`sgx_’þ_fšd
(
’þ
->
mm
, 
’Œy
->
’þ_·ge
->
addr
, &
vma
);

333 ià(!
»t
 && 
’þ
 =ð
vma
->
vm_´iv©e_d©a
)

334 
	`z­_vma_±es
(
vma
, 
’Œy
->
’þ_·ge
->
addr
, 
PAGE_SIZE
);

336 
	`sgx_eblock
(
’þ
, 
’Œy
);

340 
	`sgx_‘¿ck
(
’þ
);

343 !
	`li¡_em±y
(
¤c
)) {

344 
’Œy
 = 
	`li¡_fœ¡_’Œy
(
¤c
, 
sgx_•c_·ge
, 
li¡
);

345 
	`li¡_d–
(&
’Œy
->
li¡
);

346 
	`sgx_eviù_·ge
(
’Œy
->
’þ_·ge
, 
’þ
);

347 
’þ
->
£cs_chžd_út
--;

350 ià(!
’þ
->
£cs_chžd_út
 && (’þ->
æags
 & 
SGX_ENCL_INITIALIZED
)) {

351 
	`sgx_eviù_·ge
(&
’þ
->
£cs
,ƒncl);

352 
’þ
->
æags
 |ð
SGX_ENCL_SECS_EVICTED
;

355 
	`mu‹x_uÆock
(&
’þ
->
lock
);

356 
	}
}

358 
	$sgx_sw­_·ges
(
Ä_to_sÿn
)

360 
sgx_tgid_ùx
 *
ùx
;

361 
sgx_’þ
 *
’þ
;

362 
	`LIST_HEAD
(
þu¡”
);

364 
ùx
 = 
	`sgx_isÞ©e_tgid_ùx
(
Ä_to_sÿn
);

365 ià(!
ùx
)

368 
’þ
 = 
	`sgx_isÞ©e_’þ
(
ùx
, 
Ä_to_sÿn
);

369 ià(!
’þ
)

370 
out
;

372 
	`down_»ad
(&
’þ
->
mm
->
mm­_£m
);

373 
	`sgx_isÞ©e_·ges
(
’þ
, &
þu¡”
, 
Ä_to_sÿn
);

374 
	`sgx_wr™e_·ges
(
’þ
, &
þu¡”
);

375 
	`up_»ad
(&
’þ
->
mm
->
mm­_£m
);

377 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

378 
out
:

379 
	`k»f_put
(&
ùx
->
»fcouÁ
, 
sgx_tgid_ùx_»Ëa£
);

380 
	}
}

382 
	$ksgxsw­d
(*
p
)

384 
	`£t_ä“zabË
();

386 !
	`kth»ad_should_¡Ý
()) {

387 ià(
	`Œy_to_ä“ze
())

390 
	`wa™_ev’t_ä“zabË
(
ksgxsw­d_wa™q
,

391 
	`kth»ad_should_¡Ý
() ||

392 
sgx_Ä_ä“_·ges
 < 
sgx_Ä_high_·ges
);

394 ià(
sgx_Ä_ä“_·ges
 < 
sgx_Ä_high_·ges
)

395 
	`sgx_sw­_·ges
(
SGX_NR_SWAP_CLUSTER_MAX
);

398 
	`´_šfo
("%s: dÚe\n", 
__func__
);

400 
	}
}

402 
	$sgx_add_•c_bªk
(
»sourû_size_t
 
¡¬t
, 
size
, 
bªk
)

404 
i
;

405 
sgx_•c_·ge
 *
Ãw_•c_·ge
, *
’Œy
;

406 
li¡_h—d
 *
·r£r
, *
‹mp
;

408 
i
 = 0; i < 
size
; i +ð
PAGE_SIZE
) {

409 
Ãw_•c_·ge
 = 
	`kz®loc
((*Ãw_•c_·ge), 
GFP_KERNEL
);

410 ià(!
Ãw_•c_·ge
)

411 
”r_ä“li¡
;

412 
Ãw_•c_·ge
->
·
 = (
¡¬t
 + 
i
è| 
bªk
;

414 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

415 
	`li¡_add_ž
(&
Ãw_•c_·ge
->
li¡
, &
sgx_ä“_li¡
);

416 
sgx_Ä_tÙ®_•c_·ges
++;

417 
sgx_Ä_ä“_·ges
++;

418 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

422 
”r_ä“li¡
:

423 
	`li¡_fÜ_—ch_§ã
(
·r£r
, 
‹mp
, &
sgx_ä“_li¡
) {

424 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

425 
’Œy
 = 
	`li¡_’Œy
(
·r£r
, 
sgx_•c_·ge
, 
li¡
);

426 
	`li¡_d–
(&
’Œy
->
li¡
);

427 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

428 
	`kä“
(
’Œy
);

430  -
ENOMEM
;

431 
	}
}

434 
	$sgx_add_•c_Í_bªk
(
»sourû_size_t
 
¡¬t
, 
size
)

436 
i
;

437 
sgx_•c_·ge
 *
Ãw_•c_·ge
, *
’Œy
;

438 
li¡_h—d
 *
·r£r
, *
‹mp
;

440 
i
 = 0; i < 
size
; i +ð
LARGE_PAGE_SIZE
) {

441 
Ãw_•c_·ge
 = 
	`kz®loc
((*Ãw_•c_·ge), 
GFP_KERNEL
);

442 ià(!
Ãw_•c_·ge
)

443 
”r_ä“li¡
;

444 
Ãw_•c_·ge
->
·
 = (
¡¬t
 + 
i
);

446 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

447 
	`li¡_add_ž
(&
Ãw_•c_·ge
->
li¡
, &
sgx_ä“_Í_li¡
);

448 
sgx_Ä_Í_·ges
++;

449 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

451 
	`´_šfo
("š‹l_sgx: SecÚd bªk‡dded. LP…ages=%d\n", 
sgx_Ä_Í_·ges
);

454 
”r_ä“li¡
:

455 
	`li¡_fÜ_—ch_§ã
(
·r£r
, 
‹mp
, &
sgx_ä“_li¡
) {

456 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

457 
’Œy
 = 
	`li¡_’Œy
(
·r£r
, 
sgx_•c_·ge
, 
li¡
);

458 
	`li¡_d–
(&
’Œy
->
li¡
);

459 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

460 
	`kä“
(
’Œy
);

462  -
ENOMEM
;

463 
	}
}

465 
	$sgx_·ge_ÿche_š™
()

467 
sk_¡ruù
 *
tmp
;

469 
sgx_Ä_high_·ges
 = 2 * 
sgx_Ä_low_·ges
;

471 
tmp
 = 
	`kth»ad_run
(
ksgxsw­d
, 
NULL
, "ksgxswapd");

472 ià(!
	`IS_ERR
(
tmp
))

473 
ksgxsw­d_tsk
 = 
tmp
;

474  
	`PTR_ERR_OR_ZERO
(
tmp
);

475 
	}
}

477 
	$sgx_·ge_ÿche_‹¬down
()

479 
sgx_•c_·ge
 *
’Œy
;

480 
li¡_h—d
 *
·r£r
, *
‹mp
;

482 ià(
ksgxsw­d_tsk
) {

483 
	`kth»ad_¡Ý
(
ksgxsw­d_tsk
);

484 
ksgxsw­d_tsk
 = 
NULL
;

487 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

488 
	`li¡_fÜ_—ch_§ã
(
·r£r
, 
‹mp
, &
sgx_ä“_li¡
) {

489 
’Œy
 = 
	`li¡_’Œy
(
·r£r
, 
sgx_•c_·ge
, 
li¡
);

490 
	`li¡_d–
(&
’Œy
->
li¡
);

491 
	`kä“
(
’Œy
);

493 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

494 
	}
}

496 
sgx_•c_·ge
 *
	$sgx_®loc_·ge_ç¡
()

498 
sgx_•c_·ge
 *
’Œy
 = 
NULL
;

500 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

502 ià(!
	`li¡_em±y
(&
sgx_ä“_li¡
)) {

503 
’Œy
 = 
	`li¡_fœ¡_’Œy
(&
sgx_ä“_li¡
, 
sgx_•c_·ge
,

504 
li¡
);

505 
	`li¡_d–
(&
’Œy
->
li¡
);

506 
sgx_Ä_ä“_·ges
--;

509 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

511  
’Œy
;

512 
	}
}

515 
sgx_•c_·ge
 *
	$sgx_®loc_Í_·ge_ç¡
()

517 
sgx_•c_·ge
 *
’Œy
 = 
NULL
;

519 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

521 ià(!
	`li¡_em±y
(&
sgx_ä“_Í_li¡
)) {

522 
’Œy
 = 
	`li¡_fœ¡_’Œy
(&
sgx_ä“_Í_li¡
, 
sgx_•c_·ge
,

523 
li¡
);

524 
	`li¡_d–
(&
’Œy
->
li¡
);

525 
sgx_Ä_Í_·ges
--;

528 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

530  
’Œy
;

531 
	}
}

544 
sgx_•c_·ge
 *
	$sgx_®loc_·ge
(
æags
)

546 
sgx_•c_·ge
 *
’Œy
;

549 
’Œy
 = 
	`sgx_®loc_·ge_ç¡
();

550 ià(
’Œy
)

554 ià(
	`©omic_»ad
(&
sgx_va_·ges_út
) >

555 (
sgx_Ä_tÙ®_•c_·ges
 - 2))

556  
	`ERR_PTR
(-
ENOMEM
);

558 ià(
æags
 & 
SGX_ALLOC_ATOMIC
) {

559 
’Œy
 = 
	`ERR_PTR
(-
EBUSY
);

563 ià(
	`sigÇl_³ndšg
(
cu¼’t
)) {

564 
’Œy
 = 
	`ERR_PTR
(-
ERESTARTSYS
);

568 
	`sgx_sw­_·ges
(
SGX_NR_SWAP_CLUSTER_MAX
);

569 
	`scheduË
();

572 ià(
sgx_Ä_ä“_·ges
 < 
sgx_Ä_low_·ges
)

573 
	`wake_up
(&
ksgxsw­d_wa™q
);

575  
’Œy
;

576 
	}
}

579 
sgx_•c_·ge
 *
	$sgx_®loc_Í_·ge
(
æags
)

581 
sgx_•c_·ge
 *
’Œy
;

584 
’Œy
 = 
	`sgx_®loc_Í_·ge_ç¡
();

585 ià(
’Œy
)

587 
	`´_šfo
("Large…age‡llotted from Bank 1\n");

591  
	`ERR_PTR
(-
ENOMEM
);

594  
’Œy
;

595 
	}
}

606 
	$sgx_ä“_·ge
(
sgx_•c_·ge
 *
’Œy
, 
sgx_’þ
 *
’þ
)

608 *
•c
;

609 
»t
;

611 
•c
 = 
	`sgx_g‘_·ge
(
’Œy
);

612 
»t
 = 
	`__”emove
(
•c
);

613 
	`sgx_put_·ge
(
•c
);

615 ià(
»t
)

616 
	`sgx_ü™
(
’þ
, "EREMOVE„‘uºed %d\n", 
»t
);

618 
	`¥š_lock
(&
sgx_ä“_li¡_lock
);

619 
	`li¡_add
(&
’Œy
->
li¡
, &
sgx_ä“_li¡
);

620 
sgx_Ä_ä“_·ges
++;

621 
	`¥š_uÆock
(&
sgx_ä“_li¡_lock
);

622 
	}
}

624 *
	$sgx_g‘_·ge
(
sgx_•c_·ge
 *
’Œy
)

626 #ifdeà
CONFIG_X86_32


627  
	`km­_©omic_pâ
(
	`PFN_DOWN
(
’Œy
->
·
));

629 
i
 = ((
’Œy
->
·
è& ~
PAGE_MASK
);

631  (*)(
sgx_•c_bªks
[
i
].
va
 +

632 ((
’Œy
->
·
 & 
PAGE_MASK
è- 
sgx_•c_bªks
[
i
].pa));

634 
	}
}

636 
	$sgx_put_·ge
(*
•c_·ge_vaddr
)

638 #ifdeà
CONFIG_X86_32


639 
	`kunm­_©omic
(
•c_·ge_vaddr
);

642 
	}
}

	@sgx_pmd.c

1 
	~"sgx_pmd.h
"

3 
	g±e_t
* (*
	ghuge_±e_®loc_p
)(
mm_¡ruù
 *
	gmm
,

4 
	gaddr
, 
	gsz
);

5 
	gpmd_t
* (*
	gmm_®loc_pmd_p
)(
mm_¡ruù
 *
	gmm
, 
	gadd»ss
);

6 
	g±e_t
* (*
	g__g‘_locked_±e_p
)(
mm_¡ruù
 *
	gmm
, 
	gaddr
,

7 
¥šlock_t
 **
	g±l
);

8 
	$vm_š£¹_pmd
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

9 
pâ
)

11  
	`vm_š£¹_pmd_´Ù
(
vma
, 
addr
, 
pâ
, vma->
vm_·ge_´Ù
);

12 
	}
}

14 
	$vm_š£¹_pmd_´Ù
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

15 
pâ
, 
pg´Ù_t
 
pg´Ù
)

17 
»t
;

19 ià(
addr
 < 
vma
->
vm_¡¬t
 ||‡dd¸>ðvma->
vm_’d
)

20  -
EFAULT
;

22 
»t
 = 
	`š£¹_pmd
(
vma
, 
addr
, 
	`__pâ_to_pâ_t
(
pâ
, 
PFN_DEV
), 
pg´Ù
,

23 
çl£
);

25  
»t
;

26 
	}
}

28 
	$š£¹_pmd
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

29 
pâ_t
 
pâ
, 
pg´Ù_t
 
´Ù
, 
boÞ
 
mkwr™e
)

31 
mm_¡ruù
 *
mm
 = 
vma
->
vm_mm
;

32 
»tv®
;

33 
pmd_t
 *
pmd
, 
’Œy
;

34 
¥šlock_t
 *
±l
;

36 
»tv®
 = -
ENOMEM
;

38 
mm_®loc_pmd_p
 = (*)
	`k®lsyms_lookup_Çme
("mm_alloc_pmd");

39 if(
mm_®loc_pmd_p
 =ð
NULL
)

40 
out
;

41 
pmd
 = 
	`mm_®loc_pmd_p
(
mm
, 
addr
);

42 ià(!
pmd
)

43 
out
;

45 
±l
 = 
	`pmd_lock
(
mm
, 
pmd
);

46 
»tv®
 = -
EBUSY
;

47 ià(!
	`pmd_nÚe
(*
pmd
)) {

48 ià(
mkwr™e
) {

49 ià(
	`WARN_ON_ONCE
(
	`pmd_pâ
(*
pmd
è!ð
	`pâ_t_to_pâ
(
pâ
)))

50 
out_uÆock
;

51 
’Œy
 = *
pmd
;

52 
out_mkwr™e
;

54 
out_uÆock
;

56 ià(
	`pâ_t_devm­
(
pâ
))

58 
’Œy
 = 
	`pmd_mkdevm­
((
	`pâ_t_pmd
(
pâ
, 
´Ù
)));

59 
’Œy
 = 
	`pmd_£t_æags
ÓÁry, 
_PAGE_SPECIAL
);

62 
’Œy
 = 
	`pmd_£t_æags
((
	`pâ_t_pmd
(
pâ
, 
´Ù
)), 
_PAGE_SPECIAL
);

63 
’Œy
 = 
	`pmd_mkhuge
(entry);

65 
out_mkwr™e
:

66 ià(
mkwr™e
) {

67 
’Œy
 = 
	`pmd_mkyoung
(entry);

68 
’Œy
 = 
	`pmd_mkdœty
(entry);

69 if(
vma
->
vm_æags
 & 
VM_WRITE
)

70 
’Œy
 = 
	`pmd_mkwr™e
(entry);

73 
	`£t_pmd_©
(
mm
, 
addr
, 
pmd
, 
’Œy
);

74 
	`upd©e_mmu_ÿche_pmd
(
vma
, 
addr
, 
pmd
);

75 
	`´_šfo
("PMDƒÁry cÚ‹Ás: 0x%lx\n", *
pmd
);

76 
»tv®
 = 0;

77 
out_uÆock
:

78 
	`¥š_uÆock
(
±l
);

79 
out
:

80  
»tv®
;

81 
	}
}

	@sgx_pmd.h

1 
	~"sgx.h
"

2 
	~<lšux/mm.h
>

3 
	~<lšux/pâ_t.h
>

4 
	~<lšux/hug‘lb.h
>

5 
	~<lšux/k®lsyms.h
>

7 
vm_š£¹_pmd
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

8 
pâ
);

9 
vm_š£¹_pmd_´Ù
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

10 
pâ
, 
pg´Ù_t
 
pg´Ù
);

11 
š£¹_pmd
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

12 
pâ_t
 
pâ
, 
pg´Ù_t
 
´Ù
, 
boÞ
 
mkwr™e
);

	@sgx_user.h

58 #iâdeà
_UAPI_ASM_X86_SGX_H


59 
	#_UAPI_ASM_X86_SGX_H


	)

61 
	~<lšux/ty³s.h
>

62 
	~<lšux/ioùl.h
>

64 
	#SGX_MAGIC
 0xA4

	)

66 
	#SGX_IOC_ENCLAVE_CREATE
 \

67 
	`_IOW
(
SGX_MAGIC
, 0x00, 
sgx_’þave_ü—‹
)

	)

68 
	#SGX_IOC_ENCLAVE_ADD_PAGE
 \

69 
	`_IOW
(
SGX_MAGIC
, 0x01, 
sgx_’þave_add_·ge
)

	)

70 
	#SGX_IOC_ENCLAVE_INIT
 \

71 
	`_IOW
(
SGX_MAGIC
, 0x02, 
sgx_’þave_š™
)

	)

74 
	#SGX_SUCCESS
 0

	)

75 
	#SGX_INVALID_SIG_STRUCT
 1

	)

76 
	#SGX_INVALID_ATTRIBUTE
 2

	)

77 
	#SGX_BLKSTATE
 3

	)

78 
	#SGX_INVALID_MEASUREMENT
 4

	)

79 
	#SGX_NOTBLOCKABLE
 5

	)

80 
	#SGX_PG_INVLD
 6

	)

81 
	#SGX_LOCKFAIL
 7

	)

82 
	#SGX_INVALID_SIGNATURE
 8

	)

83 
	#SGX_MAC_COMPARE_FAIL
 9

	)

84 
	#SGX_PAGE_NOT_BLOCKED
 10

	)

85 
	#SGX_NOT_TRACKED
 11

	)

86 
	#SGX_VA_SLOT_OCCUPIED
 12

	)

87 
	#SGX_CHILD_PRESENT
 13

	)

88 
	#SGX_ENCLAVE_ACT
 14

	)

89 
	#SGX_ENTRYEPOCH_LOCKED
 15

	)

90 
	#SGX_INVALID_EINITTOKEN
 16

	)

91 
	#SGX_PREV_TRK_INCMPL
 17

	)

92 
	#SGX_PG_IS_SECS
 18

	)

93 
	#SGX_INVALID_CPUSVN
 32

	)

94 
	#SGX_INVALID_ISVSVN
 64

	)

95 
	#SGX_UNMASKED_EVENT
 128

	)

96 
	#SGX_INVALID_KEYNAME
 256

	)

99 
	#SGX_POWER_LOST_ENCLAVE
 0x40000000

	)

100 
	#SGX_LE_ROLLBACK
 0x40000001

	)

107 
	ssgx_’þave_ü—‹
 {

108 
__u64
 
	m¤c
;

109 } 
__©Œibu‹__
((
__·cked__
));

119 
	ssgx_’þave_add_·ge
 {

120 
__u64
 
	maddr
;

121 
__u64
 
	m¤c
;

122 
__u64
 
	m£cšfo
;

123 
__u16
 
	mmrmask
;

124 
__u16
 
	mÏrge_·ge
;

125 } 
__©Œibu‹__
((
__·cked__
));

134 
	ssgx_’þave_š™
 {

135 
__u64
 
	maddr
;

136 
__u64
 
	msig¡ruù
;

137 
__u64
 
	meš™tok’
;

138 } 
__©Œibu‹__
((
__·cked__
));

	@sgx_util.c

61 
	~"sgx.h
"

62 
	~<lšux/highmem.h
>

63 
	~<lšux/shmem_fs.h
>

64 #ià(
LINUX_VERSION_CODE
 >ð
KERNEL_VERSION
(4, 11, 0))

65 
	~<lšux/sched/mm.h
>

67 
	~<lšux/mm.h
>

69 
	~<lšux/k®lsyms.h
>

71 (*
shmem_g‘·ge_p
)(
šode
 *šode, 
pgoff_t
 
šdex
,

72 
·ge
 **
·g•
, 
sgp_ty³
 
sgp
);

74 
·ge
 *
	$sgx_g‘_backšg
(
sgx_’þ
 *
’þ
,

75 
sgx_’þ_·ge
 *
’Œy
,

76 
boÞ
 
pcmd
)

78 
šode
 *inode;

79 
add»ss_¥aû
 *
m­pšg
;

80 
gå_t
 
gåmask
;

81 
pgoff_t
 
šdex
;

83 ià(
pcmd
)

84 
šode
 = 
’þ
->
pcmd
->
f_·th
.
d’Œy
->
d_šode
;

86 
šode
 = 
’þ
->
backšg
->
f_·th
.
d’Œy
->
d_šode
;

88 
m­pšg
 = 
šode
->
i_m­pšg
;

89 
gåmask
 = 
	`m­pšg_gå_mask
(
m­pšg
);

91 ià(
pcmd
)

92 
šdex
 = (
’Œy
->
addr
 - 
’þ
->
ba£
è>> (
PAGE_SHIFT
 + 5);

94 
šdex
 = (
’Œy
->
addr
 - 
’þ
->
ba£
è>> 
PAGE_SHIFT
;

97 if(
’Œy
->
·ge_size
 =ð
LARGE_PAGE_SIZE
)

99 
·ge
 *page;

100 
”rÜ
;

102 
”rÜ
 = -
EINVAL
;

104 
shmem_g‘·ge_p
 = (*è
	`k®lsyms_lookup_Çme
("shmem_getpage");

105 if(
shmem_g‘·ge_p
 =ð
NULL
)

107 
	`´_”r
("Kernel symbol %s‚ot found \n", "shmem_getpage");

108  
	`ERR_PTR
(
”rÜ
);

110 
”rÜ
 = 
	`shmem_g‘·ge_p
(
m­pšg
->
ho¡
, 
šdex
, &
·ge
, 
SGP_HUGE
);

111 if(
”rÜ
)

112 
·ge
 = 
	`ERR_PTR
(
”rÜ
);

114 
	`uÆock_·ge
(
·ge
);

116  
·ge
;

119  
	`shmem_»ad_m­pšg_·ge_gå
(
m­pšg
, 
šdex
, 
gåmask
);

120 
	}
}

122 
	$sgx_put_backšg
(
·ge
 *
backšg_·ge
, 
boÞ
 
wr™e
)

124 ià(
wr™e
)

125 
	`£t_·ge_dœty
(
backšg_·ge
);

127 
	`put_·ge
(
backšg_·ge
);

128 
	}
}

130 
	$sgx_z­_tcs_±es
(
sgx_’þ
 *
’þ
, 
vm_¬—_¡ruù
 *
vma
)

132 
sgx_•c_·ge
 *
tmp
;

133 
sgx_’þ_·ge
 *
’Œy
;

135 
	`li¡_fÜ_—ch_’Œy
(
tmp
, &
’þ
->
lßd_li¡
, 
li¡
) {

136 
’Œy
 = 
tmp
->
’þ_·ge
;

137 ià((
’Œy
->
æags
 & 
SGX_ENCL_PAGE_TCS
) &&

138 
’Œy
->
addr
 >ð
vma
->
vm_¡¬t
 &&

139 
’Œy
->
addr
 < 
vma
->
vm_’d
)

140 
	`z­_vma_±es
(
vma
, 
’Œy
->
addr
, 
PAGE_SIZE
);

142 
	}
}

144 
	$sgx_šv®id©e
(
sgx_’þ
 *
’þ
, 
boÞ
 
æush_ýus
)

146 
vm_¬—_¡ruù
 *
vma
;

147 
addr
;

148 
»t
;

150 
addr
 = 
’þ
->
ba£
;‡dd¸< (’þ->ba£ +ƒnþ->
size
);

151 
addr
 = 
vma
->
vm_’d
) {

152 
»t
 = 
	`sgx_’þ_fšd
(
’þ
->
mm
, 
addr
, &
vma
);

153 ià(!
»t
 && 
’þ
 =ð
vma
->
vm_´iv©e_d©a
)

154 
	`sgx_z­_tcs_±es
(
’þ
, 
vma
);

159 
’þ
->
æags
 |ð
SGX_ENCL_DEAD
;

161 ià(
æush_ýus
)

162 
	`sgx_æush_ýus
(
’þ
);

163 
	}
}

165 
	$sgx_i_cb
(*
šfo
)

167 
	}
}

169 
	$sgx_æush_ýus
(
sgx_’þ
 *
’þ
)

171 
	`Ú_—ch_ýu_mask
(
	`mm_ýumask
(
’þ
->
mm
), 
sgx_i_cb
, 
NULL
, 1);

172 
	}
}

174 
	$sgx_–du
(
sgx_’þ
 *
’þ
,

175 
sgx_’þ_·ge
 *
’þ_·ge
,

176 
sgx_•c_·ge
 *
•c_·ge
,

177 
boÞ
 
is_£cs
)

179 
·ge
 *
backšg
;

180 
·ge
 *
pcmd
;

181 
pcmd_off£t
;

182 
sgx_·gešfo
 
pgšfo
;

183 *
£cs_±r
 = 
NULL
;

184 *
•c_±r
;

185 *
va_±r
;

186 
»t
;

188 
pcmd_off£t
 = ((
’þ_·ge
->
addr
 >> 
PAGE_SHIFT
) & 31) * 128;

190 
backšg
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
çl£
);

191 ià(
	`IS_ERR
(
backšg
)) {

192 
»t
 = 
	`PTR_ERR
(
backšg
);

193 
	`sgx_w¬n
(
’þ
, "pinninghe backing…age for ELDU failed with %d\n",

194 
»t
);

195  
»t
;

198 
pcmd
 = 
	`sgx_g‘_backšg
(
’þ
, 
’þ_·ge
, 
Œue
);

199 ià(
	`IS_ERR
(
pcmd
)) {

200 
»t
 = 
	`PTR_ERR
(
pcmd
);

201 
	`sgx_w¬n
(
’þ
, "pinninghe…cmd…age for EWB failed with %d\n",

202 
»t
);

203 
out
;

206 ià(!
is_£cs
)

207 
£cs_±r
 = 
	`sgx_g‘_·ge
(
’þ
->
£cs
.
•c_·ge
);

209 
•c_±r
 = 
	`sgx_g‘_·ge
(
•c_·ge
);

210 
va_±r
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
va_·ge
->
•c_·ge
);

211 
pgšfo
.
¤ýge
 = ()
	`km­_©omic
(
backšg
);

212 
pgšfo
.
pcmd
 = ()
	`km­_©omic
Õcmdè+ 
pcmd_off£t
;

213 
pgšfo
.
lšaddr
 = 
is_£cs
 ? 0 : 
’þ_·ge
->
addr
;

214 
pgšfo
.
£cs
 = ()
£cs_±r
;

216 
»t
 = 
	`__–du
(()&
pgšfo
,

217 ()
•c_±r
,

218 ()
va_±r
 +

219 
’þ_·ge
->
va_off£t
);

220 ià(
»t
) {

221 
	`sgx_”r
(
’þ
, "ELDU„‘uºed %d\n", 
»t
);

222 
»t
 = -
EFAULT
;

225 
	`kunm­_©omic
((*)()(
pgšfo
.
pcmd
 - 
pcmd_off£t
));

226 
	`kunm­_©omic
((*)()
pgšfo
.
¤ýge
);

227 
	`sgx_put_·ge
(
va_±r
);

228 
	`sgx_put_·ge
(
•c_±r
);

230 ià(!
is_£cs
)

231 
	`sgx_put_·ge
(
£cs_±r
);

233 
	`sgx_put_backšg
(
pcmd
, 
çl£
);

235 
out
:

236 
	`sgx_put_backšg
(
backšg
, 
çl£
);

237  
»t
;

238 
	}
}

240 
sgx_’þ_·ge
 *
	$sgx_do_çuÉ
(
vm_¬—_¡ruù
 *
vma
,

241 
addr
,

242 
æags
)

244 
sgx_’þ
 *
’þ
 = 
vma
->
vm_´iv©e_d©a
;

245 
sgx_’þ_·ge
 *
’Œy
;

246 
sgx_•c_·ge
 *
•c_·ge
 = 
NULL
;

247 
sgx_•c_·ge
 *
£cs_•c_·ge
 = 
NULL
;

248 
boÞ
 
»£rve
 = (
æags
 & 
SGX_FAULT_RESERVE
) != 0;

249 
rc
 = 0;

254 ià(!
’þ
)

255  
	`ERR_PTR
(-
EFAULT
);

257 
	`mu‹x_lock
(&
’þ
->
lock
);

259 
’Œy
 = 
	`¿dix_Œ“_lookup
(&
’þ
->
·ge_Œ“
, 
addr
 >> 
PAGE_SHIFT
);

260 ià(!
’Œy
) {

261 
rc
 = -
EFAULT
;

262 
out
;

265 ià(
’þ
->
æags
 & 
SGX_ENCL_DEAD
) {

266 
rc
 = -
EFAULT
;

267 
out
;

270 ià(!(
’þ
->
æags
 & 
SGX_ENCL_INITIALIZED
)) {

271 
	`sgx_dbg
(
’þ
, "cannot fault, unitialized\n");

272 
rc
 = -
EFAULT
;

273 
out
;

276 ià(
»£rve
 && (
’Œy
->
æags
 & 
SGX_ENCL_PAGE_RESERVED
)) {

277 
	`sgx_dbg
(
’þ
, "cannot fault, 0x%p is„eserved\n",

278 (*)
’Œy
->
addr
);

279 
rc
 = -
EBUSY
;

280 
out
;

284 ià(
’Œy
->
•c_·ge
) {

285 ià(
»£rve
)

286 
’Œy
->
æags
 |ð
SGX_ENCL_PAGE_RESERVED
;

287 
out
;

290 
•c_·ge
 = 
	`sgx_®loc_·ge
(
SGX_ALLOC_ATOMIC
);

291 ià(
	`IS_ERR
(
•c_·ge
)) {

292 
rc
 = 
	`PTR_ERR
(
•c_·ge
);

293 
•c_·ge
 = 
NULL
;

294 
out
;

298 ià(
’þ
->
æags
 & 
SGX_ENCL_SECS_EVICTED
) {

299 
£cs_•c_·ge
 = 
	`sgx_®loc_·ge
(
SGX_ALLOC_ATOMIC
);

300 ià(
	`IS_ERR
(
£cs_•c_·ge
)) {

301 
rc
 = 
	`PTR_ERR
(
£cs_•c_·ge
);

302 
£cs_•c_·ge
 = 
NULL
;

303 
out
;

306 
rc
 = 
	`sgx_–du
(
’þ
, &’þ->
£cs
, 
£cs_•c_·ge
, 
Œue
);

307 ià(
rc
)

308 
out
;

310 
’þ
->
£cs
.
•c_·ge
 = 
£cs_•c_·ge
;

311 
’þ
->
æags
 &ð~
SGX_ENCL_SECS_EVICTED
;

314 
£cs_•c_·ge
 = 
NULL
;

317 
rc
 = 
	`sgx_–du
(
’þ
, 
’Œy
, 
•c_·ge
, 
çl£
 );

318 ià(
rc
)

319 
out
;

327 
’þ
->
£cs_chžd_út
++;

329 
•c_·ge
->
’þ_·ge
 = 
’Œy
;

330 
’Œy
->
•c_·ge
 =ƒpc_page;

332 ià(
»£rve
)

333 
’Œy
->
æags
 |ð
SGX_ENCL_PAGE_RESERVED
;

336 
•c_·ge
 = 
NULL
;

337 
	`li¡_add_ž
(&
’Œy
->
•c_·ge
->
li¡
, &
’þ
->
lßd_li¡
);

339 
rc
 = 
	`vm_š£¹_pâ
(
vma
, 
’Œy
->
addr
, 
	`PFN_DOWN
ÓÁry->
•c_·ge
->
·
));

340 ià(
rc
) {

344 
	`sgx_ü™
(
’þ
, "vm_š£¹_pâ„‘uºed %d\n", 
rc
);

345 
	`sgx_šv®id©e
(
’þ
, 
Œue
);

346 
out
;

349 
	`sgx_‹¡_ªd_þ—r_young
(
’Œy
, 
’þ
);

350 
out
:

351 
	`mu‹x_uÆock
(&
’þ
->
lock
);

352 ià(
•c_·ge
)

353 
	`sgx_ä“_·ge
(
•c_·ge
, 
’þ
);

354 ià(
£cs_•c_·ge
)

355 
	`sgx_ä“_·ge
(
£cs_•c_·ge
, 
’þ
);

356  
rc
 ? 
	`ERR_PTR
Ôcè: 
’Œy
;

357 
	}
}

359 
sgx_’þ_·ge
 *
	$sgx_çuÉ_·ge
(
vm_¬—_¡ruù
 *
vma
,

360 
addr
,

361 
æags
)

363 
sgx_’þ_·ge
 *
’Œy
;

366 
’Œy
 = 
	`sgx_do_çuÉ
(
vma
, 
addr
, 
æags
);

367 ià(!(
æags
 & 
SGX_FAULT_RESERVE
))

369 } 
	`PTR_ERR
(
’Œy
è=ð-
EBUSY
);

371  
’Œy
;

372 
	}
}

374 
	$sgx_eblock
(
sgx_’þ
 *
’þ
, 
sgx_•c_·ge
 *
•c_·ge
)

376 *
vaddr
;

377 
»t
;

379 
vaddr
 = 
	`sgx_g‘_·ge
(
•c_·ge
);

380 
»t
 = 
	`__eblock
(()
vaddr
);

381 
	`sgx_put_·ge
(
vaddr
);

383 ià(
»t
) {

384 
	`sgx_ü™
(
’þ
, "EBLOCK„‘uºed %d\n", 
»t
);

385 
	`sgx_šv®id©e
(
’þ
, 
Œue
);

388 
	}
}

390 
	$sgx_‘¿ck
(
sgx_’þ
 *
’þ
)

392 *
•c
;

393 
»t
;

395 
•c
 = 
	`sgx_g‘_·ge
(
’þ
->
£cs
.
•c_·ge
);

396 
»t
 = 
	`__‘¿ck
(
•c
);

397 
	`sgx_put_·ge
(
•c
);

399 ià(
»t
) {

400 
	`sgx_ü™
(
’þ
, "ETRACK„‘uºed %d\n", 
»t
);

401 
	`sgx_šv®id©e
(
’þ
, 
Œue
);

403 
	}
}

	@sgx_vma.c

61 
	~"sgx.h
"

62 
	~<asm/mmª.h
>

63 
	~<lšux/d–ay.h
>

64 
	~<lšux/fže.h
>

65 
	~<lšux/highmem.h
>

66 
	~<lšux/¿‹lim™.h
>

67 
	~<lšux/¦ab.h
>

68 
	~<lšux/hashbË.h
>

69 
	~<lšux/shmem_fs.h
>

70 
	~<lšux/mm.h
>

72 
	$sgx_vma_Ý’
(
vm_¬—_¡ruù
 *
vma
)

74 
sgx_’þ
 *
’þ
 = 
vma
->
vm_´iv©e_d©a
;

76 ià(!
’þ
)

82 
	`k»f_g‘
(&
’þ
->
»fcouÁ
);

83 
	}
}

85 
	$sgx_vma_þo£
(
vm_¬—_¡ruù
 *
vma
)

87 
sgx_’þ
 *
’þ
 = 
vma
->
vm_´iv©e_d©a
;

89 ià(!
’þ
)

92 
	`mu‹x_lock
(&
’þ
->
lock
);

93 
	`z­_vma_±es
(
vma
, vma->
vm_¡¬t
, vma->
vm_’d
 - vma->vm_start);

94 
’þ
->
æags
 |ð
SGX_ENCL_DEAD
;

95 
	`mu‹x_uÆock
(&
’þ
->
lock
);

96 
	`k»f_put
(&
’þ
->
»fcouÁ
, 
sgx_’þ_»Ëa£
);

97 
	}
}

99 #ià(
LINUX_VERSION_CODE
 >ð
KERNEL_VERSION
(4,11,0))

100 
	$sgx_vma_çuÉ
(
vm_çuÉ
 *
vmf
)

102 
vm_¬—_¡ruù
 *
vma
 = 
vmf
->vma;

104 
	$sgx_vma_çuÉ
(
vm_¬—_¡ruù
 *
vma
, 
vm_çuÉ
 *
vmf
)

109 #ià(
LINUX_VERSION_CODE
 >ð
	`KERNEL_VERSION
(4,10,0))

110 
addr
 = ()
vmf
->
add»ss
;

112 
addr
 = (è
vmf
->
vœtu®_add»ss
;

114 
sgx_’þ_·ge
 *
’Œy
;

116 
’Œy
 = 
	`sgx_çuÉ_·ge
(
vma
, 
addr
, 0);

118 ià(!
	`IS_ERR
(
’Œy
è|| 
	`PTR_ERR
ÓÁryè=ð-
EBUSY
)

119  
VM_FAULT_NOPAGE
;

121  
VM_FAULT_SIGBUS
;

122 
	}
}

124 
šlše
 
	$sgx_vma_acûss_wÜd
(
sgx_’þ
 *
’þ
,

125 
addr
,

126 *
buf
,

127 
Ën
,

128 
wr™e
,

129 
sgx_’þ_·ge
 *
’þ_·ge
,

130 
i
)

132 
d©a
[()];

133 
®ign
, 
út
, 
off£t
;

134 *
vaddr
;

135 
»t
;

137 
off£t
 = ((
addr
 + 
i
è& (
PAGE_SIZE
 - 1)) & ~(() - 1);

138 
®ign
 = (
addr
 + 
i
) & (() - 1);

139 
út
 = (è- 
®ign
;

140 
út
 = 
	`mš
(út, 
Ën
 - 
i
);

142 ià(
wr™e
) {

143 ià(
’þ_·ge
->
æags
 & 
SGX_ENCL_PAGE_TCS
 &&

144 (
off£t
 < 8 || (off£ˆ+ (
Ën
 - 
i
)) > 16))

145  -
ECANCELED
;

147 ià(
®ign
 || (
út
 != ())) {

148 
vaddr
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
•c_·ge
);

149 
»t
 = 
	`__edbgrd
((*)(()
vaddr
 + 
off£t
),

150 (*)
d©a
);

151 
	`sgx_put_·ge
(
vaddr
);

152 ià(
»t
) {

153 
	`sgx_dbg
(
’þ
, "EDBGRD„‘uºed %d\n", 
»t
);

154  -
EFAULT
;

158 
	`memýy
(
d©a
 + 
®ign
, 
buf
 + 
i
, 
út
);

159 
vaddr
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
•c_·ge
);

160 
»t
 = 
	`__edbgwr
((*)(()
vaddr
 + 
off£t
),

161 (*)
d©a
);

162 
	`sgx_put_·ge
(
vaddr
);

163 ià(
»t
) {

164 
	`sgx_dbg
(
’þ
, "EDBGWR„‘uºed %d\n", 
»t
);

165  -
EFAULT
;

168 ià(
’þ_·ge
->
æags
 & 
SGX_ENCL_PAGE_TCS
 &&

169 (
off£t
 + (
Ën
 - 
i
)) > 72)

170  -
ECANCELED
;

172 
vaddr
 = 
	`sgx_g‘_·ge
(
’þ_·ge
->
•c_·ge
);

173 
»t
 = 
	`__edbgrd
((*)(()
vaddr
 + 
off£t
),

174 (*)
d©a
);

175 
	`sgx_put_·ge
(
vaddr
);

176 ià(
»t
) {

177 
	`sgx_dbg
(
’þ
, "EDBGRD„‘uºed %d\n", 
»t
);

178  -
EFAULT
;

181 
	`memýy
(
buf
 + 
i
, 
d©a
 + 
®ign
, 
út
);

184  
út
;

185 
	}
}

187 
	$sgx_vma_acûss
(
vm_¬—_¡ruù
 *
vma
, 
addr
,

188 *
buf
, 
Ën
, 
wr™e
)

190 
sgx_’þ
 *
’þ
 = 
vma
->
vm_´iv©e_d©a
;

191 
sgx_’þ_·ge
 *
’Œy
 = 
NULL
;

192 cÚ¡ *
Ý_¡r
 = 
wr™e
 ? "EDBGWR" : "EDBGRD";

193 
»t
 = 0;

194 
i
;

199 ià(!
’þ
)

200  -
EFAULT
;

202 ià(!(
’þ
->
æags
 & 
SGX_ENCL_DEBUG
) ||

203 !(
’þ
->
æags
 & 
SGX_ENCL_INITIALIZED
) ||

204 (
’þ
->
æags
 & 
SGX_ENCL_DEAD
))

205  -
EFAULT
;

207 
	`sgx_dbg
(
’þ
, "% addr=0x%lx,†’=%d\n", 
Ý_¡r
, 
addr
, 
Ën
);

209 
i
 = 0; i < 
Ën
; i +ð
»t
) {

210 ià(!
’Œy
 || !((
addr
 + 
i
è& (
PAGE_SIZE
 - 1))) {

211 ià(
’Œy
)

212 
’Œy
->
æags
 &ð~
SGX_ENCL_PAGE_RESERVED
;

214 
’Œy
 = 
	`sgx_çuÉ_·ge
(
vma
, (
addr
 + 
i
è& 
PAGE_MASK
,

215 
SGX_FAULT_RESERVE
);

216 ià(
	`IS_ERR
(
’Œy
)) {

217 
»t
 = 
	`PTR_ERR
(
’Œy
);

218 
’Œy
 = 
NULL
;

226 
»t
 = 
	`sgx_vma_acûss_wÜd
(
’þ
, 
addr
, 
buf
, 
Ën
, 
wr™e
,

227 
’Œy
, 
i
);

228 ià(
»t
 < 0)

232 ià(
’Œy
)

233 
’Œy
->
æags
 &ð~
SGX_ENCL_PAGE_RESERVED
;

235  (
»t
 < 0 &&„‘ !ð-
ECANCELED
è?„‘ : 
i
;

236 
	}
}

238 cÚ¡ 
vm_Ý”©iÚs_¡ruù
 
	gsgx_vm_Ýs
 = {

239 .
þo£
 = 
sgx_vma_þo£
,

240 .
	gÝ’
 = 
sgx_vma_Ý’
,

241 .
	gçuÉ
 = 
sgx_vma_çuÉ
,

242 .
	gacûss
 = 
sgx_vma_acûss
,

	@/usr/include/asm/mman.h

1 #iâdeà
_ASM_X86_MMAN_H


2 
	#_ASM_X86_MMAN_H


	)

4 
	#MAP_32BIT
 0x40

	)

6 
	#MAP_HUGE_2MB
 (21 << 
MAP_HUGE_SHIFT
)

	)

7 
	#MAP_HUGE_1GB
 (30 << 
MAP_HUGE_SHIFT
)

	)

9 
	~<asm-g’”ic/mmª.h
>

	@/usr/include/asm/msr-index.h

1 #iâdeà
_ASM_X86_MSR_INDEX_H


2 
	#_ASM_X86_MSR_INDEX_H


	)

7 
	#MSR_EFER
 0xc0000080

	)

8 
	#MSR_STAR
 0xc0000081

	)

9 
	#MSR_LSTAR
 0xc0000082

	)

10 
	#MSR_CSTAR
 0xc0000083

	)

11 
	#MSR_SYSCALL_MASK
 0xc0000084

	)

12 
	#MSR_FS_BASE
 0xc0000100

	)

13 
	#MSR_GS_BASE
 0xc0000101

	)

14 
	#MSR_KERNEL_GS_BASE
 0xc0000102

	)

15 
	#MSR_TSC_AUX
 0xc0000103

	)

18 
	#_EFER_SCE
 0

	)

19 
	#_EFER_LME
 8

	)

20 
	#_EFER_LMA
 10

	)

21 
	#_EFER_NX
 11

	)

22 
	#_EFER_SVME
 12

	)

23 
	#_EFER_LMSLE
 13

	)

24 
	#_EFER_FFXSR
 14

	)

26 
	#EFER_SCE
 (1<<
_EFER_SCE
)

	)

27 
	#EFER_LME
 (1<<
_EFER_LME
)

	)

28 
	#EFER_LMA
 (1<<
_EFER_LMA
)

	)

29 
	#EFER_NX
 (1<<
_EFER_NX
)

	)

30 
	#EFER_SVME
 (1<<
_EFER_SVME
)

	)

31 
	#EFER_LMSLE
 (1<<
_EFER_LMSLE
)

	)

32 
	#EFER_FFXSR
 (1<<
_EFER_FFXSR
)

	)

35 
	#MSR_IA32_SPEC_CTRL
 0x00000048

	)

36 
	#SPEC_CTRL_IBRS
 (1 << 0è

	)

37 
	#SPEC_CTRL_STIBP
 (1 << 1è

	)

38 
	#SPEC_CTRL_SSBD_SHIFT
 2

	)

39 
	#SPEC_CTRL_SSBD
 (1 << 
SPEC_CTRL_SSBD_SHIFT
è

	)

41 
	#MSR_IA32_PRED_CMD
 0x00000049

	)

42 
	#PRED_CMD_IBPB
 (1 << 0è

	)

44 
	#MSR_IA32_PERFCTR0
 0x000000c1

	)

45 
	#MSR_IA32_PERFCTR1
 0x000000c2

	)

46 
	#MSR_FSB_FREQ
 0x000000cd

	)

47 
	#MSR_PLATFORM_INFO
 0x000000û

	)

49 
	#MSR_NHM_SNB_PKG_CST_CFG_CTL
 0x000000e2

	)

50 
	#NHM_C3_AUTO_DEMOTE
 (1UL << 25)

	)

51 
	#NHM_C1_AUTO_DEMOTE
 (1UL << 26)

	)

52 
	#ATM_LNC_C6_AUTO_DEMOTE
 (1UL << 25)

	)

53 
	#SNB_C1_AUTO_UNDEMOTE
 (1UL << 27)

	)

54 
	#SNB_C3_AUTO_UNDEMOTE
 (1UL << 28)

	)

56 
	#MSR_MTRRÿp
 0x000000ã

	)

58 
	#MSR_IA32_ARCH_CAPABILITIES
 0x0000010a

	)

59 
	#ARCH_CAP_RDCL_NO
 (1 << 0è

	)

60 
	#ARCH_CAP_IBRS_ALL
 (1 << 1è

	)

61 
	#ARCH_CAP_SKIP_VMENTRY_L1DFLUSH
 (1 << 3è

	)

62 
	#ARCH_CAP_SSB_NO
 (1 << 4è

	)

68 
	#MSR_IA32_FLUSH_CMD
 0x0000010b

	)

69 
	#L1D_FLUSH
 (1 << 0è

	)

74 
	#MSR_IA32_BBL_CR_CTL
 0x00000119

	)

75 
	#MSR_IA32_BBL_CR_CTL3
 0x0000011e

	)

77 
	#MSR_IA32_SYSENTER_CS
 0x00000174

	)

78 
	#MSR_IA32_SYSENTER_ESP
 0x00000175

	)

79 
	#MSR_IA32_SYSENTER_EIP
 0x00000176

	)

81 
	#MSR_IA32_MCG_CAP
 0x00000179

	)

82 
	#MSR_IA32_MCG_STATUS
 0x0000017a

	)

83 
	#MSR_IA32_MCG_CTL
 0x0000017b

	)

84 
	#MSR_IA32_MCG_EXT_CTL
 0x000004d0

	)

86 
	#MSR_OFFCORE_RSP_0
 0x000001a6

	)

87 
	#MSR_OFFCORE_RSP_1
 0x000001a7

	)

88 
	#MSR_NHM_TURBO_RATIO_LIMIT
 0x000001ad

	)

89 
	#MSR_IVT_TURBO_RATIO_LIMIT
 0x000001«

	)

90 
	#MSR_TURBO_RATIO_LIMIT
 0x000001ad

	)

91 
	#MSR_TURBO_RATIO_LIMIT1
 0x000001«

	)

92 
	#MSR_TURBO_RATIO_LIMIT2
 0x000001af

	)

94 
	#MSR_LBR_SELECT
 0x000001c8

	)

95 
	#MSR_LBR_TOS
 0x000001c9

	)

96 
	#MSR_LBR_NHM_FROM
 0x00000680

	)

97 
	#MSR_LBR_NHM_TO
 0x000006c0

	)

98 
	#MSR_LBR_CORE_FROM
 0x00000040

	)

99 
	#MSR_LBR_CORE_TO
 0x00000060

	)

101 
	#MSR_LBR_INFO_0
 0x00000dc0

	)

102 
	#LBR_INFO_MISPRED
 
	`BIT_ULL
(63)

	)

103 
	#LBR_INFO_IN_TX
 
	`BIT_ULL
(62)

	)

104 
	#LBR_INFO_ABORT
 
	`BIT_ULL
(61)

	)

105 
	#LBR_INFO_CYCLES
 0xffff

	)

107 
	#MSR_IA32_PEBS_ENABLE
 0x000003f1

	)

108 
	#MSR_IA32_DS_AREA
 0x00000600

	)

109 
	#MSR_IA32_PERF_CAPABILITIES
 0x00000345

	)

110 
	#MSR_PEBS_LD_LAT_THRESHOLD
 0x000003f6

	)

112 
	#MSR_IA32_RTIT_CTL
 0x00000570

	)

113 
	#RTIT_CTL_TRACEEN
 
	`BIT
(0)

	)

114 
	#RTIT_CTL_CYCLEACC
 
	`BIT
(1)

	)

115 
	#RTIT_CTL_OS
 
	`BIT
(2)

	)

116 
	#RTIT_CTL_USR
 
	`BIT
(3)

	)

117 
	#RTIT_CTL_CR3EN
 
	`BIT
(7)

	)

118 
	#RTIT_CTL_TOPA
 
	`BIT
(8)

	)

119 
	#RTIT_CTL_MTC_EN
 
	`BIT
(9)

	)

120 
	#RTIT_CTL_TSC_EN
 
	`BIT
(10)

	)

121 
	#RTIT_CTL_DISRETC
 
	`BIT
(11)

	)

122 
	#RTIT_CTL_BRANCH_EN
 
	`BIT
(13)

	)

123 
	#RTIT_CTL_MTC_RANGE_OFFSET
 14

	)

124 
	#RTIT_CTL_MTC_RANGE
 (0x0fuÎ << 
RTIT_CTL_MTC_RANGE_OFFSET
)

	)

125 
	#RTIT_CTL_CYC_THRESH_OFFSET
 19

	)

126 
	#RTIT_CTL_CYC_THRESH
 (0x0fuÎ << 
RTIT_CTL_CYC_THRESH_OFFSET
)

	)

127 
	#RTIT_CTL_PSB_FREQ_OFFSET
 24

	)

128 
	#RTIT_CTL_PSB_FREQ
 (0x0fuÎ << 
RTIT_CTL_PSB_FREQ_OFFSET
)

	)

129 
	#MSR_IA32_RTIT_STATUS
 0x00000571

	)

130 
	#RTIT_STATUS_CONTEXTEN
 
	`BIT
(1)

	)

131 
	#RTIT_STATUS_TRIGGEREN
 
	`BIT
(2)

	)

132 
	#RTIT_STATUS_ERROR
 
	`BIT
(4)

	)

133 
	#RTIT_STATUS_STOPPED
 
	`BIT
(5)

	)

134 
	#MSR_IA32_RTIT_CR3_MATCH
 0x00000572

	)

135 
	#MSR_IA32_RTIT_OUTPUT_BASE
 0x00000560

	)

136 
	#MSR_IA32_RTIT_OUTPUT_MASK
 0x00000561

	)

138 
	#MSR_MTRRfix64K_00000
 0x00000250

	)

139 
	#MSR_MTRRfix16K_80000
 0x00000258

	)

140 
	#MSR_MTRRfix16K_A0000
 0x00000259

	)

141 
	#MSR_MTRRfix4K_C0000
 0x00000268

	)

142 
	#MSR_MTRRfix4K_C8000
 0x00000269

	)

143 
	#MSR_MTRRfix4K_D0000
 0x0000026a

	)

144 
	#MSR_MTRRfix4K_D8000
 0x0000026b

	)

145 
	#MSR_MTRRfix4K_E0000
 0x0000026c

	)

146 
	#MSR_MTRRfix4K_E8000
 0x0000026d

	)

147 
	#MSR_MTRRfix4K_F0000
 0x0000026e

	)

148 
	#MSR_MTRRfix4K_F8000
 0x0000026f

	)

149 
	#MSR_MTRRdefTy³
 0x000002ff

	)

151 
	#MSR_IA32_CR_PAT
 0x00000277

	)

153 
	#MSR_IA32_DEBUGCTLMSR
 0x000001d9

	)

154 
	#MSR_IA32_LASTBRANCHFROMIP
 0x000001db

	)

155 
	#MSR_IA32_LASTBRANCHTOIP
 0x000001dc

	)

156 
	#MSR_IA32_LASTINTFROMIP
 0x000001dd

	)

157 
	#MSR_IA32_LASTINTTOIP
 0x000001de

	)

160 
	#DEBUGCTLMSR_LBR
 (1UL << 0è

	)

161 
	#DEBUGCTLMSR_BTF_SHIFT
 1

	)

162 
	#DEBUGCTLMSR_BTF
 (1UL << 1è

	)

163 
	#DEBUGCTLMSR_TR
 (1UL << 6)

	)

164 
	#DEBUGCTLMSR_BTS
 (1UL << 7)

	)

165 
	#DEBUGCTLMSR_BTINT
 (1UL << 8)

	)

166 
	#DEBUGCTLMSR_BTS_OFF_OS
 (1UL << 9)

	)

167 
	#DEBUGCTLMSR_BTS_OFF_USR
 (1UL << 10)

	)

168 
	#DEBUGCTLMSR_FREEZE_LBRS_ON_PMI
 (1UL << 11)

	)

170 
	#MSR_PEBS_FRONTEND
 0x000003f7

	)

172 
	#MSR_IA32_POWER_CTL
 0x000001fc

	)

174 
	#MSR_IA32_MC0_CTL
 0x00000400

	)

175 
	#MSR_IA32_MC0_STATUS
 0x00000401

	)

176 
	#MSR_IA32_MC0_ADDR
 0x00000402

	)

177 
	#MSR_IA32_MC0_MISC
 0x00000403

	)

180 
	#MSR_PKG_C3_RESIDENCY
 0x000003f8

	)

181 
	#MSR_PKG_C6_RESIDENCY
 0x000003f9

	)

182 
	#MSR_PKG_C7_RESIDENCY
 0x000003ç

	)

183 
	#MSR_CORE_C3_RESIDENCY
 0x000003fc

	)

184 
	#MSR_CORE_C6_RESIDENCY
 0x000003fd

	)

185 
	#MSR_CORE_C7_RESIDENCY
 0x000003ã

	)

186 
	#MSR_KNL_CORE_C6_RESIDENCY
 0x000003ff

	)

187 
	#MSR_PKG_C2_RESIDENCY
 0x0000060d

	)

188 
	#MSR_PKG_C8_RESIDENCY
 0x00000630

	)

189 
	#MSR_PKG_C9_RESIDENCY
 0x00000631

	)

190 
	#MSR_PKG_C10_RESIDENCY
 0x00000632

	)

193 
	#MSR_PKGC3_IRTL
 0x0000060a

	)

194 
	#MSR_PKGC6_IRTL
 0x0000060b

	)

195 
	#MSR_PKGC7_IRTL
 0x0000060c

	)

196 
	#MSR_PKGC8_IRTL
 0x00000633

	)

197 
	#MSR_PKGC9_IRTL
 0x00000634

	)

198 
	#MSR_PKGC10_IRTL
 0x00000635

	)

202 
	#MSR_RAPL_POWER_UNIT
 0x00000606

	)

204 
	#MSR_PKG_POWER_LIMIT
 0x00000610

	)

205 
	#MSR_PKG_ENERGY_STATUS
 0x00000611

	)

206 
	#MSR_PKG_PERF_STATUS
 0x00000613

	)

207 
	#MSR_PKG_POWER_INFO
 0x00000614

	)

209 
	#MSR_DRAM_POWER_LIMIT
 0x00000618

	)

210 
	#MSR_DRAM_ENERGY_STATUS
 0x00000619

	)

211 
	#MSR_DRAM_PERF_STATUS
 0x0000061b

	)

212 
	#MSR_DRAM_POWER_INFO
 0x0000061c

	)

214 
	#MSR_PP0_POWER_LIMIT
 0x00000638

	)

215 
	#MSR_PP0_ENERGY_STATUS
 0x00000639

	)

216 
	#MSR_PP0_POLICY
 0x0000063a

	)

217 
	#MSR_PP0_PERF_STATUS
 0x0000063b

	)

219 
	#MSR_PP1_POWER_LIMIT
 0x00000640

	)

220 
	#MSR_PP1_ENERGY_STATUS
 0x00000641

	)

221 
	#MSR_PP1_POLICY
 0x00000642

	)

223 
	#MSR_CONFIG_TDP_NOMINAL
 0x00000648

	)

224 
	#MSR_CONFIG_TDP_LEVEL_1
 0x00000649

	)

225 
	#MSR_CONFIG_TDP_LEVEL_2
 0x0000064A

	)

226 
	#MSR_CONFIG_TDP_CONTROL
 0x0000064B

	)

227 
	#MSR_TURBO_ACTIVATION_RATIO
 0x0000064C

	)

229 
	#MSR_PKG_WEIGHTED_CORE_C0_RES
 0x00000658

	)

230 
	#MSR_PKG_ANY_CORE_C0_RES
 0x00000659

	)

231 
	#MSR_PKG_ANY_GFXE_C0_RES
 0x0000065A

	)

232 
	#MSR_PKG_BOTH_CORE_GFXE_C0_RES
 0x0000065B

	)

234 
	#MSR_CORE_C1_RES
 0x00000660

	)

236 
	#MSR_CC6_DEMOTION_POLICY_CONFIG
 0x00000668

	)

237 
	#MSR_MC6_DEMOTION_POLICY_CONFIG
 0x00000669

	)

239 
	#MSR_CORE_PERF_LIMIT_REASONS
 0x00000690

	)

240 
	#MSR_GFX_PERF_LIMIT_REASONS
 0x000006B0

	)

241 
	#MSR_RING_PERF_LIMIT_REASONS
 0x000006B1

	)

244 
	#MSR_CONFIG_TDP_NOMINAL
 0x00000648

	)

245 
	#MSR_CONFIG_TDP_LEVEL1
 0x00000649

	)

246 
	#MSR_CONFIG_TDP_LEVEL2
 0x0000064A

	)

247 
	#MSR_CONFIG_TDP_CONTROL
 0x0000064B

	)

248 
	#MSR_TURBO_ACTIVATION_RATIO
 0x0000064C

	)

251 
	#MSR_PPERF
 0x0000064e

	)

252 
	#MSR_PERF_LIMIT_REASONS
 0x0000064f

	)

253 
	#MSR_PM_ENABLE
 0x00000770

	)

254 
	#MSR_HWP_CAPABILITIES
 0x00000771

	)

255 
	#MSR_HWP_REQUEST_PKG
 0x00000772

	)

256 
	#MSR_HWP_INTERRUPT
 0x00000773

	)

257 
	#MSR_HWP_REQUEST
 0x00000774

	)

258 
	#MSR_HWP_STATUS
 0x00000777

	)

261 
	#HWP_BASE_BIT
 (1<<7)

	)

262 
	#HWP_NOTIFICATIONS_BIT
 (1<<8)

	)

263 
	#HWP_ACTIVITY_WINDOW_BIT
 (1<<9)

	)

264 
	#HWP_ENERGY_PERF_PREFERENCE_BIT
 (1<<10)

	)

265 
	#HWP_PACKAGE_LEVEL_REQUEST_BIT
 (1<<11)

	)

268 
	#HWP_HIGHEST_PERF
(
x
è(x & 0xff)

	)

269 
	#HWP_GUARANTEED_PERF
(
x
è((x & (0xfà<< 8)è>>8)

	)

270 
	#HWP_MOSTEFFICIENT_PERF
(
x
è((x & (0xfà<< 16)è>>16)

	)

271 
	#HWP_LOWEST_PERF
(
x
è((x & (0xfà<< 24)è>>24)

	)

274 
	#HWP_MIN_PERF
(
x
è(x & 0xff)

	)

275 
	#HWP_MAX_PERF
(
x
è((x & 0xffè<< 8)

	)

276 
	#HWP_DESIRED_PERF
(
x
è((x & 0xffè<< 16)

	)

277 
	#HWP_ENERGY_PERF_PREFERENCE
(
x
è((x & 0xffè<< 24)

	)

278 
	#HWP_ACTIVITY_WINDOW
(
x
è((x & 0xff3è<< 32)

	)

279 
	#HWP_PACKAGE_CONTROL
(
x
è((x & 0x1è<< 42)

	)

282 
	#HWP_GUARANTEED_CHANGE
(
x
è(x & 0x1)

	)

283 
	#HWP_EXCURSION_TO_MINIMUM
(
x
è(x & 0x4)

	)

286 
	#HWP_CHANGE_TO_GUARANTEED_INT
(
x
è(x & 0x1)

	)

287 
	#HWP_EXCURSION_TO_MINIMUM_INT
(
x
è(x & 0x2)

	)

289 
	#MSR_AMD64_MC0_MASK
 0xc0010044

	)

291 
	#MSR_IA32_MCx_CTL
(
x
è(
MSR_IA32_MC0_CTL
 + 4*(x))

	)

292 
	#MSR_IA32_MCx_STATUS
(
x
è(
MSR_IA32_MC0_STATUS
 + 4*(x))

	)

293 
	#MSR_IA32_MCx_ADDR
(
x
è(
MSR_IA32_MC0_ADDR
 + 4*(x))

	)

294 
	#MSR_IA32_MCx_MISC
(
x
è(
MSR_IA32_MC0_MISC
 + 4*(x))

	)

296 
	#MSR_AMD64_MCx_MASK
(
x
è(
MSR_AMD64_MC0_MASK
 + (x))

	)

299 
	#MSR_IA32_MC0_CTL2
 0x00000280

	)

300 
	#MSR_IA32_MCx_CTL2
(
x
è(
MSR_IA32_MC0_CTL2
 + (x))

	)

302 
	#MSR_P6_PERFCTR0
 0x000000c1

	)

303 
	#MSR_P6_PERFCTR1
 0x000000c2

	)

304 
	#MSR_P6_EVNTSEL0
 0x00000186

	)

305 
	#MSR_P6_EVNTSEL1
 0x00000187

	)

307 
	#MSR_KNC_PERFCTR0
 0x00000020

	)

308 
	#MSR_KNC_PERFCTR1
 0x00000021

	)

309 
	#MSR_KNC_EVNTSEL0
 0x00000028

	)

310 
	#MSR_KNC_EVNTSEL1
 0x00000029

	)

313 
	#MSR_IA32_PMC0
 0x000004c1

	)

318 
	#MSR_AMD64_PATCH_LEVEL
 0x0000008b

	)

319 
	#MSR_AMD64_TSC_RATIO
 0xc0000104

	)

320 
	#MSR_AMD64_NB_CFG
 0xc001001f

	)

321 
	#MSR_AMD64_PATCH_LOADER
 0xc0010020

	)

322 
	#MSR_AMD64_OSVW_ID_LENGTH
 0xc0010140

	)

323 
	#MSR_AMD64_OSVW_STATUS
 0xc0010141

	)

324 
	#MSR_AMD64_LS_CFG
 0xc0011020

	)

325 
	#MSR_AMD64_DC_CFG
 0xc0011022

	)

326 
	#MSR_AMD64_BU_CFG2
 0xc001102a

	)

327 
	#MSR_AMD64_IBSFETCHCTL
 0xc0011030

	)

328 
	#MSR_AMD64_IBSFETCHLINAD
 0xc0011031

	)

329 
	#MSR_AMD64_IBSFETCHPHYSAD
 0xc0011032

	)

330 
	#MSR_AMD64_IBSFETCH_REG_COUNT
 3

	)

331 
	#MSR_AMD64_IBSFETCH_REG_MASK
 ((1UL<<
MSR_AMD64_IBSFETCH_REG_COUNT
)-1)

	)

332 
	#MSR_AMD64_IBSOPCTL
 0xc0011033

	)

333 
	#MSR_AMD64_IBSOPRIP
 0xc0011034

	)

334 
	#MSR_AMD64_IBSOPDATA
 0xc0011035

	)

335 
	#MSR_AMD64_IBSOPDATA2
 0xc0011036

	)

336 
	#MSR_AMD64_IBSOPDATA3
 0xc0011037

	)

337 
	#MSR_AMD64_IBSDCLINAD
 0xc0011038

	)

338 
	#MSR_AMD64_IBSDCPHYSAD
 0xc0011039

	)

339 
	#MSR_AMD64_IBSOP_REG_COUNT
 7

	)

340 
	#MSR_AMD64_IBSOP_REG_MASK
 ((1UL<<
MSR_AMD64_IBSOP_REG_COUNT
)-1)

	)

341 
	#MSR_AMD64_IBSCTL
 0xc001103a

	)

342 
	#MSR_AMD64_IBSBRTARGET
 0xc001103b

	)

343 
	#MSR_AMD64_IBSOPDATA4
 0xc001103d

	)

344 
	#MSR_AMD64_IBS_REG_COUNT_MAX
 8

	)

346 
	#MSR_AMD64_VIRT_SPEC_CTRL
 0xc001011f

	)

349 
	#MSR_F16H_L2I_PERF_CTL
 0xc0010230

	)

350 
	#MSR_F16H_L2I_PERF_CTR
 0xc0010231

	)

351 
	#MSR_F16H_DR1_ADDR_MASK
 0xc0011019

	)

352 
	#MSR_F16H_DR2_ADDR_MASK
 0xc001101a

	)

353 
	#MSR_F16H_DR3_ADDR_MASK
 0xc001101b

	)

354 
	#MSR_F16H_DR0_ADDR_MASK
 0xc0011027

	)

357 
	#MSR_F15H_PERF_CTL
 0xc0010200

	)

358 
	#MSR_F15H_PERF_CTR
 0xc0010201

	)

359 
	#MSR_F15H_NB_PERF_CTL
 0xc0010240

	)

360 
	#MSR_F15H_NB_PERF_CTR
 0xc0010241

	)

361 
	#MSR_F15H_IC_CFG
 0xc0011021

	)

362 
	#MSR_F15H_IC_CFG_DIS_IND
 
	`BIT_ULL
(14)

	)

365 
	#MSR_FAM10H_MMIO_CONF_BASE
 0xc0010058

	)

366 
	#FAM10H_MMIO_CONF_ENABLE
 (1<<0)

	)

367 
	#FAM10H_MMIO_CONF_BUSRANGE_MASK
 0xf

	)

368 
	#FAM10H_MMIO_CONF_BUSRANGE_SHIFT
 2

	)

369 
	#FAM10H_MMIO_CONF_BASE_MASK
 0xfffffffULL

	)

370 
	#FAM10H_MMIO_CONF_BASE_SHIFT
 20

	)

371 
	#MSR_FAM10H_NODE_ID
 0xc001100c

	)

372 
	#MSR_F10H_DECFG
 0xc0011029

	)

373 
	#MSR_F10H_DECFG_LFENCE_SERIALIZE_BIT
 1

	)

374 
	#MSR_F10H_DECFG_LFENCE_SERIALIZE
 
	`BIT_ULL
(
MSR_F10H_DECFG_LFENCE_SERIALIZE_BIT
)

	)

377 
	#MSR_K8_TOP_MEM1
 0xc001001a

	)

378 
	#MSR_K8_TOP_MEM2
 0xc001001d

	)

379 
	#MSR_K8_SYSCFG
 0xc0010010

	)

380 
	#MSR_K8_INT_PENDING_MSG
 0xc0010055

	)

382 
	#K8_INTP_C1E_ACTIVE_MASK
 0x18000000

	)

383 
	#MSR_K8_TSEG_ADDR
 0xc0010112

	)

384 
	#MSR_K8_TSEG_MASK
 0xc0010113

	)

385 
	#K8_MTRRFIXRANGE_DRAM_ENABLE
 0x00040000

	)

386 
	#K8_MTRRFIXRANGE_DRAM_MODIFY
 0x00080000

	)

387 
	#K8_MTRR_RDMEM_WRMEM_MASK
 0x18181818

	)

390 
	#MSR_K7_EVNTSEL0
 0xc0010000

	)

391 
	#MSR_K7_PERFCTR0
 0xc0010004

	)

392 
	#MSR_K7_EVNTSEL1
 0xc0010001

	)

393 
	#MSR_K7_PERFCTR1
 0xc0010005

	)

394 
	#MSR_K7_EVNTSEL2
 0xc0010002

	)

395 
	#MSR_K7_PERFCTR2
 0xc0010006

	)

396 
	#MSR_K7_EVNTSEL3
 0xc0010003

	)

397 
	#MSR_K7_PERFCTR3
 0xc0010007

	)

398 
	#MSR_K7_CLK_CTL
 0xc001001b

	)

399 
	#MSR_K7_HWCR
 0xc0010015

	)

400 
	#MSR_K7_FID_VID_CTL
 0xc0010041

	)

401 
	#MSR_K7_FID_VID_STATUS
 0xc0010042

	)

404 
	#MSR_K6_WHCR
 0xc0000082

	)

405 
	#MSR_K6_UWCCR
 0xc0000085

	)

406 
	#MSR_K6_EPMR
 0xc0000086

	)

407 
	#MSR_K6_PSOR
 0xc0000087

	)

408 
	#MSR_K6_PFIR
 0xc0000088

	)

411 
	#MSR_IDT_FCR1
 0x00000107

	)

412 
	#MSR_IDT_FCR2
 0x00000108

	)

413 
	#MSR_IDT_FCR3
 0x00000109

	)

414 
	#MSR_IDT_FCR4
 0x0000010a

	)

416 
	#MSR_IDT_MCR0
 0x00000110

	)

417 
	#MSR_IDT_MCR1
 0x00000111

	)

418 
	#MSR_IDT_MCR2
 0x00000112

	)

419 
	#MSR_IDT_MCR3
 0x00000113

	)

420 
	#MSR_IDT_MCR4
 0x00000114

	)

421 
	#MSR_IDT_MCR5
 0x00000115

	)

422 
	#MSR_IDT_MCR6
 0x00000116

	)

423 
	#MSR_IDT_MCR7
 0x00000117

	)

424 
	#MSR_IDT_MCR_CTRL
 0x00000120

	)

427 
	#MSR_VIA_FCR
 0x00001107

	)

428 
	#MSR_VIA_LONGHAUL
 0x0000110a

	)

429 
	#MSR_VIA_RNG
 0x0000110b

	)

430 
	#MSR_VIA_BCR2
 0x00001147

	)

433 
	#MSR_TMTA_LONGRUN_CTRL
 0x80868010

	)

434 
	#MSR_TMTA_LONGRUN_FLAGS
 0x80868011

	)

435 
	#MSR_TMTA_LRTI_READOUT
 0x80868018

	)

436 
	#MSR_TMTA_LRTI_VOLT_MHZ
 0x8086801a

	)

439 
	#MSR_IA32_P5_MC_ADDR
 0x00000000

	)

440 
	#MSR_IA32_P5_MC_TYPE
 0x00000001

	)

441 
	#MSR_IA32_TSC
 0x00000010

	)

442 
	#MSR_IA32_PLATFORM_ID
 0x00000017

	)

443 
	#MSR_IA32_EBL_CR_POWERON
 0x0000002a

	)

444 
	#MSR_EBC_FREQUENCY_ID
 0x0000002c

	)

445 
	#MSR_SMI_COUNT
 0x00000034

	)

446 
	#MSR_IA32_FEATURE_CONTROL
 0x0000003a

	)

447 
	#MSR_IA32_TSC_ADJUST
 0x0000003b

	)

448 
	#MSR_IA32_BNDCFGS
 0x00000d90

	)

450 
	#MSR_IA32_BNDCFGS_RSVD
 0x00000ffc

	)

452 
	#MSR_IA32_XSS
 0x00000da0

	)

454 
	#FEATURE_CONTROL_LOCKED
 (1<<0)

	)

455 
	#FEATURE_CONTROL_VMXON_ENABLED_INSIDE_SMX
 (1<<1)

	)

456 
	#FEATURE_CONTROL_VMXON_ENABLED_OUTSIDE_SMX
 (1<<2)

	)

457 
	#FEATURE_CONTROL_LMCE
 (1<<20)

	)

459 
	#MSR_IA32_APICBASE
 0x0000001b

	)

460 
	#MSR_IA32_APICBASE_BSP
 (1<<8)

	)

461 
	#MSR_IA32_APICBASE_ENABLE
 (1<<11)

	)

462 
	#MSR_IA32_APICBASE_BASE
 (0xfffff<<12)

	)

464 
	#MSR_IA32_TSCDEADLINE
 0x000006e0

	)

466 
	#MSR_IA32_UCODE_WRITE
 0x00000079

	)

467 
	#MSR_IA32_UCODE_REV
 0x0000008b

	)

469 
	#MSR_IA32_SMM_MONITOR_CTL
 0x0000009b

	)

470 
	#MSR_IA32_SMBASE
 0x0000009e

	)

472 
	#MSR_IA32_PERF_STATUS
 0x00000198

	)

473 
	#MSR_IA32_PERF_CTL
 0x00000199

	)

474 
	#INTEL_PERF_CTL_MASK
 0xffff

	)

475 
	#MSR_AMD_PSTATE_DEF_BASE
 0xc0010064

	)

476 
	#MSR_AMD_PERF_STATUS
 0xc0010063

	)

477 
	#MSR_AMD_PERF_CTL
 0xc0010062

	)

479 
	#MSR_IA32_MPERF
 0x000000e7

	)

480 
	#MSR_IA32_APERF
 0x000000e8

	)

482 
	#MSR_IA32_THERM_CONTROL
 0x0000019a

	)

483 
	#MSR_IA32_THERM_INTERRUPT
 0x0000019b

	)

485 
	#THERM_INT_HIGH_ENABLE
 (1 << 0)

	)

486 
	#THERM_INT_LOW_ENABLE
 (1 << 1)

	)

487 
	#THERM_INT_PLN_ENABLE
 (1 << 24)

	)

489 
	#MSR_IA32_THERM_STATUS
 0x0000019c

	)

491 
	#THERM_STATUS_PROCHOT
 (1 << 0)

	)

492 
	#THERM_STATUS_POWER_LIMIT
 (1 << 10)

	)

494 
	#MSR_THERM2_CTL
 0x0000019d

	)

496 
	#MSR_THERM2_CTL_TM_SELECT
 (1ULL << 16)

	)

498 
	#MSR_IA32_MISC_ENABLE
 0x000001a0

	)

500 
	#MSR_IA32_TEMPERATURE_TARGET
 0x000001a2

	)

502 
	#MSR_MISC_PWR_MGMT
 0x000001¯

	)

504 
	#MSR_IA32_ENERGY_PERF_BIAS
 0x000001b0

	)

505 
	#ENERGY_PERF_BIAS_PERFORMANCE
 0

	)

506 
	#ENERGY_PERF_BIAS_NORMAL
 6

	)

507 
	#ENERGY_PERF_BIAS_POWERSAVE
 15

	)

509 
	#MSR_IA32_PACKAGE_THERM_STATUS
 0x000001b1

	)

511 
	#PACKAGE_THERM_STATUS_PROCHOT
 (1 << 0)

	)

512 
	#PACKAGE_THERM_STATUS_POWER_LIMIT
 (1 << 10)

	)

514 
	#MSR_IA32_PACKAGE_THERM_INTERRUPT
 0x000001b2

	)

516 
	#PACKAGE_THERM_INT_HIGH_ENABLE
 (1 << 0)

	)

517 
	#PACKAGE_THERM_INT_LOW_ENABLE
 (1 << 1)

	)

518 
	#PACKAGE_THERM_INT_PLN_ENABLE
 (1 << 24)

	)

521 
	#THERM_INT_THRESHOLD0_ENABLE
 (1 << 15)

	)

522 
	#THERM_SHIFT_THRESHOLD0
 8

	)

523 
	#THERM_MASK_THRESHOLD0
 (0x7à<< 
THERM_SHIFT_THRESHOLD0
)

	)

524 
	#THERM_INT_THRESHOLD1_ENABLE
 (1 << 23)

	)

525 
	#THERM_SHIFT_THRESHOLD1
 16

	)

526 
	#THERM_MASK_THRESHOLD1
 (0x7à<< 
THERM_SHIFT_THRESHOLD1
)

	)

527 
	#THERM_STATUS_THRESHOLD0
 (1 << 6)

	)

528 
	#THERM_LOG_THRESHOLD0
 (1 << 7)

	)

529 
	#THERM_STATUS_THRESHOLD1
 (1 << 8)

	)

530 
	#THERM_LOG_THRESHOLD1
 (1 << 9)

	)

533 
	#MSR_IA32_MISC_ENABLE_FAST_STRING_BIT
 0

	)

534 
	#MSR_IA32_MISC_ENABLE_FAST_STRING
 (1ULL << 
MSR_IA32_MISC_ENABLE_FAST_STRING_BIT
)

	)

535 
	#MSR_IA32_MISC_ENABLE_TCC_BIT
 1

	)

536 
	#MSR_IA32_MISC_ENABLE_TCC
 (1ULL << 
MSR_IA32_MISC_ENABLE_TCC_BIT
)

	)

537 
	#MSR_IA32_MISC_ENABLE_EMON_BIT
 7

	)

538 
	#MSR_IA32_MISC_ENABLE_EMON
 (1ULL << 
MSR_IA32_MISC_ENABLE_EMON_BIT
)

	)

539 
	#MSR_IA32_MISC_ENABLE_BTS_UNAVAIL_BIT
 11

	)

540 
	#MSR_IA32_MISC_ENABLE_BTS_UNAVAIL
 (1ULL << 
MSR_IA32_MISC_ENABLE_BTS_UNAVAIL_BIT
)

	)

541 
	#MSR_IA32_MISC_ENABLE_PEBS_UNAVAIL_BIT
 12

	)

542 
	#MSR_IA32_MISC_ENABLE_PEBS_UNAVAIL
 (1ULL << 
MSR_IA32_MISC_ENABLE_PEBS_UNAVAIL_BIT
)

	)

543 
	#MSR_IA32_MISC_ENABLE_ENHANCED_SPEEDSTEP_BIT
 16

	)

544 
	#MSR_IA32_MISC_ENABLE_ENHANCED_SPEEDSTEP
 (1ULL << 
MSR_IA32_MISC_ENABLE_ENHANCED_SPEEDSTEP_BIT
)

	)

545 
	#MSR_IA32_MISC_ENABLE_MWAIT_BIT
 18

	)

546 
	#MSR_IA32_MISC_ENABLE_MWAIT
 (1ULL << 
MSR_IA32_MISC_ENABLE_MWAIT_BIT
)

	)

547 
	#MSR_IA32_MISC_ENABLE_LIMIT_CPUID_BIT
 22

	)

548 
	#MSR_IA32_MISC_ENABLE_LIMIT_CPUID
 (1ULL << 
MSR_IA32_MISC_ENABLE_LIMIT_CPUID_BIT
)

	)

549 
	#MSR_IA32_MISC_ENABLE_XTPR_DISABLE_BIT
 23

	)

550 
	#MSR_IA32_MISC_ENABLE_XTPR_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_XTPR_DISABLE_BIT
)

	)

551 
	#MSR_IA32_MISC_ENABLE_XD_DISABLE_BIT
 34

	)

552 
	#MSR_IA32_MISC_ENABLE_XD_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_XD_DISABLE_BIT
)

	)

555 
	#MSR_IA32_MISC_ENABLE_X87_COMPAT_BIT
 2

	)

556 
	#MSR_IA32_MISC_ENABLE_X87_COMPAT
 (1ULL << 
MSR_IA32_MISC_ENABLE_X87_COMPAT_BIT
)

	)

557 
	#MSR_IA32_MISC_ENABLE_TM1_BIT
 3

	)

558 
	#MSR_IA32_MISC_ENABLE_TM1
 (1ULL << 
MSR_IA32_MISC_ENABLE_TM1_BIT
)

	)

559 
	#MSR_IA32_MISC_ENABLE_SPLIT_LOCK_DISABLE_BIT
 4

	)

560 
	#MSR_IA32_MISC_ENABLE_SPLIT_LOCK_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_SPLIT_LOCK_DISABLE_BIT
)

	)

561 
	#MSR_IA32_MISC_ENABLE_L3CACHE_DISABLE_BIT
 6

	)

562 
	#MSR_IA32_MISC_ENABLE_L3CACHE_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_L3CACHE_DISABLE_BIT
)

	)

563 
	#MSR_IA32_MISC_ENABLE_SUPPRESS_LOCK_BIT
 8

	)

564 
	#MSR_IA32_MISC_ENABLE_SUPPRESS_LOCK
 (1ULL << 
MSR_IA32_MISC_ENABLE_SUPPRESS_LOCK_BIT
)

	)

565 
	#MSR_IA32_MISC_ENABLE_PREFETCH_DISABLE_BIT
 9

	)

566 
	#MSR_IA32_MISC_ENABLE_PREFETCH_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_PREFETCH_DISABLE_BIT
)

	)

567 
	#MSR_IA32_MISC_ENABLE_FERR_BIT
 10

	)

568 
	#MSR_IA32_MISC_ENABLE_FERR
 (1ULL << 
MSR_IA32_MISC_ENABLE_FERR_BIT
)

	)

569 
	#MSR_IA32_MISC_ENABLE_FERR_MULTIPLEX_BIT
 10

	)

570 
	#MSR_IA32_MISC_ENABLE_FERR_MULTIPLEX
 (1ULL << 
MSR_IA32_MISC_ENABLE_FERR_MULTIPLEX_BIT
)

	)

571 
	#MSR_IA32_MISC_ENABLE_TM2_BIT
 13

	)

572 
	#MSR_IA32_MISC_ENABLE_TM2
 (1ULL << 
MSR_IA32_MISC_ENABLE_TM2_BIT
)

	)

573 
	#MSR_IA32_MISC_ENABLE_ADJ_PREF_DISABLE_BIT
 19

	)

574 
	#MSR_IA32_MISC_ENABLE_ADJ_PREF_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_ADJ_PREF_DISABLE_BIT
)

	)

575 
	#MSR_IA32_MISC_ENABLE_SPEEDSTEP_LOCK_BIT
 20

	)

576 
	#MSR_IA32_MISC_ENABLE_SPEEDSTEP_LOCK
 (1ULL << 
MSR_IA32_MISC_ENABLE_SPEEDSTEP_LOCK_BIT
)

	)

577 
	#MSR_IA32_MISC_ENABLE_L1D_CONTEXT_BIT
 24

	)

578 
	#MSR_IA32_MISC_ENABLE_L1D_CONTEXT
 (1ULL << 
MSR_IA32_MISC_ENABLE_L1D_CONTEXT_BIT
)

	)

579 
	#MSR_IA32_MISC_ENABLE_DCU_PREF_DISABLE_BIT
 37

	)

580 
	#MSR_IA32_MISC_ENABLE_DCU_PREF_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_DCU_PREF_DISABLE_BIT
)

	)

581 
	#MSR_IA32_MISC_ENABLE_TURBO_DISABLE_BIT
 38

	)

582 
	#MSR_IA32_MISC_ENABLE_TURBO_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_TURBO_DISABLE_BIT
)

	)

583 
	#MSR_IA32_MISC_ENABLE_IP_PREF_DISABLE_BIT
 39

	)

584 
	#MSR_IA32_MISC_ENABLE_IP_PREF_DISABLE
 (1ULL << 
MSR_IA32_MISC_ENABLE_IP_PREF_DISABLE_BIT
)

	)

586 
	#MSR_IA32_TSC_DEADLINE
 0x000006E0

	)

589 
	#MSR_IA32_MCG_EAX
 0x00000180

	)

590 
	#MSR_IA32_MCG_EBX
 0x00000181

	)

591 
	#MSR_IA32_MCG_ECX
 0x00000182

	)

592 
	#MSR_IA32_MCG_EDX
 0x00000183

	)

593 
	#MSR_IA32_MCG_ESI
 0x00000184

	)

594 
	#MSR_IA32_MCG_EDI
 0x00000185

	)

595 
	#MSR_IA32_MCG_EBP
 0x00000186

	)

596 
	#MSR_IA32_MCG_ESP
 0x00000187

	)

597 
	#MSR_IA32_MCG_EFLAGS
 0x00000188

	)

598 
	#MSR_IA32_MCG_EIP
 0x00000189

	)

599 
	#MSR_IA32_MCG_RESERVED
 0x0000018a

	)

602 
	#MSR_P4_BPU_PERFCTR0
 0x00000300

	)

603 
	#MSR_P4_BPU_PERFCTR1
 0x00000301

	)

604 
	#MSR_P4_BPU_PERFCTR2
 0x00000302

	)

605 
	#MSR_P4_BPU_PERFCTR3
 0x00000303

	)

606 
	#MSR_P4_MS_PERFCTR0
 0x00000304

	)

607 
	#MSR_P4_MS_PERFCTR1
 0x00000305

	)

608 
	#MSR_P4_MS_PERFCTR2
 0x00000306

	)

609 
	#MSR_P4_MS_PERFCTR3
 0x00000307

	)

610 
	#MSR_P4_FLAME_PERFCTR0
 0x00000308

	)

611 
	#MSR_P4_FLAME_PERFCTR1
 0x00000309

	)

612 
	#MSR_P4_FLAME_PERFCTR2
 0x0000030a

	)

613 
	#MSR_P4_FLAME_PERFCTR3
 0x0000030b

	)

614 
	#MSR_P4_IQ_PERFCTR0
 0x0000030c

	)

615 
	#MSR_P4_IQ_PERFCTR1
 0x0000030d

	)

616 
	#MSR_P4_IQ_PERFCTR2
 0x0000030e

	)

617 
	#MSR_P4_IQ_PERFCTR3
 0x0000030f

	)

618 
	#MSR_P4_IQ_PERFCTR4
 0x00000310

	)

619 
	#MSR_P4_IQ_PERFCTR5
 0x00000311

	)

620 
	#MSR_P4_BPU_CCCR0
 0x00000360

	)

621 
	#MSR_P4_BPU_CCCR1
 0x00000361

	)

622 
	#MSR_P4_BPU_CCCR2
 0x00000362

	)

623 
	#MSR_P4_BPU_CCCR3
 0x00000363

	)

624 
	#MSR_P4_MS_CCCR0
 0x00000364

	)

625 
	#MSR_P4_MS_CCCR1
 0x00000365

	)

626 
	#MSR_P4_MS_CCCR2
 0x00000366

	)

627 
	#MSR_P4_MS_CCCR3
 0x00000367

	)

628 
	#MSR_P4_FLAME_CCCR0
 0x00000368

	)

629 
	#MSR_P4_FLAME_CCCR1
 0x00000369

	)

630 
	#MSR_P4_FLAME_CCCR2
 0x0000036a

	)

631 
	#MSR_P4_FLAME_CCCR3
 0x0000036b

	)

632 
	#MSR_P4_IQ_CCCR0
 0x0000036c

	)

633 
	#MSR_P4_IQ_CCCR1
 0x0000036d

	)

634 
	#MSR_P4_IQ_CCCR2
 0x0000036e

	)

635 
	#MSR_P4_IQ_CCCR3
 0x0000036f

	)

636 
	#MSR_P4_IQ_CCCR4
 0x00000370

	)

637 
	#MSR_P4_IQ_CCCR5
 0x00000371

	)

638 
	#MSR_P4_ALF_ESCR0
 0x000003ÿ

	)

639 
	#MSR_P4_ALF_ESCR1
 0x000003cb

	)

640 
	#MSR_P4_BPU_ESCR0
 0x000003b2

	)

641 
	#MSR_P4_BPU_ESCR1
 0x000003b3

	)

642 
	#MSR_P4_BSU_ESCR0
 0x000003a0

	)

643 
	#MSR_P4_BSU_ESCR1
 0x000003a1

	)

644 
	#MSR_P4_CRU_ESCR0
 0x000003b8

	)

645 
	#MSR_P4_CRU_ESCR1
 0x000003b9

	)

646 
	#MSR_P4_CRU_ESCR2
 0x000003cc

	)

647 
	#MSR_P4_CRU_ESCR3
 0x000003cd

	)

648 
	#MSR_P4_CRU_ESCR4
 0x000003e0

	)

649 
	#MSR_P4_CRU_ESCR5
 0x000003e1

	)

650 
	#MSR_P4_DAC_ESCR0
 0x000003a8

	)

651 
	#MSR_P4_DAC_ESCR1
 0x000003a9

	)

652 
	#MSR_P4_FIRM_ESCR0
 0x000003a4

	)

653 
	#MSR_P4_FIRM_ESCR1
 0x000003a5

	)

654 
	#MSR_P4_FLAME_ESCR0
 0x000003a6

	)

655 
	#MSR_P4_FLAME_ESCR1
 0x000003a7

	)

656 
	#MSR_P4_FSB_ESCR0
 0x000003a2

	)

657 
	#MSR_P4_FSB_ESCR1
 0x000003a3

	)

658 
	#MSR_P4_IQ_ESCR0
 0x000003ba

	)

659 
	#MSR_P4_IQ_ESCR1
 0x000003bb

	)

660 
	#MSR_P4_IS_ESCR0
 0x000003b4

	)

661 
	#MSR_P4_IS_ESCR1
 0x000003b5

	)

662 
	#MSR_P4_ITLB_ESCR0
 0x000003b6

	)

663 
	#MSR_P4_ITLB_ESCR1
 0x000003b7

	)

664 
	#MSR_P4_IX_ESCR0
 0x000003c8

	)

665 
	#MSR_P4_IX_ESCR1
 0x000003c9

	)

666 
	#MSR_P4_MOB_ESCR0
 0x000003¯

	)

667 
	#MSR_P4_MOB_ESCR1
 0x000003ab

	)

668 
	#MSR_P4_MS_ESCR0
 0x000003c0

	)

669 
	#MSR_P4_MS_ESCR1
 0x000003c1

	)

670 
	#MSR_P4_PMH_ESCR0
 0x000003ac

	)

671 
	#MSR_P4_PMH_ESCR1
 0x000003ad

	)

672 
	#MSR_P4_RAT_ESCR0
 0x000003bc

	)

673 
	#MSR_P4_RAT_ESCR1
 0x000003bd

	)

674 
	#MSR_P4_SAAT_ESCR0
 0x000003«

	)

675 
	#MSR_P4_SAAT_ESCR1
 0x000003af

	)

676 
	#MSR_P4_SSU_ESCR0
 0x000003be

	)

677 
	#MSR_P4_SSU_ESCR1
 0x000003bà

	)

679 
	#MSR_P4_TBPU_ESCR0
 0x000003c2

	)

680 
	#MSR_P4_TBPU_ESCR1
 0x000003c3

	)

681 
	#MSR_P4_TC_ESCR0
 0x000003c4

	)

682 
	#MSR_P4_TC_ESCR1
 0x000003c5

	)

683 
	#MSR_P4_U2L_ESCR0
 0x000003b0

	)

684 
	#MSR_P4_U2L_ESCR1
 0x000003b1

	)

686 
	#MSR_P4_PEBS_MATRIX_VERT
 0x000003f2

	)

689 
	#MSR_CORE_PERF_FIXED_CTR0
 0x00000309

	)

690 
	#MSR_CORE_PERF_FIXED_CTR1
 0x0000030a

	)

691 
	#MSR_CORE_PERF_FIXED_CTR2
 0x0000030b

	)

692 
	#MSR_CORE_PERF_FIXED_CTR_CTRL
 0x0000038d

	)

693 
	#MSR_CORE_PERF_GLOBAL_STATUS
 0x0000038e

	)

694 
	#MSR_CORE_PERF_GLOBAL_CTRL
 0x0000038f

	)

695 
	#MSR_CORE_PERF_GLOBAL_OVF_CTRL
 0x00000390

	)

698 
	#MSR_GEODE_BUSCONT_CONF0
 0x00001900

	)

701 
	#MSR_IA32_VMX_BASIC
 0x00000480

	)

702 
	#MSR_IA32_VMX_PINBASED_CTLS
 0x00000481

	)

703 
	#MSR_IA32_VMX_PROCBASED_CTLS
 0x00000482

	)

704 
	#MSR_IA32_VMX_EXIT_CTLS
 0x00000483

	)

705 
	#MSR_IA32_VMX_ENTRY_CTLS
 0x00000484

	)

706 
	#MSR_IA32_VMX_MISC
 0x00000485

	)

707 
	#MSR_IA32_VMX_CR0_FIXED0
 0x00000486

	)

708 
	#MSR_IA32_VMX_CR0_FIXED1
 0x00000487

	)

709 
	#MSR_IA32_VMX_CR4_FIXED0
 0x00000488

	)

710 
	#MSR_IA32_VMX_CR4_FIXED1
 0x00000489

	)

711 
	#MSR_IA32_VMX_VMCS_ENUM
 0x0000048a

	)

712 
	#MSR_IA32_VMX_PROCBASED_CTLS2
 0x0000048b

	)

713 
	#MSR_IA32_VMX_EPT_VPID_CAP
 0x0000048c

	)

714 
	#MSR_IA32_VMX_TRUE_PINBASED_CTLS
 0x0000048d

	)

715 
	#MSR_IA32_VMX_TRUE_PROCBASED_CTLS
 0x0000048e

	)

716 
	#MSR_IA32_VMX_TRUE_EXIT_CTLS
 0x0000048f

	)

717 
	#MSR_IA32_VMX_TRUE_ENTRY_CTLS
 0x00000490

	)

718 
	#MSR_IA32_VMX_VMFUNC
 0x00000491

	)

721 
	#VMX_BASIC_VMCS_SIZE_SHIFT
 32

	)

722 
	#VMX_BASIC_TRUE_CTLS
 (1ULL << 55)

	)

723 
	#VMX_BASIC_64
 0x0001000000000000LLU

	)

724 
	#VMX_BASIC_MEM_TYPE_SHIFT
 50

	)

725 
	#VMX_BASIC_MEM_TYPE_MASK
 0x003c000000000000LLU

	)

726 
	#VMX_BASIC_MEM_TYPE_WB
 6LLU

	)

727 
	#VMX_BASIC_INOUT
 0x0040000000000000LLU

	)

730 
	#MSR_IA32_VMX_MISC_VMWRITE_SHADOW_RO_FIELDS
 (1ULL << 29)

	)

731 
	#MSR_IA32_VMX_MISC_PREEMPTION_TIMER_SCALE
 0x1F

	)

734 
	#MSR_VM_CR
 0xc0010114

	)

735 
	#MSR_VM_IGNNE
 0xc0010115

	)

736 
	#MSR_VM_HSAVE_PA
 0xc0010117

	)

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/sched.h

1 #iâdeà
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000fà

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

24 
	#CLONE_NEWCGROUP
 0x02000000

	)

25 
	#CLONE_NEWUTS
 0x04000000

	)

26 
	#CLONE_NEWIPC
 0x08000000

	)

27 
	#CLONE_NEWUSER
 0x10000000

	)

28 
	#CLONE_NEWPID
 0x20000000

	)

29 
	#CLONE_NEWNET
 0x40000000

	)

30 
	#CLONE_IO
 0x80000000

	)

35 
	#SCHED_NORMAL
 0

	)

36 
	#SCHED_FIFO
 1

	)

37 
	#SCHED_RR
 2

	)

38 
	#SCHED_BATCH
 3

	)

40 
	#SCHED_IDLE
 5

	)

41 
	#SCHED_DEADLINE
 6

	)

44 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

49 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

	@/usr/include/linux/signal.h

1 #iâdeà
_LINUX_SIGNAL_H


2 
	#_LINUX_SIGNAL_H


	)

4 
	~<asm/sigÇl.h
>

5 
	~<asm/sigšfo.h
>

7 
	#SS_ONSTACK
 1

	)

8 
	#SS_DISABLE
 2

	)

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty³s.h
>

6 #iâdeà
__ASSEMBLY__


8 
	~<lšux/posix_ty³s.h
>

16 #ifdeà
__CHECKER__


17 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

19 
	#__b™wi£__


	)

21 #ifdeà
__CHECK_ENDIAN__


22 
	#__b™wi£
 
__b™wi£__


	)

24 
	#__b™wi£


	)

27 
__u16
 
	t__b™wi£
 
	t__Ë16
;

28 
__u16
 
	t__b™wi£
 
	t__be16
;

29 
__u32
 
	t__b™wi£
 
	t__Ë32
;

30 
__u32
 
	t__b™wi£
 
	t__be32
;

31 
__u64
 
	t__b™wi£
 
	t__Ë64
;

32 
__u64
 
	t__b™wi£
 
	t__be64
;

34 
__u16
 
	t__b™wi£
 
	t__sum16
;

35 
__u32
 
	t__b™wi£
 
	t__wsum
;

46 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

48 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 263328

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
è((×è<< 16è+ ((bè<< 8è+ (c))

	)

	@/usr/include/asm-generic/mman.h

1 #iâdeà
__ASM_GENERIC_MMAN_H


2 
	#__ASM_GENERIC_MMAN_H


	)

4 
	~<asm-g’”ic/mmª-commÚ.h
>

6 
	#MAP_GROWSDOWN
 0x0100

	)

7 
	#MAP_DENYWRITE
 0x0800

	)

8 
	#MAP_EXECUTABLE
 0x1000

	)

9 
	#MAP_LOCKED
 0x2000

	)

10 
	#MAP_NORESERVE
 0x4000

	)

11 
	#MAP_POPULATE
 0x8000

	)

12 
	#MAP_NONBLOCK
 0x10000

	)

13 
	#MAP_STACK
 0x20000

	)

14 
	#MAP_HUGETLB
 0x40000

	)

18 
	#MCL_CURRENT
 1

	)

19 
	#MCL_FUTURE
 2

	)

20 
	#MCL_ONFAULT
 4

	)

	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/siginfo.h

1 #iâdeà
_ASM_X86_SIGINFO_H


2 
	#_ASM_X86_SIGINFO_H


	)

4 #ifdeà
__x86_64__


5 #ifdeà
__ILP32__


6 
	t__k”Ãl_si_þock_t
 
	t__©Œibu‹__
((
	t®igÃd
(4)));

7 
	#__ARCH_SI_CLOCK_T
 
__k”Ãl_si_þock_t


	)

8 
	#__ARCH_SI_ATTRIBUTES
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

10 
	#__ARCH_SI_PREAMBLE_SIZE
 (4 * ())

	)

14 
	~<asm-g’”ic/sigšfo.h
>

	@/usr/include/asm/signal.h

1 #iâdeà
_ASM_X86_SIGNAL_H


2 
	#_ASM_X86_SIGNAL_H


	)

4 #iâdeà
__ASSEMBLY__


5 
	~<lšux/ty³s.h
>

6 
	~<lšux/time.h
>

10 
	gsigšfo
;

14 
	#NSIG
 32

	)

15 
	tsig£t_t
;

20 
	#SIGHUP
 1

	)

21 
	#SIGINT
 2

	)

22 
	#SIGQUIT
 3

	)

23 
	#SIGILL
 4

	)

24 
	#SIGTRAP
 5

	)

25 
	#SIGABRT
 6

	)

26 
	#SIGIOT
 6

	)

27 
	#SIGBUS
 7

	)

28 
	#SIGFPE
 8

	)

29 
	#SIGKILL
 9

	)

30 
	#SIGUSR1
 10

	)

31 
	#SIGSEGV
 11

	)

32 
	#SIGUSR2
 12

	)

33 
	#SIGPIPE
 13

	)

34 
	#SIGALRM
 14

	)

35 
	#SIGTERM
 15

	)

36 
	#SIGSTKFLT
 16

	)

37 
	#SIGCHLD
 17

	)

38 
	#SIGCONT
 18

	)

39 
	#SIGSTOP
 19

	)

40 
	#SIGTSTP
 20

	)

41 
	#SIGTTIN
 21

	)

42 
	#SIGTTOU
 22

	)

43 
	#SIGURG
 23

	)

44 
	#SIGXCPU
 24

	)

45 
	#SIGXFSZ
 25

	)

46 
	#SIGVTALRM
 26

	)

47 
	#SIGPROF
 27

	)

48 
	#SIGWINCH
 28

	)

49 
	#SIGIO
 29

	)

50 
	#SIGPOLL
 
SIGIO


	)

54 
	#SIGPWR
 30

	)

55 
	#SIGSYS
 31

	)

56 
	#SIGUNUSED
 31

	)

59 
	#SIGRTMIN
 32

	)

60 
	#SIGRTMAX
 
_NSIG


	)

75 
	#SA_NOCLDSTOP
 0x00000001u

	)

76 
	#SA_NOCLDWAIT
 0x00000002u

	)

77 
	#SA_SIGINFO
 0x00000004u

	)

78 
	#SA_ONSTACK
 0x08000000u

	)

79 
	#SA_RESTART
 0x10000000u

	)

80 
	#SA_NODEFER
 0x40000000u

	)

81 
	#SA_RESETHAND
 0x80000000u

	)

83 
	#SA_NOMASK
 
SA_NODEFER


	)

84 
	#SA_ONESHOT
 
SA_RESETHAND


	)

86 
	#SA_RESTORER
 0x04000000

	)

88 
	#MINSIGSTKSZ
 2048

	)

89 
	#SIGSTKSZ
 8192

	)

91 
	~<asm-g’”ic/sigÇl-defs.h
>

93 #iâdeà
__ASSEMBLY__


97 #ifdeà
__i386__


99 
	ssigaùiÚ
 {

101 
__sighªdËr_t
 
	m_§_hªdËr
;

102 (*
	m_§_sigaùiÚ
)(, 
	msigšfo
 *, *);

103 } 
	m_u
;

104 
sig£t_t
 
	m§_mask
;

105 
	m§_æags
;

106 (*
	m§_»¡Ü”
)();

109 
	#§_hªdËr
 
_u
.
_§_hªdËr


	)

110 
	#§_sigaùiÚ
 
_u
.
_§_sigaùiÚ


	)

114 
	ssigaùiÚ
 {

115 
__sighªdËr_t
 
	m§_hªdËr
;

116 
	m§_æags
;

117 
__sig»¡Üe_t
 
	m§_»¡Ü”
;

118 
sig£t_t
 
	m§_mask
;

123 
	ssig®t¡ack
 {

124 *
	mss_¥
;

125 
	mss_æags
;

126 
size_t
 
	mss_size
;

127 } 
	t¡ack_t
;

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__k”Ãl_fd_£t
;

29 (*
	t__k”Ãl_sighªdËr_t
)();

32 
	t__k”Ãl_key_t
;

33 
	t__k”Ãl_mqd_t
;

35 
	~<asm/posix_ty³s.h
>

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #iâdeà
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #iâdeà
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #iâdeà
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #iâdeà
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #iâdeà
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

66 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

67 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

68 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

69 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
è(Ñ))

	)

74 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

75 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

79 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

80 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

83 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/mman-common.h

1 #iâdeà
__ASM_GENERIC_MMAN_COMMON_H


2 
	#__ASM_GENERIC_MMAN_COMMON_H


	)

9 
	#PROT_READ
 0x1

	)

10 
	#PROT_WRITE
 0x2

	)

11 
	#PROT_EXEC
 0x4

	)

12 
	#PROT_SEM
 0x8

	)

13 
	#PROT_NONE
 0x0

	)

14 
	#PROT_GROWSDOWN
 0x01000000

	)

15 
	#PROT_GROWSUP
 0x02000000

	)

17 
	#MAP_SHARED
 0x01

	)

18 
	#MAP_PRIVATE
 0x02

	)

19 
	#MAP_TYPE
 0x0à

	)

20 
	#MAP_FIXED
 0x10

	)

21 
	#MAP_ANONYMOUS
 0x20

	)

22 #ifdeà
CONFIG_MMAP_ALLOW_UNINITIALIZED


23 
	#MAP_UNINITIALIZED
 0x4000000

	)

25 
	#MAP_UNINITIALIZED
 0x0

	)

31 
	#MLOCK_ONFAULT
 0x01

	)

33 
	#MS_ASYNC
 1

	)

34 
	#MS_INVALIDATE
 2

	)

35 
	#MS_SYNC
 4

	)

37 
	#MADV_NORMAL
 0

	)

38 
	#MADV_RANDOM
 1

	)

39 
	#MADV_SEQUENTIAL
 2

	)

40 
	#MADV_WILLNEED
 3

	)

41 
	#MADV_DONTNEED
 4

	)

44 
	#MADV_REMOVE
 9

	)

45 
	#MADV_DONTFORK
 10

	)

46 
	#MADV_DOFORK
 11

	)

47 
	#MADV_HWPOISON
 100

	)

48 
	#MADV_SOFT_OFFLINE
 101

	)

50 
	#MADV_MERGEABLE
 12

	)

51 
	#MADV_UNMERGEABLE
 13

	)

53 
	#MADV_HUGEPAGE
 14

	)

54 
	#MADV_NOHUGEPAGE
 15

	)

56 
	#MADV_DONTDUMP
 16

	)

58 
	#MADV_DODUMP
 17

	)

61 
	#MAP_FILE
 0

	)

71 
	#MAP_HUGE_SHIFT
 26

	)

72 
	#MAP_HUGE_MASK
 0x3f

	)

	@/usr/include/asm-generic/siginfo.h

1 #iâdeà
_ASM_GENERIC_SIGINFO_H


2 
	#_ASM_GENERIC_SIGINFO_H


	)

5 
	~<lšux/ty³s.h
>

7 
	usigv®
 {

8 
	msiv®_št
;

9 *
	msiv®_±r
;

10 } 
	tsigv®_t
;

16 #iâdeà
__ARCH_SI_PREAMBLE_SIZE


17 
	#__ARCH_SI_PREAMBLE_SIZE
 (3 * ())

	)

20 
	#SI_MAX_SIZE
 128

	)

21 #iâdeà
SI_PAD_SIZE


22 
	#SI_PAD_SIZE
 ((
SI_MAX_SIZE
 - 
__ARCH_SI_PREAMBLE_SIZE
è/ ())

	)

25 #iâdeà
__ARCH_SI_UID_T


26 
	#__ARCH_SI_UID_T
 
__k”Ãl_uid32_t


	)

34 #iâdeà
__ARCH_SI_BAND_T


35 
	#__ARCH_SI_BAND_T
 

	)

38 #iâdeà
__ARCH_SI_CLOCK_T


39 
	#__ARCH_SI_CLOCK_T
 
__k”Ãl_þock_t


	)

42 #iâdeà
__ARCH_SI_ATTRIBUTES


43 
	#__ARCH_SI_ATTRIBUTES


	)

46 #iâdeà
HAVE_ARCH_SIGINFO_T


48 
	ssigšfo
 {

49 
	msi_signo
;

50 
	msi_”ºo
;

51 
	msi_code
;

54 
	m_·d
[
SI_PAD_SIZE
];

58 
__k”Ãl_pid_t
 
	m_pid
;

59 
__ARCH_SI_UID_T
 
	m_uid
;

60 } 
	m_kžl
;

64 
__k”Ãl_tim”_t
 
	m_tid
;

65 
	m_ov”run
;

66 
	m_·d
[Ð
__ARCH_SI_UID_T
) - ()];

67 
sigv®_t
 
	m_sigv®
;

68 
	m_sys_´iv©e
;

69 } 
	m_tim”
;

73 
__k”Ãl_pid_t
 
	m_pid
;

74 
__ARCH_SI_UID_T
 
	m_uid
;

75 
sigv®_t
 
	m_sigv®
;

76 } 
	m_¹
;

80 
__k”Ãl_pid_t
 
	m_pid
;

81 
__ARCH_SI_UID_T
 
	m_uid
;

82 
	m_¡©us
;

83 
__ARCH_SI_CLOCK_T
 
	m_utime
;

84 
__ARCH_SI_CLOCK_T
 
	m_¡ime
;

85 } 
	m_sigchld
;

89 *
	m_addr
;

90 #ifdeà
__ARCH_SI_TRAPNO


91 
	m_Œ­no
;

93 
	m_addr_lsb
;

95 *
	m_low”
;

96 *
	m_uµ”
;

97 } 
	m_addr_bnd
;

98 } 
	m_sigçuÉ
;

102 
__ARCH_SI_BAND_T
 
	m_bªd
;

103 
	m_fd
;

104 } 
	m_sigpÞl
;

108 *
	m_ÿÎ_addr
;

109 
	m_sysÿÎ
;

110 
	m_¬ch
;

111 } 
	m_sigsys
;

112 } 
	m_sif›lds
;

113 } 
	t__ARCH_SI_ATTRIBUTES
 
	tsigšfo_t
;

116 
	#__ARCH_SIGSYS


	)

122 
	#si_pid
 
_sif›lds
.
_kžl
.
_pid


	)

123 
	#si_uid
 
_sif›lds
.
_kžl
.
_uid


	)

124 
	#si_tid
 
_sif›lds
.
_tim”
.
_tid


	)

125 
	#si_ov”run
 
_sif›lds
.
_tim”
.
_ov”run


	)

126 
	#si_sys_´iv©e
 
_sif›lds
.
_tim”
.
_sys_´iv©e


	)

127 
	#si_¡©us
 
_sif›lds
.
_sigchld
.
_¡©us


	)

128 
	#si_utime
 
_sif›lds
.
_sigchld
.
_utime


	)

129 
	#si_¡ime
 
_sif›lds
.
_sigchld
.
_¡ime


	)

130 
	#si_v®ue
 
_sif›lds
.
_¹
.
_sigv®


	)

131 
	#si_št
 
_sif›lds
.
_¹
.
_sigv®
.
siv®_št


	)

132 
	#si_±r
 
_sif›lds
.
_¹
.
_sigv®
.
siv®_±r


	)

133 
	#si_addr
 
_sif›lds
.
_sigçuÉ
.
_addr


	)

134 #ifdeà
__ARCH_SI_TRAPNO


135 
	#si_Œ­no
 
_sif›lds
.
_sigçuÉ
.
_Œ­no


	)

137 
	#si_addr_lsb
 
_sif›lds
.
_sigçuÉ
.
_addr_lsb


	)

138 
	#si_low”
 
_sif›lds
.
_sigçuÉ
.
_addr_bnd
.
_low”


	)

139 
	#si_uµ”
 
_sif›lds
.
_sigçuÉ
.
_addr_bnd
.
_uµ”


	)

140 
	#si_bªd
 
_sif›lds
.
_sigpÞl
.
_bªd


	)

141 
	#si_fd
 
_sif›lds
.
_sigpÞl
.
_fd


	)

142 #ifdeà
__ARCH_SIGSYS


143 
	#si_ÿÎ_addr
 
_sif›lds
.
_sigsys
.
_ÿÎ_addr


	)

144 
	#si_sysÿÎ
 
_sif›lds
.
_sigsys
.
_sysÿÎ


	)

145 
	#si_¬ch
 
_sif›lds
.
_sigsys
.
_¬ch


	)

148 
	#__SI_KILL
 0

	)

149 
	#__SI_TIMER
 0

	)

150 
	#__SI_POLL
 0

	)

151 
	#__SI_FAULT
 0

	)

152 
	#__SI_CHLD
 0

	)

153 
	#__SI_RT
 0

	)

154 
	#__SI_MESGQ
 0

	)

155 
	#__SI_SYS
 0

	)

156 
	#__SI_CODE
(
T
,
N
è(N)

	)

162 
	#SI_USER
 0

	)

163 
	#SI_KERNEL
 0x80

	)

164 
	#SI_QUEUE
 -1

	)

165 
	#SI_TIMER
 
	`__SI_CODE
(
__SI_TIMER
,-2è

	)

166 
	#SI_MESGQ
 
	`__SI_CODE
(
__SI_MESGQ
,-3è

	)

167 
	#SI_ASYNCIO
 -4

	)

168 
	#SI_SIGIO
 -5

	)

169 
	#SI_TKILL
 -6

	)

170 
	#SI_DETHREAD
 -7

	)

172 
	#SI_FROMUSER
(
sŒ
è((sŒ)->
si_code
 <ð0)

	)

173 
	#SI_FROMKERNEL
(
sŒ
è((sŒ)->
si_code
 > 0)

	)

178 
	#ILL_ILLOPC
 (
__SI_FAULT
|1è

	)

179 
	#ILL_ILLOPN
 (
__SI_FAULT
|2è

	)

180 
	#ILL_ILLADR
 (
__SI_FAULT
|3è

	)

181 
	#ILL_ILLTRP
 (
__SI_FAULT
|4è

	)

182 
	#ILL_PRVOPC
 (
__SI_FAULT
|5è

	)

183 
	#ILL_PRVREG
 (
__SI_FAULT
|6è

	)

184 
	#ILL_COPROC
 (
__SI_FAULT
|7è

	)

185 
	#ILL_BADSTK
 (
__SI_FAULT
|8è

	)

186 
	#NSIGILL
 8

	)

191 
	#FPE_INTDIV
 (
__SI_FAULT
|1è

	)

192 
	#FPE_INTOVF
 (
__SI_FAULT
|2è

	)

193 
	#FPE_FLTDIV
 (
__SI_FAULT
|3è

	)

194 
	#FPE_FLTOVF
 (
__SI_FAULT
|4è

	)

195 
	#FPE_FLTUND
 (
__SI_FAULT
|5è

	)

196 
	#FPE_FLTRES
 (
__SI_FAULT
|6è

	)

197 
	#FPE_FLTINV
 (
__SI_FAULT
|7è

	)

198 
	#FPE_FLTSUB
 (
__SI_FAULT
|8è

	)

199 
	#NSIGFPE
 8

	)

204 
	#SEGV_MAPERR
 (
__SI_FAULT
|1è

	)

205 
	#SEGV_ACCERR
 (
__SI_FAULT
|2è

	)

206 
	#SEGV_BNDERR
 (
__SI_FAULT
|3è

	)

207 
	#NSIGSEGV
 3

	)

212 
	#BUS_ADRALN
 (
__SI_FAULT
|1è

	)

213 
	#BUS_ADRERR
 (
__SI_FAULT
|2è

	)

214 
	#BUS_OBJERR
 (
__SI_FAULT
|3è

	)

216 
	#BUS_MCEERR_AR
 (
__SI_FAULT
|4)

	)

218 
	#BUS_MCEERR_AO
 (
__SI_FAULT
|5)

	)

219 
	#NSIGBUS
 5

	)

224 
	#TRAP_BRKPT
 (
__SI_FAULT
|1è

	)

225 
	#TRAP_TRACE
 (
__SI_FAULT
|2è

	)

226 
	#TRAP_BRANCH
 (
__SI_FAULT
|3è

	)

227 
	#TRAP_HWBKPT
 (
__SI_FAULT
|4è

	)

228 
	#NSIGTRAP
 4

	)

233 
	#CLD_EXITED
 (
__SI_CHLD
|1è

	)

234 
	#CLD_KILLED
 (
__SI_CHLD
|2è

	)

235 
	#CLD_DUMPED
 (
__SI_CHLD
|3è

	)

236 
	#CLD_TRAPPED
 (
__SI_CHLD
|4è

	)

237 
	#CLD_STOPPED
 (
__SI_CHLD
|5è

	)

238 
	#CLD_CONTINUED
 (
__SI_CHLD
|6è

	)

239 
	#NSIGCHLD
 6

	)

244 
	#POLL_IN
 (
__SI_POLL
|1è

	)

245 
	#POLL_OUT
 (
__SI_POLL
|2è

	)

246 
	#POLL_MSG
 (
__SI_POLL
|3è

	)

247 
	#POLL_ERR
 (
__SI_POLL
|4è

	)

248 
	#POLL_PRI
 (
__SI_POLL
|5è

	)

249 
	#POLL_HUP
 (
__SI_POLL
|6è

	)

250 
	#NSIGPOLL
 6

	)

255 
	#SYS_SECCOMP
 (
__SI_SYS
|1è

	)

256 
	#NSIGSYS
 1

	)

266 
	#SIGEV_SIGNAL
 0

	)

267 
	#SIGEV_NONE
 1

	)

268 
	#SIGEV_THREAD
 2

	)

269 
	#SIGEV_THREAD_ID
 4

	)

275 #iâdeà
__ARCH_SIGEV_PREAMBLE_SIZE


276 
	#__ARCH_SIGEV_PREAMBLE_SIZE
 ((è* 2 + (
sigv®_t
))

	)

279 
	#SIGEV_MAX_SIZE
 64

	)

280 
	#SIGEV_PAD_SIZE
 ((
SIGEV_MAX_SIZE
 - 
__ARCH_SIGEV_PREAMBLE_SIZE
) \

281 / ())

	)

283 
	ssigev’t
 {

284 
sigv®_t
 
	msigev_v®ue
;

285 
	msigev_signo
;

286 
	msigev_nÙify
;

288 
	m_·d
[
SIGEV_PAD_SIZE
];

289 
	m_tid
;

292 (*
	m_funùiÚ
)(
	msigv®_t
);

293 *
	m_©Œibu‹
;

294 } 
	m_sigev_th»ad
;

295 } 
	m_sigev_un
;

296 } 
	tsigev’t_t
;

298 
	#sigev_nÙify_funùiÚ
 
_sigev_un
.
_sigev_th»ad
.
_funùiÚ


	)

299 
	#sigev_nÙify_©Œibu‹s
 
_sigev_un
.
_sigev_th»ad
.
_©Œibu‹


	)

300 
	#sigev_nÙify_th»ad_id
 
_sigev_un
.
_tid


	)

	@/usr/include/asm-generic/signal-defs.h

1 #iâdeà
__ASM_GENERIC_SIGNAL_DEFS_H


2 
	#__ASM_GENERIC_SIGNAL_DEFS_H


	)

6 #iâdeà
SIG_BLOCK


7 
	#SIG_BLOCK
 0

	)

9 #iâdeà
SIG_UNBLOCK


10 
	#SIG_UNBLOCK
 1

	)

12 #iâdeà
SIG_SETMASK


13 
	#SIG_SETMASK
 2

	)

16 #iâdeà
__ASSEMBLY__


17 
	t__sigÇlâ_t
();

18 
__sigÇlâ_t
 *
	t__sighªdËr_t
;

20 
	t__»¡Üeâ_t
();

21 
__»¡Üeâ_t
 *
	t__sig»¡Üe_t
;

23 
	#SIG_DFL
 ((
__sighªdËr_t
)0è

	)

24 
	#SIG_IGN
 ((
__sighªdËr_t
)1è

	)

25 
	#SIG_ERR
 ((
__sighªdËr_t
)-1è

	)

	@/usr/include/asm-generic/types.h

1 #iâdeà
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

6 
	~<asm-g’”ic/št-Î64.h
>

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~<asm/posix_ty³s_32.h
>

3 #–ià
defšed
(
__ILP32__
)

4 
	~<asm/posix_ty³s_x32.h
>

6 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/linux/stddef.h

	@/usr/include/linux/time.h

1 #iâdeà
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<lšux/ty³s.h
>

7 #iâdeà
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stime¥ec
 {

10 
__k”Ãl_time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

15 
	stimev®
 {

16 
__k”Ãl_time_t
 
	mtv_£c
;

17 
__k”Ãl_su£cÚds_t
 
	mtv_u£c
;

20 
	stimezÚe
 {

21 
	mtz_mšu‹swe¡
;

22 
	mtz_d¡time
;

30 
	#ITIMER_REAL
 0

	)

31 
	#ITIMER_VIRTUAL
 1

	)

32 
	#ITIMER_PROF
 2

	)

34 
	s™im”¥ec
 {

35 
time¥ec
 
	m™_š‹rv®
;

36 
time¥ec
 
	m™_v®ue
;

39 
	s™im”v®
 {

40 
timev®
 
	m™_š‹rv®
;

41 
timev®
 
	m™_v®ue
;

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

57 
	#CLOCK_SGI_CYCLE
 10

	)

58 
	#CLOCK_TAI
 11

	)

60 
	#MAX_CLOCKS
 16

	)

61 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

62 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

67 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/asm-generic/int-ll64.h

8 #iâdeà
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__ASSEMBLY__


19 
__sigÃd__
 
	t__s8
;

20 
	t__u8
;

22 
__sigÃd__
 
	t__s16
;

23 
	t__u16
;

25 
__sigÃd__
 
	t__s32
;

26 
	t__u32
;

28 #ifdeà
__GNUC__


29 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

30 
__ex‹nsiÚ__
 
	t__u64
;

32 
__sigÃd__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm/posix_types_32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__k”Ãl_mode_t
;

11 
	#__k”Ãl_mode_t
 
__k”Ãl_mode_t


	)

13 
	t__k”Ãl_c_pid_t
;

14 
	#__k”Ãl_c_pid_t
 
__k”Ãl_c_pid_t


	)

16 
	t__k”Ãl_uid_t
;

17 
	t__k”Ãl_gid_t
;

18 
	#__k”Ãl_uid_t
 
__k”Ãl_uid_t


	)

20 
	t__k”Ãl_Þd_dev_t
;

21 
	#__k”Ãl_Þd_dev_t
 
__k”Ãl_Þd_dev_t


	)

23 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_64.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__k”Ãl_Þd_uid_t
;

11 
	t__k”Ãl_Þd_gid_t
;

12 
	#__k”Ãl_Þd_uid_t
 
__k”Ãl_Þd_uid_t


	)

14 
	t__k”Ãl_Þd_dev_t
;

15 
	#__k”Ãl_Þd_dev_t
 
__k”Ãl_Þd_dev_t


	)

17 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__k”Ãl_lÚg_t
;

14 
	t__k”Ãl_ulÚg_t
;

15 
	#__k”Ãl_lÚg_t
 
__k”Ãl_lÚg_t


	)

17 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm-generic/posix_types.h

1 #iâdeà
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__k”Ãl_lÚg_t


14 
	t__k”Ãl_lÚg_t
;

15 
	t__k”Ãl_ulÚg_t
;

18 #iâdeà
__k”Ãl_šo_t


19 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_šo_t
;

22 #iâdeà
__k”Ãl_mode_t


23 
	t__k”Ãl_mode_t
;

26 #iâdeà
__k”Ãl_pid_t


27 
	t__k”Ãl_pid_t
;

30 #iâdeà
__k”Ãl_c_pid_t


31 
	t__k”Ãl_c_pid_t
;

34 #iâdeà
__k”Ãl_uid_t


35 
	t__k”Ãl_uid_t
;

36 
	t__k”Ãl_gid_t
;

39 #iâdeà
__k”Ãl_su£cÚds_t


40 
__k”Ãl_lÚg_t
 
	t__k”Ãl_su£cÚds_t
;

43 #iâdeà
__k”Ãl_daddr_t


44 
	t__k”Ãl_daddr_t
;

47 #iâdeà
__k”Ãl_uid32_t


48 
	t__k”Ãl_uid32_t
;

49 
	t__k”Ãl_gid32_t
;

52 #iâdeà
__k”Ãl_Þd_uid_t


53 
__k”Ãl_uid_t
 
	t__k”Ãl_Þd_uid_t
;

54 
__k”Ãl_gid_t
 
	t__k”Ãl_Þd_gid_t
;

57 #iâdeà
__k”Ãl_Þd_dev_t


58 
	t__k”Ãl_Þd_dev_t
;

65 #iâdeà
__k”Ãl_size_t


66 #ià
__BITS_PER_LONG
 != 64

67 
	t__k”Ãl_size_t
;

68 
	t__k”Ãl_ssize_t
;

69 
	t__k”Ãl_±rdiff_t
;

71 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_size_t
;

72 
__k”Ãl_lÚg_t
 
	t__k”Ãl_ssize_t
;

73 
__k”Ãl_lÚg_t
 
	t__k”Ãl_±rdiff_t
;

77 #iâdeà
__k”Ãl_fsid_t


79 
	mv®
[2];

80 } 
	t__k”Ãl_fsid_t
;

86 
__k”Ãl_lÚg_t
 
	t__k”Ãl_off_t
;

87 
	t__k”Ãl_loff_t
;

88 
__k”Ãl_lÚg_t
 
	t__k”Ãl_time_t
;

89 
__k”Ãl_lÚg_t
 
	t__k”Ãl_þock_t
;

90 
	t__k”Ãl_tim”_t
;

91 
	t__k”Ãl_þockid_t
;

92 * 
	t__k”Ãl_ÿddr_t
;

93 
	t__k”Ãl_uid16_t
;

94 
	t__k”Ãl_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #iâdeà
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ià
defšed
(
__x86_64__
è&& !defšed(
__ILP32__
)

5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #iâdeà
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
41
1012
isgx.mod.c
sgx.h
sgx_arch.h
sgx_asm.h
sgx_encl.c
sgx_ioctl.c
sgx_main.c
sgx_page_cache.c
sgx_pmd.c
sgx_pmd.h
sgx_user.h
sgx_util.c
sgx_vma.c
/usr/include/asm/mman.h
/usr/include/asm/msr-index.h
/usr/include/linux/ioctl.h
/usr/include/linux/sched.h
/usr/include/linux/signal.h
/usr/include/linux/types.h
/usr/include/linux/version.h
/usr/include/asm-generic/mman.h
/usr/include/asm/ioctl.h
/usr/include/asm/siginfo.h
/usr/include/asm/signal.h
/usr/include/asm/types.h
/usr/include/linux/posix_types.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/mman-common.h
/usr/include/asm-generic/siginfo.h
/usr/include/asm-generic/signal-defs.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/linux/stddef.h
/usr/include/linux/time.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
